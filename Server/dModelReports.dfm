inherited dmModelReports: TdmModelReports
  Height = 448
  Width = 896
  object qryModels: TAbmesSQLQuery
    BeforeOpen = qryModelsBeforeOpen
    AfterClose = qryModelsAfterClose
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'TREE_SALE_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'TREE_SALE_OBJECT_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'USER_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'USER_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_BASE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'ALL_FILTERED_PRODUCTS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MAIN_DEPT_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MAIN_DEPT_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'INCLUDE_DEPT_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'INCLUDE_DEPT_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'INCLUDE_DETAIL_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'INCLUDE_DETAIL_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'INCLUDE_PRODUCT_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'INCLUDE_PRODUCT_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'ENGINEER_EMPLOYEE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'ENGINEER_EMPLOYEE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'ENTER_RESULT_STORE_END_BEGIN_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'ENTER_RESULT_STORE_END_END_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_NO'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_NO'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'MIN_PRODUCT_NEED_BEGIN_BEGIN_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'MIN_PRODUCT_NEED_BEGIN_END_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'MIN_PRODUCT_NEED_BEGIN_BEGIN_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'MIN_PRODUCT_NEED_BEGIN_END_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MIN_ML_STATE_CODE'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'MAX_ML_STATE_CODE'
        ParamType = ptInput
        Value = '7'
      end
      item
        DataType = ftFloat
        Name = 'HAS_REQUESTED_CHANGES'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'HAS_NOT_REQUESTED_CHANGES'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'HAS_REQUESTED_CHANGES'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_NOT_REQUESTED_CHANGES'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_REQUESTED_MY_CHANGES'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'HAS_NOT_REQUESTED_MY_CHANGES'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'HAS_REQUESTED_MY_CHANGES'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'USER_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_NOT_REQUESTED_MY_CHANGES'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'USER_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_REJECTED_CHANGES'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'HAS_NOT_REJECTED_CHANGES'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'HAS_REJECTED_CHANGES'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_NOT_REJECTED_CHANGES'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_REJECTED_MY_CHANGES'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'HAS_NOT_REJECTED_MY_CHANGES'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'HAS_REJECTED_MY_CHANGES'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'USER_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_NOT_REJECTED_MY_CHANGES'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'USER_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'BEGIN_PRIORITY_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'END_PRIORITY_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_WASTE_COMPENSATOR_STATUS'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'IS_WASTE_COMPENSATOR_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_WASTE_COMPENSATOR_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_WASTE_STATUS'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'HAS_WASTE_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_SALE_STATE'
        ParamType = ptInput
        Value = '0'
      end
      item
        DataType = ftFloat
        Name = 'IS_SALE_STATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'OWNER_COMPANY_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'OWNER_COMPANY_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'SALE_SHIPMENT_BEGIN_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'SALE_SHIPMENT_BEGIN_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'SALE_SHIPMENT_END_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'SALE_SHIPMENT_END_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_SALE_STATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'OWNER_EMPLOYEE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'OWNER_EMPLOYEE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MODEL_DEVELOPMENT_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MODEL_DEVELOPMENT_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MIN_LIMITING_DATE_DIFF'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MIN_LIMITING_DATE_DIFF'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MAX_LIMITING_DATE_DIFF'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MAX_LIMITING_DATE_DIFF'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'with s_tree as'
      '  ( select'
      '      *'
      '    from'
      '      ( select'
      '          *'
      '        from'
      '          SALES s2'
      '        start with'
      '          (%GET_SALE_OBJECT_TREE = 1) and'
      '          ( (s2.SALE_OBJECT_BRANCH_CODE, s2.SALE_OBJECT_CODE) ='
      '            ( select'
      '                s4.SALE_OBJECT_BRANCH_CODE,'
      '                s4.SALE_OBJECT_CODE'
      '              from'
      '                ( select'
      '                    s3.SALE_OBJECT_BRANCH_CODE,'
      '                    s3.SALE_OBJECT_CODE,'
      '                    s3.WASTING_SALE_OBJ_BRANCH_CODE'
      '                  from'
      '                    SALES s3'
      '                  start with'
      '                    (%GET_SALE_OBJECT_TREE = 1) and'
      
        '                    (s3.SALE_OBJECT_BRANCH_CODE = :TREE_SALE_OBJ' +
        'ECT_BRANCH_CODE) and'
      
        '                    (s3.SALE_OBJECT_CODE = :TREE_SALE_OBJECT_COD' +
        'E)'
      '                  connect by'
      
        '                    (s3.SALE_OBJECT_BRANCH_CODE = prior s3.WASTI' +
        'NG_SALE_OBJ_BRANCH_CODE) and'
      
        '                    (s3.SALE_OBJECT_CODE = prior s3.WASTING_SALE' +
        '_OBJ_CODE)'
      '                ) s4'
      '              where'
      '                (%GET_SALE_OBJECT_TREE = 1) and'
      '                (s4.WASTING_SALE_OBJ_BRANCH_CODE is null)'
      '            )'
      '          )'
      '        connect by'
      
        '          (s2.WASTING_SALE_OBJ_BRANCH_CODE = prior s2.SALE_OBJEC' +
        'T_BRANCH_CODE) and'
      '          (s2.WASTING_SALE_OBJ_CODE = prior s2.SALE_OBJECT_CODE)'
      '      ) s5'
      '    where'
      '      (%GET_SALE_OBJECT_TREE = 1) and'
      '      (s5.ANNUL_EMPLOYEE_CODE is null)'
      '  )'
      'select'
      '  /*+ INDEX(s) INDEX(ml) */'
      '  s.SALE_OBJECT_BRANCH_CODE as PROCESS_OBJECT_BRANCH_CODE,'
      '  s.SALE_OBJECT_CODE as PROCESS_OBJECT_CODE,'
      ''
      '  ( pot.PRODUCTION_ORDER_TYPE_ABBREV || '#39'/'#39' ||'
      '    ( select'
      '        To_Char(d.CUSTOM_CODE)'
      '      from'
      '        DEPTS d'
      '      where'
      '        (s.SALE_BRANCH_CODE = d.DEPT_CODE)'
      '    ) ||'
      '    '#39'/'#39' || To_Char(s.SALE_NO) || '#39'/'#39' ||'
      '    ( select'
      '        st.SALE_TYPE_ABBREV'
      '      from'
      '        SALE_TYPES st'
      '      where'
      '        (s.SALE_TYPE_CODE = st.SALE_TYPE_CODE)'
      '    )'
      '  ) as SALE_IDENTIFICATION,'
      ''
      '  s.SALE_OBJECT_BRANCH_CODE,'
      '  s.SALE_OBJECT_CODE,'
      '  s.SALE_ORDER_TYPE_CODE,'
      ''
      '  Decode(s.SALE_ORDER_TYPE_CODE, 1, 1, 0) as IS_SALE,'
      ''
      '  s.PRODUCT_CODE,'
      '  p.NAME as PRODUCT_NAME,'
      '  p.CUSTOM_CODE as PRODUCT_NO,'
      ''
      '  p.MEASURE_CODE,'
      '  ( select'
      '      mw.MEASURE_ABBREV'
      '    from'
      '      MEASURES mw'
      '    where'
      '      (p.MEASURE_CODE = mw.MEASURE_CODE)'
      '  ) as MEASURE_ABBREV,'
      ''
      '  p.ACCOUNT_MEASURE_CODE,'
      '  ( select'
      '      ma.MEASURE_ABBREV'
      '    from'
      '      MEASURES ma'
      '    where'
      '      (p.ACCOUNT_MEASURE_CODE = ma.MEASURE_CODE)'
      '  ) as ACCOUNT_MEASURE_ABBREV,'
      ''
      
        '  %PRODUCT_COMPANY_PRODUCT_NAMES_FROM_PRODUCTS[s.PRODUCT_CODE~s.' +
        'CLIENT_COMPANY_CODE~p] as CLIENT_PRODUCT_NAME,'
      ''
      '  s.CLIENT_REQUEST_NO,'
      '  s.MANUFACTURE_QUANTITY,'
      ''
      '  Decode('
      '    s.SALE_ORDER_TYPE_CODE,'
      '    3,'
      '    ( select'
      '        (oe.FIRST_NAME || '#39' '#39' || oe.LAST_NAME)'
      '      from'
      '        EMPLOYEES oe'
      '      where'
      '        (s.MANAGER_EMPLOYEE_CODE = oe.EMPLOYEE_CODE)'
      '    ),'
      '    ( select'
      '        c.SHORT_NAME'
      '      from'
      '        COMPANIES c'
      '      where'
      '        (c.COMPANY_CODE = s.CLIENT_COMPANY_CODE)'
      '    )'
      '  ) as OWNER_NAME,'
      ''
      '  s.OKIDU_EMPLOYEE_CODE as ENGINEER_EMPLOYEE_CODE,'
      ''
      '  ( select'
      
        '      (oe.ABBREV || '#39'   '#39' || oe.FIRST_NAME || '#39' '#39' || oe.LAST_NAM' +
        'E)'
      '    from'
      '      EMPLOYEES oe'
      '    where'
      '      (s.OKIDU_EMPLOYEE_CODE = oe.EMPLOYEE_CODE)'
      '  ) as ENGINEER_EMPLOYEE_ABBREV,'
      ''
      '  Nvl2(s.ANNUL_EMPLOYEE_CODE, 1, 0) as IS_ANNULED,'
      '  Nvl2(s.FINISH_EMPLOYEE_CODE, 1, 0) as IS_FINISHED,'
      ''
      '  ml.ML_OBJECT_BRANCH_CODE,'
      '  ml.ML_OBJECT_CODE,'
      '  s.PRODUCTION_DEPT_CODE as MAIN_DEPT_CODE,'
      ''
      '  ( select'
      '      (dt.DEPT_TYPE_ABBREV || d.CUSTOM_CODE || d.SUFFIX_LETTER)'
      '    from'
      '      DEPTS d,'
      '      DEPT_TYPES dt'
      '    where'
      '      (s.PRODUCTION_DEPT_CODE = d.DEPT_CODE) and'
      '      (d.DEPT_TYPE_CODE = dt.DEPT_TYPE_CODE(+))'
      '  ) as MAIN_DEPT_IDENTIFIER,'
      ''
      
        '  %ML_MIN_PRODUCT_NEED_DATE[ml.ML_OBJECT_BRANCH_CODE~ ml.ML_OBJE' +
        'CT_CODE] as MIN_PRODUCT_NEED_BEGIN_DATE,'
      
        '  Coalesce(ml.ENTER_RESULT_STORE_END_DATE, s.ENTER_SH_STORE_PLAN' +
        '_END_DATE) as ENTER_RESULT_STORE_END_DATE,'
      ''
      '  %COUNT_WORKDAYS['
      
        '    %ML_MIN_PRODUCT_NEED_DATE[ml.ML_OBJECT_BRANCH_CODE~ ml.ML_OB' +
        'JECT_CODE]~'
      '    ml.ENTER_RESULT_STORE_END_DATE'
      '  ] as MANUFACTURE_DAYS,'
      ''
      '  Nvl2(ml.LIMITING_EMPLOYEE_CODE, 1, 0) as IS_LIMITING,'
      '  ml.IS_ARCHIVED,'
      ''
      '  ( select'
      '      Count(*)'
      '    from'
      '      MATERIAL_LIST_LINES mll,'
      '      MATERIAL_LIST_LINE_CHANGES mllc'
      '    where'
      '      (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH_CODE) and'
      '      (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '      (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BRANCH_CODE)' +
        ' and'
      '      (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '      (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '      (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '      (mllc.REPLY_EMPLOYEE_CODE is null)'
      '  ) as REQUESTED_CHANGE_COUNT,'
      ''
      '  ( select'
      '      Count(*)'
      '    from'
      '      MATERIAL_LIST_LINES mll,'
      '      MATERIAL_LIST_LINE_CHANGES mllc'
      '    where'
      '      (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH_CODE) and'
      '      (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '      (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BRANCH_CODE)' +
        ' and'
      '      (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '      (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '      (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '      (mllc.REPLY_EMPLOYEE_CODE is null) and'
      '      (mllc.REQUEST_EMPLOYEE_CODE = :USER_CODE)'
      '  ) as REQUESTED_MY_CHANGE_COUNT,'
      ''
      '  ( select'
      '      Count(*)'
      '    from'
      '      MATERIAL_LIST_LINES mll,'
      '      MATERIAL_LIST_LINE_CHANGES mllc'
      '    where'
      '      (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH_CODE) and'
      '      (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '      (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BRANCH_CODE)' +
        ' and'
      '      (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '      (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '      (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '      (mllc.MLL_CHANGE_REPLY_TYPE_CODE = 2)'
      '  ) as REJECTED_CHANGE_COUNT,'
      ''
      '  ( select'
      '      Count(*)'
      '    from'
      '      MATERIAL_LIST_LINES mll,'
      '      MATERIAL_LIST_LINE_CHANGES mllc'
      '    where'
      '      (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH_CODE) and'
      '      (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '      (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BRANCH_CODE)' +
        ' and'
      '      (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '      (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '      (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '      (mllc.MLL_CHANGE_REPLY_TYPE_CODE = 2) and'
      '      (mllc.REQUEST_EMPLOYEE_CODE = :USER_CODE)'
      '  ) as REJECTED_MY_CHANGE_COUNT,'
      ''
      '  Nvl2('
      '    ml.ML_OBJECT_CODE,'
      '    Nvl2('
      '      ml.LIMITING_EMPLOYEE_CODE,'
      '      null,'
      '      %COUNT_WORKDAYS['
      '        ContextDate~'
      
        '        %ML_MIN_PRODUCT_NEED_DATE[ml.ML_OBJECT_BRANCH_CODE~ ml.M' +
        'L_OBJECT_CODE]'
      '      ]'
      
        '    ) - (select co.ML_LIMITING_WORKDAYS from COMMON_OPTIONS co w' +
        'here (co.CODE = 1)),'
      '    null'
      '  ) as CURRENT_TO_LIMITING_DATE_DIFF,'
      ''
      '  %ML_STATE[s~ml] as ML_STATE_CODE,'
      ''
      
        '  %SPEC_STATE[p.PRODUCT_CODE~ (s.MANUFACTURE_QUANTITY * p.TECH_M' +
        'EASURE_COEF)~ s.PRODUCTION_DEPT_CODE~ s.ENTER_SH_STORE_PLAN_END_' +
        'DATE~ null] as SPEC_STATE_CODE,'
      ''
      '  0 as DEL_RECORD,'
      ''
      '  ( select'
      '      sg.PRIORITY_CODE'
      '    from'
      '      SALE_GROUPS sg'
      '    where'
      
        '      (sg.SALE_GROUP_OBJECT_BRANCH_CODE = s.SALE_GROUP_OBJECT_BR' +
        'ANCH_CODE) and'
      '      (sg.SALE_GROUP_OBJECT_CODE = s.SALE_GROUP_OBJECT_CODE)'
      '  ) as PRIORITY_CODE,'
      ''
      '  ( select'
      '      p.PRIORITY_NO'
      '    from'
      '      SALE_GROUPS sg,'
      '      PRIORITIES p'
      '    where'
      
        '      (sg.SALE_GROUP_OBJECT_BRANCH_CODE = s.SALE_GROUP_OBJECT_BR' +
        'ANCH_CODE) and'
      '      (sg.SALE_GROUP_OBJECT_CODE = s.SALE_GROUP_OBJECT_CODE) and'
      ''
      '      (sg.PRIORITY_CODE = p.PRIORITY_CODE)'
      '  ) as PRIORITY_NO,'
      ''
      '  ( select'
      '      (p.PRIORITY_NO || '#39'   '#39' || p.PRIORITY_NAME)'
      '    from'
      '      SALE_GROUPS sg,'
      '      PRIORITIES p'
      '    where'
      
        '      (sg.SALE_GROUP_OBJECT_BRANCH_CODE = s.SALE_GROUP_OBJECT_BR' +
        'ANCH_CODE) and'
      '      (sg.SALE_GROUP_OBJECT_CODE = s.SALE_GROUP_OBJECT_CODE) and'
      ''
      '      (sg.PRIORITY_CODE = p.PRIORITY_CODE)'
      '  ) as PRIORITY_FULL_NAME,'
      ''
      '  ( select'
      '      wp.WORK_PRIORITY_NO'
      '    from'
      '      WORK_PRIORITIES wp'
      '    where'
      '      (wp.WORK_PRIORITY_CODE = s.WORK_PRIORITY_CODE)'
      '  ) as WORK_PRIORITY_NO,'
      ''
      '  ( select'
      '      (wp.WORK_PRIORITY_NO || '#39'   '#39' || wp.WORK_PRIORITY_NAME)'
      '    from'
      '      WORK_PRIORITIES wp'
      '    where'
      '      (wp.WORK_PRIORITY_CODE = s.WORK_PRIORITY_CODE)'
      '  ) as WORK_PRIORITY_FULL_NAME,'
      '  '
      
        '  Nvl2(s.WASTING_SALE_OBJ_BRANCH_CODE, 1, 0) as IS_WASTE_COMPENS' +
        'ATOR,'
      ''
      '  ( select'
      '      Sign(Count(*))'
      '    from'
      '      SALES ws'
      '    where'
      
        '      (ws.WASTING_SALE_OBJ_BRANCH_CODE = s.SALE_OBJECT_BRANCH_CO' +
        'DE) and'
      '      (ws.WASTING_SALE_OBJ_CODE = s.SALE_OBJECT_CODE)'
      '  ) as HAS_WASTE_COMPENSATORS,'
      ''
      '  ( select'
      '      Sign(Count(*))'
      '    from'
      '      MATERIAL_LIST_LINES mll2,'
      '      ML_MODEL_STAGES mlms,'
      '      MODEL_MOVEMENTS mm'
      '    where'
      
        '      (ml.ML_OBJECT_BRANCH_CODE = mll2.ML_OBJECT_BRANCH_CODE) an' +
        'd'
      '      (ml.ML_OBJECT_CODE = mll2.ML_OBJECT_CODE) and'
      ''
      
        '      (mll2.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_BRANCH_CODE' +
        ') and'
      '      (mll2.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) and'
      ''
      
        '      (mlms.MLMS_OBJECT_BRANCH_CODE = mm.FROM_MLMS_OBJECT_BRANCH' +
        '_CODE) and'
      '      (mlms.MLMS_OBJECT_CODE = mm.FROM_MLMS_OBJECT_CODE) and'
      ''
      '      (mm.TO_DEPT_CODE is not null) and'
      '      (mm.STORNO_EMPLOYEE_CODE is null)'
      '  ) as HAS_WASTE,'
      ''
      '  ( select'
      
        '      (dt.DEPT_TYPE_ABBREV || d.CUSTOM_CODE || d.SUFFIX_LETTER) ' +
        'as DEPT_IDENTIFIER'
      '    from'
      '      DEPTS d,'
      '      DEPT_TYPES dt'
      '    where'
      '      (d.DEPT_CODE = s.CONSUMER_DEPT_CODE) and'
      '      (d.DEPT_TYPE_CODE = dt.DEPT_TYPE_CODE)'
      '  ) as CONSUMER_DEPT_IDENTIFIER,'
      ''
      '  s.DOC_BRANCH_CODE,'
      '  s.DOC_CODE,'
      '  %HAS_DOC_ITEMS[s] as HAS_DOC_ITEMS,'
      ''
      '  s.MODEL_DEVELOPMENT_TYPE_CODE,'
      '  ( select'
      '      Replace(mdt.MODEL_DEVELOPMENT_TYPE_ABBREV, '#39' '#39', '#39#39')'
      '    from'
      '      MODEL_DEVELOPMENT_TYPES mdt'
      '    where'
      
        '      (mdt.MODEL_DEVELOPMENT_TYPE_CODE = s.MODEL_DEVELOPMENT_TYP' +
        'E_CODE)'
      '  ) as MODEL_DEVELOPMENT_TYPE_ABBREV,'
      ''
      '  %HAS_DOC_ITEMS[p] as PRODUCT_HAS_DOC_ITEMS,'
      ''
      
        '  Nvl2(ml.ML_OBJECT_BRANCH_CODE, %MODEL_OPERATIONS_STATUS[ml], n' +
        'ull) as MODEL_OPERATIONS_STATUS_CODE,'
      ''
      
        '  To_Char(s.SALE_OBJECT_BRANCH_CODE) || '#39';'#39' || To_Char(s.SALE_OB' +
        'JECT_CODE) as SALE_OBJECT_PK,'
      ''
      '  Nvl2('
      '    s.WASTING_SALE_OBJ_CODE,'
      
        '    To_Char(s.WASTING_SALE_OBJ_BRANCH_CODE) || '#39';'#39' || To_Char(s.' +
        'WASTING_SALE_OBJ_CODE),'
      '    null'
      '  ) as WASTING_SALE_OBJ_PK'
      ''
      ''
      'from'
      '  %SALES_TABLE_OR_TREE s,'
      '  PRODUCTION_ORDER_TYPES pot,'
      '  PRODUCTS p,'
      '  MATERIAL_LISTS ml'
      ''
      'where'
      
        '  -- za da byde spomenato s_tree. inache kogato e SALES wmesto s' +
        '_tree rewe'
      '  ( (1 = 1) or'
      '    (exists'
      '      ( select'
      '          1'
      '        from'
      '          s_tree'
      '      )'
      '    )'
      '  ) and'
      ''
      
        '  (s.PRODUCTION_ORDER_TYPE_CODE = pot.PRODUCTION_ORDER_TYPE_CODE' +
        ') and'
      '  (s.PRODUCT_CODE = p.PRODUCT_CODE) and'
      
        '  (s.SALE_OBJECT_BRANCH_CODE = ml.BND_PROCESS_OBJECT_BRANCH_CODE' +
        '(+)) and'
      '  (s.SALE_OBJECT_CODE = ml.BND_PROCESS_OBJECT_CODE(+)) and'
      ''
      '  ( (%GET_SALE_OBJECT_TREE = 1) or'
      '    ( (s.SALE_BRANCH_CODE is not null) and'
      '      (s.MANUFACTURE_QUANTITY > 0) and'
      ''
      
        '      (pot.PROD_ORDER_BASE_TYPE_CODE = :PRODUCTION_ORDER_BASE_TY' +
        'PE_CODE) and'
      ''
      '      ( (:PRODUCTION_ORDER_TYPE_CODE is null) or'
      '        (:PRODUCTION_ORDER_TYPE_CODE = 0) or'
      
        '        (s.PRODUCTION_ORDER_TYPE_CODE = :PRODUCTION_ORDER_TYPE_C' +
        'ODE)'
      '      ) and'
      ''
      '      ( (:ALL_FILTERED_PRODUCTS = 1) or'
      '        (exists'
      '          ( select'
      '              1'
      '            from'
      '              TEMP_FILTERED_PRODUCTS tfp'
      '            where'
      '              (tfp.PRODUCT_CODE = s.PRODUCT_CODE)'
      '          )'
      '        )'
      '      ) and'
      ''
      '      ( (:MAIN_DEPT_CODE is null) or'
      '        (exists'
      '          ( select'
      '              1'
      '            from'
      '              DEPT_RELATIONS dr'
      '            where'
      '              (dr.ANCESTOR_DEPT_CODE = :MAIN_DEPT_CODE) and'
      '              (dr.DESCENDANT_DEPT_CODE = s.PRODUCTION_DEPT_CODE)'
      '          )'
      '        )'
      '      ) and'
      ''
      '      ( (:INCLUDE_DEPT_CODE is null) or'
      '        (exists'
      '          ( select'
      '              1'
      '            from'
      '              MATERIAL_LIST_LINES mll,'
      '              ML_MODEL_STAGES mlms'
      '            where'
      
        '              (mll.ML_OBJECT_BRANCH_CODE = ml.ML_OBJECT_BRANCH_C' +
        'ODE) and'
      '              (mll.ML_OBJECT_CODE = ml.ML_OBJECT_CODE) and'
      
        '              (mlms.MLL_OBJECT_BRANCH_CODE = mll.MLL_OBJECT_BRAN' +
        'CH_CODE) and'
      '              (mlms.MLL_OBJECT_CODE = mll.MLL_OBJECT_CODE) and'
      '              (mll.ANNUL_EMPLOYEE_CODE is null) and'
      '              (exists'
      '                ( select'
      '                   1'
      '                  from'
      '                    DEPT_RELATIONS dr'
      '                  where'
      
        '                    (dr.ANCESTOR_DEPT_CODE = :INCLUDE_DEPT_CODE)' +
        ' and'
      '                    (dr.DESCENDANT_DEPT_CODE = mlms.DEPT_CODE)'
      '                )'
      '              )'
      '          )'
      '        )'
      '      ) and'
      ''
      '      ( (:INCLUDE_DETAIL_CODE is null) or'
      '        ( exists'
      '          ( select'
      '              1'
      '            from'
      '              MATERIAL_LIST_LINES mll,'
      '              PRODUCT_RELATIONS pr'
      '            where'
      
        '              (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH_C' +
        'ODE) and'
      '              (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      '              (mll.ANNUL_EMPLOYEE_CODE is null) and'
      '              (pr.DESCENDANT_PRODUCT_CODE = mll.DETAIL_CODE) and'
      '              (pr.ANCESTOR_PRODUCT_CODE = :INCLUDE_DETAIL_CODE)'
      '          )'
      '        )'
      '      ) and'
      ''
      '      ( (:INCLUDE_PRODUCT_CODE is null) or'
      '        ( exists'
      '          ( select'
      '              1'
      '            from'
      '              MATERIAL_LIST_LINES mll,'
      '              PRODUCT_RELATIONS pr'
      '            where'
      
        '              (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH_C' +
        'ODE) and'
      '              (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      '              (mll.ANNUL_EMPLOYEE_CODE is null) and'
      
        '              (pr.DESCENDANT_PRODUCT_CODE = mll.PRODUCT_CODE) an' +
        'd'
      '              (pr.ANCESTOR_PRODUCT_CODE = :INCLUDE_PRODUCT_CODE)'
      '          )'
      '        )'
      '      ) and'
      ''
      '      ( (:ENGINEER_EMPLOYEE_CODE is null) or'
      '        (s.OKIDU_EMPLOYEE_CODE = :ENGINEER_EMPLOYEE_CODE)'
      '      ) and'
      ''
      
        '      ( Coalesce(ml.ENTER_RESULT_STORE_BEGIN_DATE, s.ENTER_SH_ST' +
        'ORE_PLAN_BEGIN_DATE) between'
      
        '          Coalesce(Cast(:ENTER_RESULT_STORE_END_BEGIN_DATE as Da' +
        'te), %MIN_DATE) and Coalesce(Cast(:ENTER_RESULT_STORE_END_END_DA' +
        'TE as Date), %MAX_DATE)'
      '      ) and'
      ''
      '      ( (:SALE_BRANCH_CODE is null) or'
      '        (s.SALE_BRANCH_CODE = :SALE_BRANCH_CODE)'
      '      ) and'
      ''
      '      ( (:SALE_TYPE_CODE is null) or'
      '        (s.SALE_TYPE_CODE = :SALE_TYPE_CODE)'
      '      ) and'
      ''
      '      ( (:SALE_NO is null) or'
      '        (s.SALE_NO = :SALE_NO)'
      '      ) and'
      ''
      '      ( ( (:MIN_PRODUCT_NEED_BEGIN_BEGIN_DATE is null) and'
      '          (:MIN_PRODUCT_NEED_BEGIN_END_DATE is null)'
      '        ) or'
      
        '        (%ML_MIN_PRODUCT_NEED_DATE[ml.ML_OBJECT_BRANCH_CODE~ ml.' +
        'ML_OBJECT_CODE] between'
      
        '          Coalesce(Cast(:MIN_PRODUCT_NEED_BEGIN_BEGIN_DATE as Da' +
        'te), %MIN_DATE) and Coalesce(Cast(:MIN_PRODUCT_NEED_BEGIN_END_DA' +
        'TE as Date), %MAX_DATE)'
      '        )'
      '      ) and'
      ''
      
        '      (%ML_STATE[s~ml] between :MIN_ML_STATE_CODE and :MAX_ML_ST' +
        'ATE_CODE) and'
      ''
      '      ( ( (:HAS_REQUESTED_CHANGES = 1) and'
      '          (:HAS_NOT_REQUESTED_CHANGES = 1)'
      '        ) or'
      '        ( (:HAS_REQUESTED_CHANGES = 1) and'
      '          (exists'
      '            ( select'
      '                1'
      '              from'
      '                MATERIAL_LIST_LINES mll,'
      '                MATERIAL_LIST_LINE_CHANGES mllc'
      '              where'
      
        '                (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH' +
        '_CODE) and'
      '                (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '                (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BR' +
        'ANCH_CODE) and'
      '                (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '                (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '                (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '                (mllc.REPLY_EMPLOYEE_CODE is null)'
      '            )'
      '          )'
      '        ) or'
      '        ( (:HAS_NOT_REQUESTED_CHANGES = 1) and'
      '          (not exists'
      '            ( select'
      '                1'
      '              from'
      '                MATERIAL_LIST_LINES mll,'
      '                MATERIAL_LIST_LINE_CHANGES mllc'
      '              where'
      
        '                (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH' +
        '_CODE) and'
      '                (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '                (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BR' +
        'ANCH_CODE) and'
      '                (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '                (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '                (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '                (mllc.REPLY_EMPLOYEE_CODE is null)'
      '            )'
      '          )'
      '        )'
      '      ) and'
      ''
      '      ( ( (:HAS_REQUESTED_MY_CHANGES = 1) and'
      '          (:HAS_NOT_REQUESTED_MY_CHANGES = 1)'
      '        ) or'
      '        ( (:HAS_REQUESTED_MY_CHANGES = 1) and'
      '          (exists'
      '            ( select'
      '                1'
      '              from'
      '                MATERIAL_LIST_LINES mll,'
      '                MATERIAL_LIST_LINE_CHANGES mllc'
      '              where'
      
        '                (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH' +
        '_CODE) and'
      '                (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '                (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BR' +
        'ANCH_CODE) and'
      '                (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '                (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '                (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '                (mllc.REPLY_EMPLOYEE_CODE is null) and'
      '                (mllc.REQUEST_EMPLOYEE_CODE = :USER_CODE)'
      '            )'
      '          )'
      '        ) or'
      '        ( (:HAS_NOT_REQUESTED_MY_CHANGES = 1) and'
      '          (not exists'
      '            ( select'
      '                1'
      '              from'
      '                MATERIAL_LIST_LINES mll,'
      '                MATERIAL_LIST_LINE_CHANGES mllc'
      '              where'
      
        '                (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH' +
        '_CODE) and'
      '                (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '                (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BR' +
        'ANCH_CODE) and'
      '                (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '                (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '                (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '                (mllc.REPLY_EMPLOYEE_CODE is null) and'
      '                (mllc.REQUEST_EMPLOYEE_CODE = :USER_CODE)'
      '            )'
      '          )'
      '        )'
      '      ) and'
      ''
      '      ( ( (:HAS_REJECTED_CHANGES = 1) and'
      '          (:HAS_NOT_REJECTED_CHANGES = 1)'
      '        ) or'
      '        ( (:HAS_REJECTED_CHANGES = 1) and'
      '          (exists'
      '            ( select'
      '                1'
      '              from'
      '                MATERIAL_LIST_LINES mll,'
      '                MATERIAL_LIST_LINE_CHANGES mllc'
      '              where'
      
        '                (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH' +
        '_CODE) and'
      '                (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '                (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BR' +
        'ANCH_CODE) and'
      '                (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '                (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '                (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '                (mllc.MLL_CHANGE_REPLY_TYPE_CODE = 2)'
      '            )'
      '          )'
      '        ) or'
      '        ( (:HAS_NOT_REJECTED_CHANGES = 1) and'
      '          (not exists'
      '            ( select'
      '                1'
      '              from'
      '                MATERIAL_LIST_LINES mll,'
      '                MATERIAL_LIST_LINE_CHANGES mllc'
      '              where'
      
        '                (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH' +
        '_CODE) and'
      '                (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '                (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BR' +
        'ANCH_CODE) and'
      '                (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '                (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '                (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '                (mllc.MLL_CHANGE_REPLY_TYPE_CODE = 2)'
      '            )'
      '          )'
      '        )'
      '      ) and'
      ''
      '      ( ( (:HAS_REJECTED_MY_CHANGES = 1) and'
      '          (:HAS_NOT_REJECTED_MY_CHANGES = 1)'
      '        ) or'
      '        ( (:HAS_REJECTED_MY_CHANGES = 1) and'
      '          (exists'
      '            ( select'
      '                1'
      '              from'
      '                MATERIAL_LIST_LINES mll,'
      '                MATERIAL_LIST_LINE_CHANGES mllc'
      '              where'
      
        '                (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH' +
        '_CODE) and'
      '                (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '                (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BR' +
        'ANCH_CODE) and'
      '                (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '                (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '                (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '                (mllc.MLL_CHANGE_REPLY_TYPE_CODE = 2) and'
      '                (mllc.REQUEST_EMPLOYEE_CODE = :USER_CODE)'
      '            )'
      '          )'
      '        ) or'
      '        ( (:HAS_NOT_REJECTED_MY_CHANGES = 1) and'
      '          (not exists'
      '            ( select'
      '                1'
      '              from'
      '                MATERIAL_LIST_LINES mll,'
      '                MATERIAL_LIST_LINE_CHANGES mllc'
      '              where'
      
        '                (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH' +
        '_CODE) and'
      '                (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      
        '                (mll.MLL_OBJECT_BRANCH_CODE = mllc.MLL_OBJECT_BR' +
        'ANCH_CODE) and'
      '                (mll.MLL_OBJECT_CODE = mllc.MLL_OBJECT_CODE) and'
      ''
      '                (mllc.REPLY_ACCEPT_EMPLOYEE_CODE is null) and'
      '                (mll.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '                (mllc.MLL_CHANGE_REPLY_TYPE_CODE = 2) and'
      '                (mllc.REQUEST_EMPLOYEE_CODE = :USER_CODE)'
      '            )'
      '          )'
      '        )'
      '      ) and'
      ''
      '      ( ( select'
      '            p.PRIORITY_NO'
      '          from'
      '            SALE_GROUPS sg,'
      '            PRIORITIES p'
      '          where'
      
        '            (sg.SALE_GROUP_OBJECT_BRANCH_CODE = s.SALE_GROUP_OBJ' +
        'ECT_BRANCH_CODE) and'
      
        '            (sg.SALE_GROUP_OBJECT_CODE = s.SALE_GROUP_OBJECT_COD' +
        'E) and'
      '            (p.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '        ) between'
      '          Coalesce('
      '            ( select'
      '                Max(p.PRIORITY_NO)'
      '              from'
      '                PRIORITIES p'
      '              where'
      '                (p.PRIORITY_CODE = :BEGIN_PRIORITY_CODE)'
      '            ), 0) and'
      '          Coalesce('
      '            ( select'
      '                Max(p.PRIORITY_NO)'
      '              from'
      '                PRIORITIES p'
      '              where'
      '                (p.PRIORITY_CODE = :END_PRIORITY_CODE)'
      '            ), 1000000)'
      '      ) and'
      ''
      '      ( (:IS_WASTE_COMPENSATOR_STATUS = 1) or'
      ''
      '        ( (:IS_WASTE_COMPENSATOR_STATUS = 2) and'
      '          (s.WASTING_SALE_OBJ_BRANCH_CODE is null)'
      '        ) or'
      ''
      '        ( (:IS_WASTE_COMPENSATOR_STATUS = 3) and'
      '          (s.WASTING_SALE_OBJ_BRANCH_CODE is not null)'
      '        )'
      '      ) and'
      ''
      '      ( (:HAS_WASTE_STATUS = 1) or'
      '        ( ( select'
      '              3 - Sign(Count(*))'
      '            from'
      '              MATERIAL_LIST_LINES mll2,'
      '              ML_MODEL_STAGES mlms,'
      '              MODEL_MOVEMENTS mm'
      '            where'
      
        '              (ml.ML_OBJECT_BRANCH_CODE = mll2.ML_OBJECT_BRANCH_' +
        'CODE) and'
      '              (ml.ML_OBJECT_CODE = mll2.ML_OBJECT_CODE) and'
      ''
      
        '              (mll2.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_BRA' +
        'NCH_CODE) and'
      '              (mll2.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) and'
      ''
      
        '              (mlms.MLMS_OBJECT_BRANCH_CODE = mm.FROM_MLMS_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '              (mlms.MLMS_OBJECT_CODE = mm.FROM_MLMS_OBJECT_CODE)' +
        ' and'
      ''
      '              (mm.TO_DEPT_CODE is not null) and'
      '              (mm.STORNO_EMPLOYEE_CODE is null)'
      '          ) = :HAS_WASTE_STATUS'
      '        )'
      '      ) and'
      ''
      '      -- IS_SALE_STATE>> 0-vsichki 1-pp 2-op'
      '      ( (:IS_SALE_STATE = 0) or'
      '        ( (:IS_SALE_STATE = 1) and'
      '          (s.SALE_ORDER_TYPE_CODE = 1) and'
      ''
      '          ( (:OWNER_COMPANY_CODE is null) or'
      '            (:OWNER_COMPANY_CODE = s.CLIENT_COMPANY_CODE) ) and'
      ''
      '          ( (:SALE_SHIPMENT_BEGIN_DATE is null) or'
      '            (s.SHIPMENT_DATE >= :SALE_SHIPMENT_BEGIN_DATE) ) and'
      ''
      '          ( (:SALE_SHIPMENT_END_DATE is null) or'
      '            (s.SHIPMENT_DATE <= :SALE_SHIPMENT_END_DATE) )'
      '        ) or'
      '        ( (:IS_SALE_STATE = 2) and'
      '          (s.SALE_ORDER_TYPE_CODE = 3) and'
      ''
      '          ( (:OWNER_EMPLOYEE_CODE is null) or'
      '            (:OWNER_EMPLOYEE_CODE = s.MANAGER_EMPLOYEE_CODE) )'
      '        )'
      '      ) and'
      ''
      '      ( (:MODEL_DEVELOPMENT_TYPE_CODE is null) or'
      
        '        (s.MODEL_DEVELOPMENT_TYPE_CODE = :MODEL_DEVELOPMENT_TYPE' +
        '_CODE)'
      '      ) and'
      ''
      '      ( (:MIN_LIMITING_DATE_DIFF is null) or'
      '        ( ( Nvl2('
      '              ml.LIMITING_EMPLOYEE_CODE,'
      '              null,'
      '              %COUNT_WORKDAYS['
      '                ContextDate~'
      
        '                %ML_MIN_PRODUCT_NEED_DATE[ml.ML_OBJECT_BRANCH_CO' +
        'DE~ ml.ML_OBJECT_CODE]'
      '              ]'
      
        '            ) - (select co.ML_LIMITING_WORKDAYS from COMMON_OPTI' +
        'ONS co where (co.CODE = 1))'
      '          ) >= :MIN_LIMITING_DATE_DIFF)'
      '      ) and'
      ''
      '      ( (:MAX_LIMITING_DATE_DIFF is null) or'
      '        ( ( Nvl2('
      '              ml.LIMITING_EMPLOYEE_CODE,'
      '              null,'
      '              %COUNT_WORKDAYS['
      '                ContextDate~'
      
        '                %ML_MIN_PRODUCT_NEED_DATE[ml.ML_OBJECT_BRANCH_CO' +
        'DE~ ml.ML_OBJECT_CODE]'
      '              ]'
      
        '            ) - (select co.ML_LIMITING_WORKDAYS from COMMON_OPTI' +
        'ONS co where (co.CODE = 1))'
      '          ) <= :MAX_LIMITING_DATE_DIFF)'
      '      ) and'
      '      %IF_IS_ACTIVE and'
      '      %IF_IS_UNARCHIVED_MODEL'
      '    )'
      '  )'
      '')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'GET_SALE_OBJECT_TREE'
        ParamType = ptInput
        Value = '0'
      end
      item
        DataType = ftWideString
        Name = 
          'PRODUCT_COMPANY_PRODUCT_NAMES_FROM_PRODUCTS[s.PRODUCT_CODE~s.CLI' +
          'ENT_COMPANY_CODE~p]'
        ParamType = ptInput
        Value = #39'a'#39
      end
      item
        DataType = ftWideString
        Name = 
          'ML_MIN_PRODUCT_NEED_DATE[ml.ML_OBJECT_BRANCH_CODE~ ml.ML_OBJECT_' +
          'CODE]'
        ParamType = ptInput
        Value = 'ContextDate'
      end
      item
        DataType = ftWideString
        Name = 
          'COUNT_WORKDAYS['#13#10'    %ML_MIN_PRODUCT_NEED_DATE[ml.ML_OBJECT_BRAN' +
          'CH_CODE~ ml.ML_OBJECT_CODE]~'#13#10'    ml.ENTER_RESULT_STORE_END_DATE' +
          #13#10'  ]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 
          'COUNT_WORKDAYS['#13#10'        ContextDate~'#13#10'        %ML_MIN_PRODUCT_N' +
          'EED_DATE[ml.ML_OBJECT_BRANCH_CODE~ ml.ML_OBJECT_CODE]'#13#10'      ]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 'ML_STATE[s~ml]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 
          'SPEC_STATE[p.PRODUCT_CODE~ (s.MANUFACTURE_QUANTITY * p.TECH_MEAS' +
          'URE_COEF)~ s.PRODUCTION_DEPT_CODE~ s.ENTER_SH_STORE_PLAN_END_DAT' +
          'E~ null]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[s]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[p]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 'MODEL_OPERATIONS_STATUS[ml]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 'SALES_TABLE_OR_TREE'
        ParamType = ptInput
        Value = 'SALES'
      end
      item
        DataType = ftWideString
        Name = 'MIN_DATE'
        ParamType = ptInput
        Value = 'ContextDate'
      end
      item
        DataType = ftWideString
        Name = 'MAX_DATE'
        ParamType = ptInput
        Value = 'ContextDate'
      end
      item
        DataType = ftWideString
        Name = 
          'COUNT_WORKDAYS['#13#10'                ContextDate~'#13#10'                %' +
          'ML_MIN_PRODUCT_NEED_DATE[ml.ML_OBJECT_BRANCH_CODE~ ml.ML_OBJECT_' +
          'CODE]'#13#10'              ]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 'IF_IS_ACTIVE'
        ParamType = ptInput
        Value = '(1=1)'
      end
      item
        DataType = ftWideString
        Name = 'IF_IS_UNARCHIVED_MODEL'
        ParamType = ptInput
        Value = '(1=1)'
      end>
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftFloat
        Name = 'MIN_SPEC_STATE_CODE'
        ParamType = ptInput
        Value = 0
      end
      item
        DataType = ftFloat
        Name = 'MAX_SPEC_STATE_CODE'
        ParamType = ptInput
        Value = '6'
      end
      item
        DataType = ftWideString
        Name = 'CHOSEN_PRODUCTS'
        ParamType = ptInput
        Size = 4000
      end
      item
        DataType = ftFloat
        Name = 'GET_SALE_OBJECT_TREE'
        ParamType = ptUnknown
        Value = '0'
      end>
    Left = 24
    Top = 56
    object qryModelsPROCESS_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'PROCESS_OBJECT_BRANCH_CODE'
    end
    object qryModelsPROCESS_OBJECT_CODE: TAbmesFloatField
      FieldName = 'PROCESS_OBJECT_CODE'
    end
    object qryModelsSALE_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'SALE_OBJECT_BRANCH_CODE'
    end
    object qryModelsSALE_OBJECT_CODE: TAbmesFloatField
      FieldName = 'SALE_OBJECT_CODE'
    end
    object qryModelsSALE_ORDER_TYPE_CODE: TAbmesFloatField
      FieldName = 'SALE_ORDER_TYPE_CODE'
    end
    object qryModelsIS_SALE: TAbmesFloatField
      FieldName = 'IS_SALE'
    end
    object qryModelsPRODUCT_CODE: TAbmesFloatField
      FieldName = 'PRODUCT_CODE'
    end
    object qryModelsPRODUCT_NAME: TAbmesWideStringField
      FieldName = 'PRODUCT_NAME'
      Size = 100
    end
    object qryModelsPRODUCT_NO: TAbmesFloatField
      FieldName = 'PRODUCT_NO'
    end
    object qryModelsCLIENT_REQUEST_NO: TAbmesWideStringField
      FieldName = 'CLIENT_REQUEST_NO'
      Size = 50
    end
    object qryModelsCLIENT_PRODUCT_NAME: TAbmesWideStringField
      FieldName = 'CLIENT_PRODUCT_NAME'
      Size = 250
    end
    object qryModelsMANUFACTURE_QUANTITY: TAbmesFloatField
      FieldName = 'MANUFACTURE_QUANTITY'
    end
    object qryModelsENGINEER_EMPLOYEE_CODE: TAbmesFloatField
      FieldName = 'ENGINEER_EMPLOYEE_CODE'
    end
    object qryModelsENGINEER_EMPLOYEE_ABBREV: TAbmesWideStringField
      FieldName = 'ENGINEER_EMPLOYEE_ABBREV'
      Size = 49
    end
    object qryModelsIS_ANNULED: TAbmesFloatField
      FieldName = 'IS_ANNULED'
    end
    object qryModelsIS_FINISHED: TAbmesFloatField
      FieldName = 'IS_FINISHED'
    end
    object qryModelsML_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_BRANCH_CODE'
    end
    object qryModelsML_OBJECT_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_CODE'
    end
    object qryModelsMAIN_DEPT_CODE: TAbmesFloatField
      FieldName = 'MAIN_DEPT_CODE'
    end
    object qryModelsMAIN_DEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'MAIN_DEPT_IDENTIFIER'
      Size = 46
    end
    object qryModelsIS_LIMITING: TAbmesFloatField
      FieldName = 'IS_LIMITING'
    end
    object qryModelsENTER_RESULT_STORE_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'ENTER_RESULT_STORE_END_DATE'
    end
    object qryModelsMIN_PRODUCT_NEED_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'MIN_PRODUCT_NEED_BEGIN_DATE'
    end
    object qryModelsMANUFACTURE_DAYS: TAbmesFloatField
      FieldName = 'MANUFACTURE_DAYS'
    end
    object qryModelsIS_ARCHIVED: TAbmesFloatField
      FieldName = 'IS_ARCHIVED'
    end
    object qryModelsREQUESTED_CHANGE_COUNT: TAbmesFloatField
      FieldName = 'REQUESTED_CHANGE_COUNT'
    end
    object qryModelsREQUESTED_MY_CHANGE_COUNT: TAbmesFloatField
      FieldName = 'REQUESTED_MY_CHANGE_COUNT'
    end
    object qryModelsREJECTED_CHANGE_COUNT: TAbmesFloatField
      FieldName = 'REJECTED_CHANGE_COUNT'
    end
    object qryModelsREJECTED_MY_CHANGE_COUNT: TAbmesFloatField
      FieldName = 'REJECTED_MY_CHANGE_COUNT'
    end
    object qryModelsCURRENT_TO_LIMITING_DATE_DIFF: TAbmesFloatField
      FieldName = 'CURRENT_TO_LIMITING_DATE_DIFF'
    end
    object qryModelsML_STATE_CODE: TAbmesFloatField
      FieldName = 'ML_STATE_CODE'
    end
    object qryModelsSPEC_STATE_CODE: TAbmesFloatField
      FieldName = 'SPEC_STATE_CODE'
    end
    object qryModelsDEL_RECORD: TAbmesFloatField
      FieldName = 'DEL_RECORD'
    end
    object qryModelsMEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'MEASURE_ABBREV'
      Size = 5
    end
    object qryModelsACCOUNT_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'ACCOUNT_MEASURE_ABBREV'
      Size = 5
    end
    object qryModelsMEASURE_CODE: TAbmesFloatField
      FieldName = 'MEASURE_CODE'
    end
    object qryModelsACCOUNT_MEASURE_CODE: TAbmesFloatField
      FieldName = 'ACCOUNT_MEASURE_CODE'
    end
    object qryModelsPRIORITY_CODE: TAbmesFloatField
      FieldName = 'PRIORITY_CODE'
    end
    object qryModelsPRIORITY_NO: TAbmesFloatField
      FieldName = 'PRIORITY_NO'
    end
    object qryModelsPRIORITY_FULL_NAME: TAbmesWideStringField
      FieldName = 'PRIORITY_FULL_NAME'
      Size = 93
    end
    object qryModelsWORK_PRIORITY_NO: TAbmesFloatField
      FieldName = 'WORK_PRIORITY_NO'
    end
    object qryModelsWORK_PRIORITY_FULL_NAME: TAbmesWideStringField
      FieldName = 'WORK_PRIORITY_FULL_NAME'
      Size = 93
    end
    object qryModelsSALE_IDENTIFICATION: TAbmesWideStringField
      FieldName = 'SALE_IDENTIFICATION'
      Size = 188
    end
    object qryModelsIS_WASTE_COMPENSATOR: TAbmesFloatField
      FieldName = 'IS_WASTE_COMPENSATOR'
    end
    object qryModelsHAS_WASTE: TAbmesFloatField
      FieldName = 'HAS_WASTE'
    end
    object qryModelsOWNER_NAME: TAbmesWideStringField
      FieldName = 'OWNER_NAME'
      Size = 41
    end
    object qryModelsCONSUMER_DEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'CONSUMER_DEPT_IDENTIFIER'
      Size = 46
    end
    object qryModelsDOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DOC_BRANCH_CODE'
    end
    object qryModelsDOC_CODE: TAbmesFloatField
      FieldName = 'DOC_CODE'
    end
    object qryModelsHAS_DOC_ITEMS: TAbmesFloatField
      FieldName = 'HAS_DOC_ITEMS'
    end
    object qryModelsPRODUCT_HAS_DOC_ITEMS: TAbmesFloatField
      FieldName = 'PRODUCT_HAS_DOC_ITEMS'
    end
    object qryModelsMODEL_OPERATIONS_STATUS_CODE: TAbmesFloatField
      FieldName = 'MODEL_OPERATIONS_STATUS_CODE'
    end
    object qryModelsHAS_WASTE_COMPENSATORS: TAbmesFloatField
      FieldName = 'HAS_WASTE_COMPENSATORS'
      ProviderFlags = []
    end
    object qryModelsMODEL_DEVELOPMENT_TYPE_CODE: TAbmesFloatField
      FieldName = 'MODEL_DEVELOPMENT_TYPE_CODE'
      Required = True
    end
    object qryModelsMODEL_DEVELOPMENT_TYPE_ABBREV: TAbmesWideStringField
      FieldName = 'MODEL_DEVELOPMENT_TYPE_ABBREV'
      Size = 100
    end
    object qryModelsSALE_OBJECT_PK: TAbmesWideStringField
      FieldName = 'SALE_OBJECT_PK'
      Size = 81
    end
    object qryModelsWASTING_SALE_OBJ_PK: TAbmesWideStringField
      FieldName = 'WASTING_SALE_OBJ_PK'
      Size = 81
    end
  end
  object prvModels: TDataSetProvider
    DataSet = qryModels
    OnGetData = prvModelsGetData
    BeforeUpdateRecord = prvModelsBeforeUpdateRecord
    Left = 24
    Top = 8
  end
  object qryDelModel: TAbmesSQLQuery
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'ML_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'ML_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'begin'
      
        '  ModelUtils.DeleteXModel(:ML_OBJECT_BRANCH_CODE, :ML_OBJECT_COD' +
        'E);'
      'end;')
    SQLConnection = SQLConn
    Macros = <>
    MacroParams = <>
    CustomParams = <>
    Left = 24
    Top = 128
  end
  object prvOneMLMS: TDataSetProvider
    DataSet = qryOneMLMS
    UpdateMode = upWhereKeyOnly
    Left = 48
    Top = 208
  end
  object qryOneMLMSOperations: TAbmesSQLQuery
    OnCalcFields = qryOneMLMSOperationsCalcFields
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_BRANCH_CODE'
        ParamType = ptInput
        Size = 8
      end
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_CODE'
        ParamType = ptInput
        Size = 8
      end>
    SQL.Strings = (
      'select'
      '  mlmso.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso.MLMSO_OBJECT_CODE,'
      '  mlmso.MLMS_OBJECT_BRANCH_CODE,'
      '  mlmso.MLMS_OBJECT_CODE,'
      '  mlmso.MLMS_OPERATION_NO,'
      '  mlmso.MLMS_OPERATION_VARIANT_NO,'
      '  mlmso.OPERATION_TYPE_CODE,'
      ''
      '  mlms.ML_MODEL_STAGE_NO,'
      
        '  (mlmso.MLMS_OPERATION_NO || '#39'.'#39' || mlmso.MLMS_OPERATION_VARIAN' +
        'T_NO) as SHOW_NO,'
      ''
      '  mlms.IS_AUTO_MOVEMENT,'
      '  Decode(mlmso.OPERATION_TYPE_CODE,'
      '    1, %IS_AUTO_RECEIVING_STAGE[mlms],'
      '    0'
      '  ) as IS_AUTO_RECEIVING_OPERATION,'
      ''
      '  %HAS_DOC_ITEMS[mlmso] as HAS_DOCUMENTATION,'
      ''
      '  mlmso.DEPT_CODE,'
      ''
      '  ('
      '    select'
      '      d.NAME'
      '    from'
      '      DEPTS d'
      '    where'
      '      (d.DEPT_CODE = mlmso.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      ''
      '  ( select'
      '      (dt.DEPT_TYPE_ABBREV || d.CUSTOM_CODE || d.SUFFIX_LETTER)'
      '    from'
      '      DEPTS d,'
      '      DEPT_TYPES dt'
      '    where'
      '      (d.DEPT_CODE = mlmso.DEPT_CODE) and'
      '      (d.DEPT_TYPE_CODE = dt.DEPT_TYPE_CODE(+))'
      '  ) as DEPT_IDENTIFIER,'
      ''
      '  mlmso.SETUP_PROFESSION_CODE,'
      ''
      '  ( select'
      '      p.PROFESSION_NAME'
      '    from'
      '      PROFESSIONS p'
      '    where'
      '      (p.PROFESSION_CODE = mlmso.SETUP_PROFESSION_CODE)'
      '  ) as SETUP_PROFESSION_NAME,'
      ''
      '  ( select'
      '      p.PROFESSION_NAME'
      '    from'
      '      PROFESSIONS p'
      '    where'
      '      (p.PROFESSION_CODE = mlmso.PROFESSION_CODE)'
      '  ) as PROFESSION_NAME,'
      ''
      '  mlmso.SETUP_EFFORT_COEF,'
      ''
      '  Coalesce('
      '    ( select'
      '        pper.HOUR_PRICE'
      '      from'
      '        PROFESSION_PERIODS pper'
      '      where'
      '        (pper.PROFESSION_CODE = mlmso.SETUP_PROFESSION_CODE) and'
      
        '        (Coalesce(mlmso.SETUP_DATE, Greatest(mlmso.TREATMENT_BEG' +
        'IN_DATE, ContextDate)) between pper.BEGIN_DATE and pper.END_DATE' +
        ')'
      '    ),'
      '    0'
      '  ) as SETUP_HOUR_PRICE,'
      ''
      '  mlmso.SETUP_HOUR_TECH_QUANTITY,'
      ''
      '  mlmso.EFFORT_COEF,'
      ''
      '  Coalesce('
      '    ( select'
      '        pper.HOUR_PRICE'
      '      from'
      '        PROFESSION_PERIODS pper'
      '      where'
      '        (pper.PROFESSION_CODE = mlmso.PROFESSION_CODE) and'
      '        ( Decode('
      '            Sign('
      '              mlmso.VARIANT_DETAIL_TECH_QUANTITY'
      '              -'
      '              MiscUtils.LargeZero('
      
        '                Greatest( -- ostavasht za razpredeliane brak ot ' +
        'predhodni operacii sled kato e razpredelen po sledvashtite varia' +
        'nti na nashata operacia'
      '                  0,'
      '                  ('
      
        '                    ( -- brak po predhodinte operacii i etapi ot' +
        ' toia red'
      '                      select'
      
        '                        Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTI' +
        'TY), 0)'
      '                      from'
      '                        ML_MODEL_STAGES mlms2,'
      '                        MLMS_OPERATIONS mlmso2,'
      '                        OPERATION_MOVEMENTS om'
      '                      where'
      
        '                        (mlms2.MLL_OBJECT_BRANCH_CODE = mll.MLL_' +
        'OBJECT_BRANCH_CODE) and'
      
        '                        (mlms2.MLL_OBJECT_CODE = mll.MLL_OBJECT_' +
        'CODE) and'
      ''
      
        '                        (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.' +
        'MLMS_OBJECT_BRANCH_CODE) and'
      
        '                        (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OB' +
        'JECT_CODE) and'
      ''
      
        '                        (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlms' +
        'o2.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                        (om.FROM_MLMSO_OBJECT_CODE = mlmso2.MLMS' +
        'O_OBJECT_CODE) and'
      ''
      '                        (om.STORNO_EMPLOYEE_CODE is null) and'
      '                        (om.TO_DEPT_CODE is not null) and'
      ''
      
        '                        ( (mlms2.ML_MODEL_STAGE_NO < mlms.ML_MOD' +
        'EL_STAGE_NO) or'
      
        '                          ( (mlms2.ML_MODEL_STAGE_NO = mlms.ML_M' +
        'ODEL_STAGE_NO) and'
      
        '                            (mlmso2.MLMS_OPERATION_NO < mlmso.ML' +
        'MS_OPERATION_NO)'
      '                          )'
      '                        )'
      '                    )'
      '                    -'
      
        '                    ( -- ostavashto za vlizane po sledvashtite v' +
        'ariatni na nashata operacia'
      '                      select'
      '                        Coalesce('
      '                          Sum('
      '                            mlmso2.VARIANT_DETAIL_TECH_QUANTITY'
      '                            -'
      
        '                            ( -- vliazlo v operaciata mlmso2 ot ' +
        'drugi operacii'
      '                              select'
      
        '                                Coalesce(Sum(om.TOTAL_DETAIL_TEC' +
        'H_QUANTITY), 0)'
      '                              from'
      '                                OPERATION_MOVEMENTS om'
      '                              where'
      
        '                                (om.TO_MLMSO_OBJECT_BRANCH_CODE ' +
        '= mlmso2.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                                (om.TO_MLMSO_OBJECT_CODE = mlmso' +
        '2.MLMSO_OBJECT_CODE) and'
      
        '                                (om.STORNO_EMPLOYEE_CODE is null' +
        ') and'
      '                                (om.TO_DEPT_CODE is null) and'
      '                                (not'
      
        '                                  ( (om.FROM_MLMSO_OBJECT_BRANCH' +
        '_CODE = mlmso2.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                                    (om.FROM_MLMSO_OBJECT_CODE =' +
        ' mlmso2.MLMSO_OBJECT_CODE)'
      '                                  )'
      '                                )'
      '                            )'
      '                          ),'
      '                          0'
      '                        )'
      '                      from'
      '                        MLMS_OPERATIONS mlmso2'
      '                      where'
      
        '                        (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlmso.' +
        'MLMS_OBJECT_BRANCH_CODE) and'
      
        '                        (mlmso2.MLMS_OBJECT_CODE = mlmso.MLMS_OB' +
        'JECT_CODE) and'
      
        '                        (mlmso2.MLMS_OPERATION_NO = mlmso.MLMS_O' +
        'PERATION_NO) and'
      
        '                        (mlmso2.MLMS_OPERATION_VARIANT_NO > mlms' +
        'o.MLMS_OPERATION_VARIANT_NO)'
      '                    )'
      '                  )'
      '                )'
      '              )'
      '              -'
      '              MiscUtils.LargeZero('
      
        '                ( -- izliazlo ot nashata operacia za drugi opera' +
        'cii ili brak'
      '                  select'
      
        '                    Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY),' +
        ' 0)'
      '                  from'
      '                    OPERATION_MOVEMENTS om'
      '                  where'
      
        '                    (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso.ML' +
        'MSO_OBJECT_BRANCH_CODE) and'
      
        '                    (om.FROM_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJ' +
        'ECT_CODE) and'
      '                    (om.STORNO_EMPLOYEE_CODE is null) and'
      ''
      '                    ( (om.TO_DEPT_CODE is not null) or'
      '                      (not'
      
        '                        ( (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlms' +
        'o.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                          (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO' +
        '_OBJECT_CODE)'
      '                        )'
      '                      )'
      '                    )'
      '                )'
      '              )'
      '            ),'
      
        '            1, Greatest(mlmso.TREATMENT_BEGIN_DATE, ContextDate)' +
        ',   -- ostava oshte za predavane'
      '            ( select'
      '                Max(om.OM_DATE)'
      '              from'
      '                OPERATION_MOVEMENTS om'
      '              where'
      
        '                (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_' +
        'OBJECT_BRANCH_CODE) and'
      
        '                (om.FROM_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_' +
        'CODE) and'
      '                (om.STORNO_EMPLOYEE_CODE is null) and'
      ''
      '                ( (om.TO_DEPT_CODE is not null) or'
      '                  (not'
      
        '                    ( (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.ML' +
        'MSO_OBJECT_BRANCH_CODE) and'
      
        '                      (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJ' +
        'ECT_CODE)'
      '                    )'
      '                  )'
      '                )'
      '            )                 '
      '          ) between pper.BEGIN_DATE and pper.END_DATE'
      '        )'
      '    ),'
      '    0'
      '  ) as HOUR_PRICE,'
      ''
      '  mlmso.HOUR_TECH_QUANTITY,'
      '  '
      '  mlmso.PROGRAM_TOOL_PRODUCT_CODE,'
      '  mlmso.SPECIFIC_TOOL_PRODUCT_CODE,'
      '  mlmso.TYPICAL_TOOL_PRODUCT_CODE,'
      ''
      '  mlmso.PROGRAM_TOOL_REQUIREMENT_CODE,'
      '  mlmso.SPECIFIC_TOOL_REQUIREMENT_CODE,'
      '  mlmso.TYPICAL_TOOL_REQUIREMENT_CODE,'
      ''
      '  mlmso.PROGRAM_TOOL_IS_COMPLETE,'
      '  mlmso.SPECIFIC_TOOL_IS_COMPLETE,'
      '  mlmso.TYPICAL_TOOL_IS_COMPLETE,'
      ''
      '  mlmso.NOTES,'
      '  mlmso.HAS_SPECIAL_CONTROL,'
      ''
      '  mlmso.VARIANT_DETAIL_TECH_QUANTITY,'
      ''
      '  Nvl2(mlmso.SETUP_DATE, 1, 0) as IS_SETUP_DONE,'
      ''
      '  case'
      '    when (mlmso.SETUP_DATE is not null) then'
      '      (mlmso.DONE_SETUP_COUNT / mlmso.SETUP_HOUR_TECH_QUANTITY)'
      '  else'
      '    0'
      '  end as SETUP_WORK_TIME,'
      ''
      '  ModelUtils.GetMlmsoRcvdForDetailTechQty('
      '    mlmso.MLMSO_OBJECT_BRANCH_CODE,'
      '    mlmso.MLMSO_OBJECT_CODE,'
      '    ( select'
      '        iv.FEATURE_FLAG_OPERATION_LOADING'
      '      from'
      '        INTERNAL_VALUES iv'
      '      where'
      '        (iv.CODE = 1)'
      '    )'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      ''
      '  ('
      '    select'
      '      Sum(om.TOTAL_DETAIL_TECH_QUANTITY)'
      '    from'
      '      OPERATION_MOVEMENTS om'
      '    where'
      
        '      (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJECT_BRA' +
        'NCH_CODE) and'
      '      (om.FROM_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE) and'
      ''
      '      (om.STORNO_EMPLOYEE_CODE is null) and'
      ''
      '      (om.TO_DEPT_CODE is not null)'
      '  ) as OUT_WASTE_DETAIL_TECH_QUANTITY,'
      ''
      '  ('
      '    select'
      '      Sum(om.TOTAL_DETAIL_TECH_QUANTITY)'
      '    from'
      '      OPERATION_MOVEMENTS om'
      '    where'
      
        '      (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJECT_BRA' +
        'NCH_CODE) and'
      '      (om.FROM_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE) and'
      ''
      '      (om.STORNO_EMPLOYEE_CODE is null) and'
      ''
      
        '      not ( (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJECT' +
        '_BRANCH_CODE) and'
      
        '            (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE) ' +
        ')'
      '  ) as OUT_DETAIL_TECH_QUANTITY,'
      ''
      '  mlmso.DOC_BRANCH_CODE,'
      '  mlmso.DOC_CODE,'
      ''
      '  Decode('
      '    mlms.ML_MODEL_STAGE_NO,'
      '    0,'
      '    To_Number(null),'
      '    NullIf( -- TO_ENTER_DETAIL_TECH_QUANTITY'
      '      Greatest('
      '        0,'
      '        ( mlmso.VARIANT_DETAIL_TECH_QUANTITY'
      '          -'
      '          ModelUtils.GetMlmsoRcvdForDetailTechQty('
      '            mlmso.MLMSO_OBJECT_BRANCH_CODE,'
      '            mlmso.MLMSO_OBJECT_CODE,'
      '            ( select'
      '                iv.FEATURE_FLAG_OPERATION_LOADING'
      '              from'
      '                INTERNAL_VALUES iv'
      '              where'
      '                (iv.CODE = 1)'
      '            )'
      '          )'
      '          -'
      
        '          Greatest( -- ostavasht za razpredeliane brak ot predho' +
        'dni operacii sled kato e razpredelen po sledvashtite varianti na' +
        ' nashata operacia'
      '            0,'
      '            ('
      
        '              ( -- brak po predhodinte operacii i etapi ot toia ' +
        'red'
      '                select'
      
        '                  Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY), 0' +
        ')'
      '                from'
      '                  ML_MODEL_STAGES mlms2,'
      '                  MLMS_OPERATIONS mlmso2,'
      '                  OPERATION_MOVEMENTS om'
      '                where'
      
        '                  (mlms2.MLL_OBJECT_BRANCH_CODE = mll.MLL_OBJECT' +
        '_BRANCH_CODE) and'
      
        '                  (mlms2.MLL_OBJECT_CODE = mll.MLL_OBJECT_CODE) ' +
        'and'
      ''
      
        '                  (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_O' +
        'BJECT_BRANCH_CODE) and'
      
        '                  (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_C' +
        'ODE) and'
      ''
      
        '                  (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLM' +
        'SO_OBJECT_BRANCH_CODE) and'
      
        '                  (om.FROM_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJE' +
        'CT_CODE) and'
      ''
      '                  (om.STORNO_EMPLOYEE_CODE is null) and'
      '                  (om.TO_DEPT_CODE is not null) and'
      ''
      
        '                  ( (mlms2.ML_MODEL_STAGE_NO < mlms.ML_MODEL_STA' +
        'GE_NO) or'
      
        '                    ( (mlms2.ML_MODEL_STAGE_NO = mlms.ML_MODEL_S' +
        'TAGE_NO) and'
      
        '                      (mlmso2.MLMS_OPERATION_NO < mlmso.MLMS_OPE' +
        'RATION_NO)'
      '                    )'
      '                  )'
      '              )'
      '              -'
      
        '              ( -- ostavashto za vlizane po sledvashtite variatn' +
        'i na nashata operacia'
      '                select'
      '                  Coalesce('
      '                    Sum('
      '                      mlmso2.VARIANT_DETAIL_TECH_QUANTITY'
      '                      -'
      
        '                      ( -- vliazlo v operaciata mlmso2 ot drugi ' +
        'operacii'
      '                        select'
      
        '                          Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUAN' +
        'TITY), 0)'
      '                        from'
      '                          OPERATION_MOVEMENTS om'
      '                        where'
      
        '                          (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlms' +
        'o2.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                          (om.TO_MLMSO_OBJECT_CODE = mlmso2.MLMS' +
        'O_OBJECT_CODE) and'
      '                          (om.STORNO_EMPLOYEE_CODE is null) and'
      '                          (om.TO_DEPT_CODE is null) and'
      '                          (not'
      
        '                            ( (om.FROM_MLMSO_OBJECT_BRANCH_CODE ' +
        '= mlmso2.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                              (om.FROM_MLMSO_OBJECT_CODE = mlmso' +
        '2.MLMSO_OBJECT_CODE)'
      '                            )'
      '                          )'
      '                      )'
      '                    ),'
      '                    0'
      '                  )'
      '                from'
      '                  MLMS_OPERATIONS mlmso2'
      '                where'
      
        '                  (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_O' +
        'BJECT_BRANCH_CODE) and'
      
        '                  (mlmso2.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_C' +
        'ODE) and'
      
        '                  (mlmso2.MLMS_OPERATION_NO = mlmso.MLMS_OPERATI' +
        'ON_NO) and'
      
        '                  (mlmso2.MLMS_OPERATION_VARIANT_NO > mlmso.MLMS' +
        '_OPERATION_VARIANT_NO)'
      '              )'
      '            )'
      '          )'
      '        )'
      '      ),'
      '      0'
      '    )'
      '  ) as TO_ENTER_DETAIL_TECH_QUANTITY,'
      ''
      '  Decode('
      '    mlms.ML_MODEL_STAGE_NO,'
      '    0,'
      '    To_Number(null),'
      '    NullIf( -- AVAILABLE_DETAIL_TECH_QUANTITY'
      '      ('
      '        ModelUtils.GetMlmsoRcvdForDetailTechQty('
      '          mlmso.MLMSO_OBJECT_BRANCH_CODE,'
      '          mlmso.MLMSO_OBJECT_CODE,'
      '          ( select'
      '              iv.FEATURE_FLAG_OPERATION_LOADING'
      '            from'
      '              INTERNAL_VALUES iv'
      '            where'
      '              (iv.CODE = 1)'
      '          )'
      '        )'
      '        -'
      
        '        ( -- izliazlo ot nashata operacia za drugi operacii ili ' +
        'brak'
      '          select'
      '            Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '          from'
      '            OPERATION_MOVEMENTS om'
      '          where'
      
        '            (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJE' +
        'CT_BRANCH_CODE) and'
      
        '            (om.FROM_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE' +
        ') and'
      '            (om.STORNO_EMPLOYEE_CODE is null) and'
      ''
      '            ( (om.TO_DEPT_CODE is not null) or'
      '              (not'
      
        '                ( (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_' +
        'OBJECT_BRANCH_CODE) and'
      
        '                  (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_' +
        'CODE)'
      '                )'
      '              )'
      '            )'
      '        )'
      '      ),'
      '      0'
      '    )'
      '  ) as AVAILABLE_DETAIL_TECH_QUANTITY,'
      ''
      '  Decode(mlmso.OPERATION_TYPE_CODE,'
      
        '    2, CapacityUtils.HasMlmsoPlanExcess(mlmso.MLMSO_OBJECT_BRANC' +
        'H_CODE, mlmso.MLMSO_OBJECT_CODE),'
      '    0'
      '  ) as HAS_CAPACITY_DEFICIT,'
      ''
      '  ( case'
      '      when'
      '        (mll.PRODUCT_CODE is null) and'
      '        (mlms.ML_MODEL_STAGE_NO = 1) and'
      '        (not exists'
      '          ( select'
      '              1'
      '            from'
      '              MLMS_OPERATIONS mlmso2'
      '            where'
      
        '              (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '              (mlmso2.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE)' +
        ' and'
      
        '              (mlmso2.MLMS_OPERATION_NO < mlmso.MLMS_OPERATION_N' +
        'O) and'
      '              (mlmso2.OPERATION_TYPE_CODE = 2)'
      '          )'
      '        )'
      '      then'
      '        0'
      '      when'
      '        (mlmso.OPERATION_TYPE_CODE in (1, 3))'
      '      then'
      '        1'
      '    else'
      '      2'
      '    end'
      '  ) as OPERATION_KIND,'
      ''
      '  mlmso.IS_AUTO_SETUP as MLMSO_IS_AUTO_SETUP,'
      '  mlmso.IS_AUTO_MOVEMENT as MLMSO_IS_AUTO_MOVEMENT'
      ''
      'from'
      '  MLMS_OPERATIONS mlmso,'
      '  ML_MODEL_STAGES mlms,'
      '  MATERIAL_LIST_LINES mll'
      ''
      'where'
      
        '  (mlms.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJECT_BRANCH_CODE)' +
        ' and'
      '  (mlms.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE) and'
      ''
      '  (mll.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_BRANCH_CODE) and'
      '  (mll.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) and'
      ''
      '  (mlmso.IS_ACTIVE = 1) and'
      '  (mlmso.MLMS_OPERATION_VARIANT_NO >= 0) and'
      ''
      '  (mlmso.MLMS_OBJECT_BRANCH_CODE = :MLMS_OBJECT_BRANCH_CODE) and'
      '  (mlmso.MLMS_OBJECT_CODE = :MLMS_OBJECT_CODE)'
      ''
      'order by'
      '  mlmso.MLMS_OBJECT_BRANCH_CODE,'
      '  mlmso.MLMS_OBJECT_CODE,'
      '  mlmso.MLMS_OPERATION_NO,'
      '  mlmso.MLMS_OPERATION_VARIANT_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'IS_AUTO_RECEIVING_STAGE[mlms]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[mlmso]'
        ParamType = ptInput
        Value = '1'
      end>
    MacroParams = <>
    CustomParams = <>
    Left = 48
    Top = 360
    object qryOneMLMSOperationsMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOneMLMSOperationsMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOneMLMSOperationsMLMS_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_BRANCH_CODE'
    end
    object qryOneMLMSOperationsMLMS_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_CODE'
    end
    object qryOneMLMSOperationsMLMS_OPERATION_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_NO'
    end
    object qryOneMLMSOperationsMLMS_OPERATION_VARIANT_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_VARIANT_NO'
    end
    object qryOneMLMSOperationsOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryOneMLMSOperationsML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryOneMLMSOperationsSHOW_NO: TAbmesWideStringField
      FieldName = 'SHOW_NO'
      Size = 81
    end
    object qryOneMLMSOperationsIS_AUTO_MOVEMENT: TAbmesFloatField
      FieldName = 'IS_AUTO_MOVEMENT'
    end
    object qryOneMLMSOperationsIS_AUTO_RECEIVING_OPERATION: TAbmesFloatField
      FieldName = 'IS_AUTO_RECEIVING_OPERATION'
    end
    object qryOneMLMSOperationsHAS_DOCUMENTATION: TAbmesFloatField
      FieldName = 'HAS_DOCUMENTATION'
    end
    object qryOneMLMSOperationsDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
    object qryOneMLMSOperationsDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryOneMLMSOperationsDEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'DEPT_IDENTIFIER'
      Size = 16
    end
    object qryOneMLMSOperationsSETUP_PROFESSION_CODE: TAbmesFloatField
      FieldName = 'SETUP_PROFESSION_CODE'
    end
    object qryOneMLMSOperationsSETUP_PROFESSION_NAME: TAbmesWideStringField
      FieldName = 'SETUP_PROFESSION_NAME'
      Size = 100
    end
    object qryOneMLMSOperationsPROFESSION_NAME: TAbmesWideStringField
      FieldName = 'PROFESSION_NAME'
      Size = 100
    end
    object qryOneMLMSOperationsSETUP_EFFORT_COEF: TAbmesFloatField
      FieldName = 'SETUP_EFFORT_COEF'
    end
    object qryOneMLMSOperationsSETUP_HOUR_PRICE: TAbmesFloatField
      FieldName = 'SETUP_HOUR_PRICE'
    end
    object qryOneMLMSOperationsSETUP_HOUR_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'SETUP_HOUR_TECH_QUANTITY'
    end
    object qryOneMLMSOperationsEFFORT_COEF: TAbmesFloatField
      FieldName = 'EFFORT_COEF'
    end
    object qryOneMLMSOperationsHOUR_PRICE: TAbmesFloatField
      FieldName = 'HOUR_PRICE'
    end
    object qryOneMLMSOperationsHOUR_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'HOUR_TECH_QUANTITY'
    end
    object qryOneMLMSOperationsPROGRAM_TOOL_PRODUCT_CODE: TAbmesFloatField
      FieldName = 'PROGRAM_TOOL_PRODUCT_CODE'
    end
    object qryOneMLMSOperationsSPECIFIC_TOOL_PRODUCT_CODE: TAbmesFloatField
      FieldName = 'SPECIFIC_TOOL_PRODUCT_CODE'
    end
    object qryOneMLMSOperationsTYPICAL_TOOL_PRODUCT_CODE: TAbmesFloatField
      FieldName = 'TYPICAL_TOOL_PRODUCT_CODE'
    end
    object qryOneMLMSOperationsNOTES: TAbmesWideStringField
      FieldName = 'NOTES'
      Size = 250
    end
    object qryOneMLMSOperationsVARIANT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'VARIANT_DETAIL_TECH_QUANTITY'
    end
    object qryOneMLMSOperationsIS_SETUP_DONE: TAbmesFloatField
      FieldName = 'IS_SETUP_DONE'
    end
    object qryOneMLMSOperationsSETUP_WORK_TIME: TAbmesFloatField
      FieldName = 'SETUP_WORK_TIME'
    end
    object qryOneMLMSOperationsIN_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'IN_DETAIL_TECH_QUANTITY'
    end
    object qryOneMLMSOperationsOUT_WASTE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OUT_WASTE_DETAIL_TECH_QUANTITY'
    end
    object qryOneMLMSOperationsOUT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OUT_DETAIL_TECH_QUANTITY'
    end
    object qryOneMLMSOperationsDOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DOC_BRANCH_CODE'
    end
    object qryOneMLMSOperationsDOC_CODE: TAbmesFloatField
      FieldName = 'DOC_CODE'
    end
    object qryOneMLMSOperationsWORK_TIME: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'WORK_TIME'
      Calculated = True
    end
    object qryOneMLMSOperationsTO_ENTER_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'TO_ENTER_DETAIL_TECH_QUANTITY'
    end
    object qryOneMLMSOperationsAVAILABLE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'AVAILABLE_DETAIL_TECH_QUANTITY'
    end
    object qryOneMLMSOperationsTO_LEAVE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_LEAVE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryOneMLMSOperationsHAS_SPECIAL_CONTROL: TAbmesFloatField
      FieldName = 'HAS_SPECIAL_CONTROL'
    end
    object qryOneMLMSOperationsHAS_CAPACITY_DEFICIT: TAbmesFloatField
      FieldName = 'HAS_CAPACITY_DEFICIT'
    end
    object qryOneMLMSOperationsOPERATION_KIND: TAbmesFloatField
      FieldName = 'OPERATION_KIND'
    end
    object qryOneMLMSOperationsPROGRAM_TOOL_REQUIREMENT_CODE: TAbmesFloatField
      FieldName = 'PROGRAM_TOOL_REQUIREMENT_CODE'
    end
    object qryOneMLMSOperationsSPECIFIC_TOOL_REQUIREMENT_CODE: TAbmesFloatField
      FieldName = 'SPECIFIC_TOOL_REQUIREMENT_CODE'
    end
    object qryOneMLMSOperationsTYPICAL_TOOL_REQUIREMENT_CODE: TAbmesFloatField
      FieldName = 'TYPICAL_TOOL_REQUIREMENT_CODE'
    end
    object qryOneMLMSOperationsPROGRAM_TOOL_IS_COMPLETE: TAbmesFloatField
      FieldName = 'PROGRAM_TOOL_IS_COMPLETE'
    end
    object qryOneMLMSOperationsSPECIFIC_TOOL_IS_COMPLETE: TAbmesFloatField
      FieldName = 'SPECIFIC_TOOL_IS_COMPLETE'
    end
    object qryOneMLMSOperationsTYPICAL_TOOL_IS_COMPLETE: TAbmesFloatField
      FieldName = 'TYPICAL_TOOL_IS_COMPLETE'
    end
    object qryOneMLMSOperationsMLMSO_IS_AUTO_SETUP: TAbmesFloatField
      FieldName = 'MLMSO_IS_AUTO_SETUP'
      Required = True
    end
    object qryOneMLMSOperationsMLMSO_IS_AUTO_MOVEMENT: TAbmesFloatField
      FieldName = 'MLMSO_IS_AUTO_MOVEMENT'
      Required = True
    end
  end
  object prvNextStageFirstOperation: TDataSetProvider
    DataSet = qryNextStageFirstOperation
    Options = [poReadOnly]
    UpdateMode = upWhereKeyOnly
    Left = 128
    Top = 8
  end
  object qryNextStageFirstOperation: TAbmesSQLQuery
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.OPERATION_TYPE_CODE'
      '  '
      'from'
      '  ML_MODEL_STAGES mlms,'
      '  MATERIAL_LIST_LINES mll,'
      '  ML_MODEL_STAGES next_mlms,'
      '  ML_MODEL_STAGES mlms2,'
      '  MLMS_OPERATIONS mlmso2'
      ''
      'where'
      '  (mlms.MLL_OBJECT_BRANCH_CODE = mll.MLL_OBJECT_BRANCH_CODE) and'
      '  (mlms.MLL_OBJECT_CODE = mll.MLL_OBJECT_CODE) and'
      ''
      
        '  (mll.MLL_OBJECT_BRANCH_CODE = next_mlms.MLL_OBJECT_BRANCH_CODE' +
        ') and'
      '  (mll.MLL_OBJECT_CODE = next_mlms.MLL_OBJECT_CODE) and'
      '  (mlms.ML_MODEL_STAGE_NO + 1 = next_mlms.ML_MODEL_STAGE_NO) and'
      ''
      '  (mlms2.MLL_OBJECT_BRANCH_CODE ='
      
        '    Decode(next_mlms.TREATMENT_WORKDAYS, 0, mll.PARENT_MLL_OBJEC' +
        'T_BRANCH_CODE, mll.MLL_OBJECT_BRANCH_CODE)) and'
      '  (mlms2.MLL_OBJECT_CODE ='
      
        '    Decode(next_mlms.TREATMENT_WORKDAYS, 0, mll.PARENT_MLL_OBJEC' +
        'T_CODE, mll.MLL_OBJECT_CODE)) and'
      '  (mlms2.ML_MODEL_STAGE_NO ='
      
        '    Decode(next_mlms.TREATMENT_WORKDAYS, 0, 1, mlms.ML_MODEL_STA' +
        'GE_NO + 1)) and'
      ''
      
        '  (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_OBJECT_BRANCH_COD' +
        'E) and'
      '  (mlmso2.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_CODE) and'
      '  (not exists'
      '    ( select'
      '         1'
      '       from'
      '         MLMS_OPERATIONS mlmso3'
      '       where'
      
        '         (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BR' +
        'ANCH_CODE) and'
      '         (mlmso3.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      '         (mlmso3.MLMS_OPERATION_NO < mlmso2.MLMS_OPERATION_NO)'
      '     )'
      '  ) and'
      ''
      '  (mlms.MLMS_OBJECT_BRANCH_CODE = :MLMS_OBJECT_BRANCH_CODE) and'
      '  (mlms.MLMS_OBJECT_CODE = :MLMS_OBJECT_CODE)')
    SQLConnection = SQLConn
    Macros = <>
    MacroParams = <>
    CustomParams = <>
    Left = 128
    Top = 56
    object qryNextStageFirstOperationMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
    end
    object qryNextStageFirstOperationMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
    end
    object qryNextStageFirstOperationOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
  end
  object qryOperationalTasks: TAbmesSQLQuery
    BeforeOpen = qryOperationalTasksBeforeOpen
    AfterClose = qryOperationalTasksAfterClose
    OnCalcFields = qryOperationalTasksCalcFields
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'IS_BEGIN_STORE_STAGE'
        ParamType = ptInput
        Value = '0'
      end
      item
        DataType = ftFloat
        Name = 'IS_NORMAL_STAGE'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftFloat
        Name = 'IS_END_STORE_STAGE'
        ParamType = ptInput
        Value = '0'
      end
      item
        DataType = ftFloat
        Name = 'ACTIVE_STATE'
        ParamType = ptInput
        Value = '3'
      end
      item
        DataType = ftFloat
        Name = 'ACTIVE_STATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'ACTIVE_STATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'ACTIVE_STATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'VARIANT_ACTIVE_STATE'
        ParamType = ptInput
        Value = '3'
      end
      item
        DataType = ftFloat
        Name = 'VARIANT_ACTIVE_STATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'VARIANT_ACTIVE_STATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'VARIANT_ACTIVE_STATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'BEGIN_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'BEGIN_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'END_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'END_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_BASE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_BASE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_BASE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_NO'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_NO'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftWideString
        Name = 'MLL_NO_AS_TEXT'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLL_FORK_NO'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLL_FORK_NO'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_SPECIAL_CONTROL'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_SPECIAL_CONTROL'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_SPECIAL_CONTROL'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_BEGIN_ORG_OPERATION'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_NORMAL_OPERATION'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_END_ORG_OPERATION'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'HAS_NO_SETUP'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_SETUP_NOT_DONE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_SETUP_DONE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'BEGIN_PRIORITY_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'END_PRIORITY_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'OPERATION_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'AVAILABLE_QUANTITY_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'OP_AVAILABLE_QUANTITY_STATUS'
        ParamType = ptInput
        Value = '0'
      end>
    SQL.Strings = (
      'select'
      
        '  /*+ INDEX(ml idxML__CLOSE_EMPLOYEE_2) INDEX(s pkSALES) LEADING' +
        '(ml)*/'
      '  mlmso.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso.MLMSO_OBJECT_CODE,'
      ''
      '  mlmso.MLMS_OPERATION_NO,'
      '  mlmso.MLMS_OPERATION_VARIANT_NO,'
      '  mlmso.OPERATION_TYPE_CODE,'
      ''
      '  mlms.MLMS_OBJECT_BRANCH_CODE,'
      '  mlms.MLMS_OBJECT_CODE,'
      '  mlms.ML_MODEL_STAGE_NO,'
      
        '  %IS_AUTO_RECEIVING_OPERATION[mll~mlms~mlmso] as IS_AUTO_RECEIV' +
        'ING_OPERATION,'
      ''
      '  mlmso.VARIANT_DETAIL_TECH_QUANTITY,'
      '  mll.LINE_DETAIL_TECH_QUANTITY,'
      ''
      '  mlmso.TREATMENT_BEGIN_DATE,'
      '  mlmso.TREATMENT_END_DATE,'
      ''
      
        '  Greatest(mlmso.TREATMENT_BEGIN_DATE, ContextDate) as EFFECTIVE' +
        '_TREATMENT_BEGIN_DATE,'
      
        '  Greatest(mlmso.TREATMENT_END_DATE, ContextDate) as EFFECTIVE_T' +
        'REATMENT_END_DATE,'
      ''
      '  ( case'
      '      when  (ContextDate > mlmso.TREATMENT_END_DATE) and'
      '            ( MiscUtils.LargeZero('
      '                mlmso.VARIANT_DETAIL_TECH_QUANTITY'
      '                -'
      '                ( select'
      
        '                    Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY),' +
        ' 0)'
      '                  from'
      '                    OPERATION_MOVEMENTS om'
      '                  where'
      
        '                    (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso.ML' +
        'MSO_OBJECT_BRANCH_CODE) and'
      
        '                    (om.FROM_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJ' +
        'ECT_CODE) and'
      '                    (om.STORNO_EMPLOYEE_CODE is null) and'
      '                    ( (om.TO_DEPT_CODE is not null) or'
      '                      (not'
      
        '                        ( (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlms' +
        'o.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                          (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO' +
        '_OBJECT_CODE)'
      '                        )'
      '                      )'
      '                    )'
      '                )'
      '              )'
      '              >'
      '              0'
      '            )'
      '      then'
      '        1'
      '      else'
      '        0'
      '    end'
      '  ) as IS_LATE,'
      ''
      '  mll.MLL_OBJECT_BRANCH_CODE,'
      '  mll.MLL_OBJECT_CODE,'
      '  mll.NO_AS_TEXT,'
      '  mll.NO_AS_FORMATED_TEXT,'
      
        '  RPad(mll.NO_AS_FORMATED_TEXT, 100, Decode(mll.FORK_NO, 0, '#39' '#39',' +
        ' '#39'x'#39')) as NO_AS_FORMATED_TEXT_EX,'
      '  mll.FORK_NO,'
      ''
      '  ( case'
      '      when (mll.DETAIL_CODE = mll.PRODUCT_CODE) then 1'
      '      when (mll.PRODUCT_CODE is not null) then 2'
      '      else 3'
      '    end'
      '  ) as MLL_TYPE,'
      ''
      '  mll.DETAIL_CODE,'
      ''
      '  dprod.NAME as DETAIL_NAME,'
      '  dprod.CUSTOM_CODE as DETAIL_NO,'
      ''
      '  ( select'
      '      m.MEASURE_ABBREV'
      '    from'
      '      MEASURES m'
      '    where'
      '      (dprod.TECH_MEASURE_CODE = m.MEASURE_CODE)'
      '  ) as DETAIL_TECH_MEASURE_ABBREV,'
      ''
      
        '  %PRODUCT_COMPANY_PRODUCT_NAMES[mll.DETAIL_CODE~s.CLIENT_COMPAN' +
        'Y_CODE] as CLIENT_DETAIL_NAME,'
      ''
      '  ml.ML_OBJECT_BRANCH_CODE,'
      '  ml.ML_OBJECT_CODE,'
      ''
      '  s.SALE_OBJECT_BRANCH_CODE,'
      '  s.SALE_OBJECT_CODE,'
      ''
      '  ( ( select'
      '        pot.PRODUCTION_ORDER_TYPE_ABBREV'
      '      from'
      '        PRODUCTION_ORDER_TYPES pot'
      '      where'
      
        '        (pot.PRODUCTION_ORDER_TYPE_CODE = s.PRODUCTION_ORDER_TYP' +
        'E_CODE)'
      '    ) ||'
      '    '#39'/'#39' ||'
      '    ( select'
      '        d.CUSTOM_CODE'
      '      from'
      '        DEPTS d'
      '      where'
      '        (d.DEPT_CODE = s.SALE_BRANCH_CODE)'
      '    ) ||'
      '    '#39'/'#39' ||'
      '    s.SALE_NO ||'
      '    '#39'/'#39' ||'
      '    ( select'
      '        st.SALE_TYPE_ABBREV'
      '      from'
      '        SALE_TYPES st'
      '      where'
      '        (st.SALE_TYPE_CODE = s.SALE_TYPE_CODE)'
      '    )'
      '  ) as PRODUCTION_ORDER_IDENTIFIER,'
      ''
      '  ( select'
      '      d.CUSTOM_CODE'
      '    from'
      '      DEPTS d'
      '    where'
      '      (d.DEPT_CODE = s.SALE_BRANCH_CODE)'
      '  ) as SALE_BRANCH_NO,'
      ''
      '  s.SALE_NO,'
      ''
      
        '  Nvl2(s.WASTING_SALE_OBJ_BRANCH_CODE, 1, 0) as IS_WASTE_COMPENS' +
        'ATOR,'
      ''
      '  sg.PRIORITY_CODE,'
      ''
      '  ( select'
      '      prt.PRIORITY_NO'
      '    from'
      '      PRIORITIES prt'
      '    where'
      '      (prt.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '  ) as PRIORITY_NO,'
      ''
      '  ( select'
      '      prt.PRIORITY_COLOR'
      '    from'
      '      PRIORITIES prt'
      '    where'
      '      (prt.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '  ) as PRIORITY_COLOR,'
      ''
      '  ( select'
      '      prt.PRIORITY_BACKGROUND_COLOR'
      '    from'
      '      PRIORITIES prt'
      '    where'
      '      (prt.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '  ) as PRIORITY_BACKGROUND_COLOR,'
      ''
      '  s.WORK_PRIORITY_CODE,'
      ''
      '  ( select'
      '      wprt.WORK_PRIORITY_NO'
      '    from'
      '      WORK_PRIORITIES wprt'
      '    where'
      '      (wprt.WORK_PRIORITY_CODE = s.WORK_PRIORITY_CODE)'
      '  ) as WORK_PRIORITY_NO,'
      ''
      
        '  (mlms.ML_MODEL_STAGE_NO || '#39'-'#39' || mlmso.MLMS_OPERATION_NO || '#39 +
        '.'#39' || mlmso.MLMS_OPERATION_VARIANT_NO) as SHOW_NO,'
      ''
      '  %HAS_DOC_ITEMS[mlmso] as HAS_DOCUMENTATION,'
      ''
      '  mlmso.HAS_SPECIAL_CONTROL,'
      ''
      '  mlms.DEPT_CODE as STAGE_DEPT_CODE,'
      ''
      '  ( select'
      '      d.NAME'
      '    from'
      '      DEPTS d'
      '    where'
      '      (d.DEPT_CODE = mlms.DEPT_CODE)'
      '  ) as STAGE_DEPT_NAME,'
      ''
      '  ( select'
      '      (dt.DEPT_TYPE_ABBREV || d.CUSTOM_CODE || d.SUFFIX_LETTER)'
      '    from'
      '      DEPTS d,'
      '      DEPT_TYPES dt'
      '    where'
      '      (d.DEPT_CODE = mlms.DEPT_CODE) and'
      '      (d.DEPT_TYPE_CODE = dt.DEPT_TYPE_CODE(+))'
      '  ) as STAGE_DEPT_IDENTIFIER,'
      ''
      '  mlmso.DEPT_CODE,'
      ''
      '  ( select'
      '      d.NAME'
      '    from'
      '      DEPTS d'
      '    where'
      '      (d.DEPT_CODE = mlmso.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      ''
      '  ( select'
      '      (dt.DEPT_TYPE_ABBREV || d.CUSTOM_CODE || d.SUFFIX_LETTER)'
      '    from'
      '      DEPTS d,'
      '      DEPT_TYPES dt'
      '    where'
      '      (d.DEPT_CODE = mlmso.DEPT_CODE) and'
      '      (d.DEPT_TYPE_CODE = dt.DEPT_TYPE_CODE(+))'
      '  ) as DEPT_IDENTIFIER,'
      ''
      '  mlmso.SETUP_PROFESSION_CODE,'
      '  mlmso.SETUP_EFFORT_COEF,'
      '  mlmso.SETUP_HOUR_TECH_QUANTITY,'
      '  mlmso.SETUP_COUNT,'
      
        '  (mlmso.SETUP_COUNT - Coalesce(mlmso.DONE_SETUP_COUNT, 0)) as R' +
        'EMAINING_SETUP_COUNT,'
      ''
      '  mlmso.PROFESSION_CODE,'
      '  mlmso.EFFORT_COEF,'
      '  mlmso.HOUR_TECH_QUANTITY,'
      ''
      '  mlmso.PROGRAM_TOOL_PRODUCT_CODE,'
      '  mlmso.SPECIFIC_TOOL_PRODUCT_CODE,'
      '  mlmso.TYPICAL_TOOL_PRODUCT_CODE,'
      ''
      '  mlmso.PROGRAM_TOOL_REQUIREMENT_CODE,'
      '  mlmso.SPECIFIC_TOOL_REQUIREMENT_CODE,'
      '  mlmso.TYPICAL_TOOL_REQUIREMENT_CODE,'
      ''
      '  mlmso.PROGRAM_TOOL_IS_COMPLETE,'
      '  mlmso.SPECIFIC_TOOL_IS_COMPLETE,'
      '  mlmso.TYPICAL_TOOL_IS_COMPLETE,'
      ''
      '  ( select'
      '      p.DOC_BRANCH_CODE'
      '    from'
      '      PRODUCTS p'
      '    where'
      '      (p.PRODUCT_CODE = mlmso.PROGRAM_TOOL_PRODUCT_CODE)'
      '  ) as PROGRAM_TOOL_DOC_BRANCH_CODE,'
      ''
      '  ( select'
      '      p.DOC_CODE'
      '    from'
      '      PRODUCTS p'
      '    where'
      '      (p.PRODUCT_CODE = mlmso.PROGRAM_TOOL_PRODUCT_CODE)'
      '  ) as PROGRAM_TOOL_DOC_CODE,'
      ''
      '  ( select'
      '      p.DOC_BRANCH_CODE'
      '    from'
      '      PRODUCTS p'
      '    where'
      '      (p.PRODUCT_CODE = mlmso.SPECIFIC_TOOL_PRODUCT_CODE)'
      '  ) as SPECIFIC_TOOL_DOC_BRANCH_CODE,'
      ''
      '  ( select'
      '      p.DOC_CODE'
      '    from'
      '      PRODUCTS p'
      '    where'
      '      (p.PRODUCT_CODE = mlmso.SPECIFIC_TOOL_PRODUCT_CODE)'
      '  ) as SPECIFIC_TOOL_DOC_CODE,'
      ''
      '  ( select'
      '      p.DOC_BRANCH_CODE'
      '    from'
      '      PRODUCTS p'
      '    where'
      '      (p.PRODUCT_CODE = mlmso.TYPICAL_TOOL_PRODUCT_CODE)'
      '  ) as TYPICAL_TOOL_DOC_BRANCH_CODE,'
      ''
      '  ( select'
      '      p.DOC_CODE'
      '    from'
      '      PRODUCTS p'
      '    where'
      '      (p.PRODUCT_CODE = mlmso.TYPICAL_TOOL_PRODUCT_CODE)'
      '  ) as TYPICAL_TOOL_DOC_CODE,'
      ''
      '  mlmso.DOC_BRANCH_CODE,'
      '  mlmso.DOC_CODE,'
      ''
      '  ( select'
      '      Sign(Count(*))'
      '    from'
      '      DOC_ITEMS di,'
      '      DOC_ITEM_TYPES dit'
      '    where'
      '      (di.DOC_BRANCH_CODE = mlmso.DOC_BRANCH_CODE) and'
      '      (di.DOC_CODE = mlmso.DOC_CODE) and'
      ''
      '      (di.DOC_ITEM_TYPE_CODE = dit.DOC_ITEM_TYPE_CODE) and'
      ''
      '      (dit.IS_DNC_DOC = 1)'
      '  ) as HAS_DNC_DOC_ITEMS,'
      ''
      '  dprod.DOC_BRANCH_CODE as DETAIL_DOC_BRANCH_CODE,'
      '  dprod.DOC_CODE as DETAIL_DOC_CODE,'
      ''
      '  Nvl2(mlmso.SETUP_DATE, 1, 0) as IS_SETUP_DONE,'
      ''
      '  ( select'
      '      Count(*)'
      '    from'
      '      MLMS_OPERATIONS mlmso2'
      '    where'
      
        '      (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJECT_BRANCH' +
        '_CODE) and'
      '      (mlmso2.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE) and'
      '      (mlmso2.MLMS_OPERATION_NO = mlmso.MLMS_OPERATION_NO) and'
      '      (mlmso2.IS_ACTIVE = 1) and'
      '      (mlmso2.MLMS_OPERATION_VARIANT_NO >= 0)'
      '  ) as OPERATION_VARIANT_COUNT,'
      ''
      '  ( select'
      '      (1 - Sign(Count(*)))'
      '    from'
      '      MLMS_OPERATIONS mlmso2'
      '    where'
      
        '      (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJECT_BRANCH' +
        '_CODE) and'
      '      (mlmso2.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE) and'
      '      (mlmso2.MLMS_OPERATION_NO < mlmso.MLMS_OPERATION_NO)'
      '  ) as IS_FIRST_OPERATION_IN_STAGE,'
      ''
      '  ( select'
      '      (1 - Sign(Count(*)))'
      '    from'
      '      MLMS_OPERATIONS mlmso2'
      '    where'
      
        '      (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJECT_BRANCH' +
        '_CODE) and'
      '      (mlmso2.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE) and'
      '      (mlmso2.MLMS_OPERATION_NO > mlmso.MLMS_OPERATION_NO)'
      '  ) as IS_LAST_OPERATION_IN_STAGE,'
      ''
      '  ( select'
      '      (1 - Sign(Count(*)))'
      '    from'
      '      ML_MODEL_STAGES mlms2'
      '    where'
      
        '      (mlms2.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_BRANCH_COD' +
        'E) and'
      '      (mlms2.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) and'
      '      (mlms2.ML_MODEL_STAGE_NO < mlms.ML_MODEL_STAGE_NO)'
      '  ) as IS_FIRST_STAGE_IN_MLL,'
      ''
      '  ( select'
      '      (1 - Sign(Count(*)))'
      '    from'
      '      ML_MODEL_STAGES mlms2'
      '    where'
      
        '      (mlms2.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_BRANCH_COD' +
        'E) and'
      '      (mlms2.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) and'
      '      (mlms2.ML_MODEL_STAGE_NO > mlms.ML_MODEL_STAGE_NO) and'
      '      (mlms2.TREATMENT_WORKDAYS > 0)'
      '  ) as IS_LAST_STAGE_IN_MLL,'
      ''
      '  ( case'
      '      when'
      '        (mlms.ML_MODEL_STAGE_NO = 0)'
      '      then'
      '        3'
      '      when'
      '        (mlms.OUTGOING_WORKDAYS = 0)'
      '      then'
      '        4'
      '      when'
      '        (mll.PRODUCT_CODE is null) and'
      '        (mlms.ML_MODEL_STAGE_NO = 1) and'
      '        (not exists'
      '          ( select'
      '              1'
      '            from'
      '              MLMS_OPERATIONS mlmso2'
      '            where'
      
        '              (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '              (mlmso2.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE)' +
        ' and'
      
        '              (mlmso2.MLMS_OPERATION_NO < mlmso.MLMS_OPERATION_N' +
        'O) and'
      '              (mlmso2.OPERATION_TYPE_CODE = 2)'
      '          )'
      '        )'
      '      then'
      '        0'
      '      when'
      '        (mlmso.OPERATION_TYPE_CODE in (1, 3))'
      '      then'
      '        1'
      '    else'
      '      2'
      '    end'
      '  ) as OPERATION_KIND,'
      ''
      '  Coalesce('
      '    ( select'
      '        mlmso2.OPERATION_TYPE_CODE'
      '      from'
      '        MLMS_OPERATIONS mlmso2'
      '      where'
      
        '        (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJECT_BRAN' +
        'CH_CODE) and'
      '        (mlmso2.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE) and'
      
        '        (mlmso2.MLMS_OPERATION_NO = mlmso.MLMS_OPERATION_NO + 1)' +
        ' and'
      
        '        (mlmso2.MLMS_OPERATION_VARIANT_NO = 0)  -- sluchaen vari' +
        'ant - tipa e edin i susht za vsichki varianti'
      '    ),'
      '    ( select'
      '        mlmso2.OPERATION_TYPE_CODE'
      '      from'
      '        MLMS_OPERATIONS mlmso2'
      '      where'
      
        '        ( (mlmso2.MLMS_OBJECT_BRANCH_CODE, mlmso2.MLMS_OBJECT_CO' +
        'DE, mlmso2.MLMS_OPERATION_NO) ='
      '          ( select'
      '              mlms2.MLMS_OBJECT_BRANCH_CODE,'
      '              mlms2.MLMS_OBJECT_CODE,'
      '              ( select'
      '                  Min(mlmso3.MLMS_OPERATION_NO)'
      '                from'
      '                  MLMS_OPERATIONS mlmso3'
      '                where'
      
        '                  (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_O' +
        'BJECT_BRANCH_CODE) and'
      
        '                  (mlmso3.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_C' +
        'ODE)'
      '              ) as MIN_MLMS_OPERATION_NO'
      '            from'
      '              ML_MODEL_STAGES mlms2'
      '            where'
      
        '              (mlms2.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_BR' +
        'ANCH_CODE) and'
      '              (mlms2.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) and'
      
        '              (mlms2.ML_MODEL_STAGE_NO = mlms.ML_MODEL_STAGE_NO ' +
        '+ 1)'
      '          )'
      '        ) and'
      
        '        (mlmso2.MLMS_OPERATION_VARIANT_NO = 0)  -- sluchaen vari' +
        'ant - tipa e edin i susht za vsichki varianti'
      '    ),'
      '    ( select'
      '        mlmso2.OPERATION_TYPE_CODE'
      '      from'
      '        MLMS_OPERATIONS mlmso2'
      '      where'
      
        '        ( (mlmso2.MLMS_OBJECT_BRANCH_CODE, mlmso2.MLMS_OBJECT_CO' +
        'DE, mlmso2.MLMS_OPERATION_NO) ='
      '          ( select'
      '              mlms2.MLMS_OBJECT_BRANCH_CODE,'
      '              mlms2.MLMS_OBJECT_CODE,'
      '              ( select'
      '                  Min(mlmso3.MLMS_OPERATION_NO)'
      '                from'
      '                  MLMS_OPERATIONS mlmso3'
      '                where'
      
        '                  (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_O' +
        'BJECT_BRANCH_CODE) and'
      
        '                  (mlmso3.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_C' +
        'ODE)'
      '              ) as MIN_MLMS_OPERATION_NO'
      '            from'
      '              ML_MODEL_STAGES mlms2'
      '            where'
      
        '              (mlms2.MLL_OBJECT_BRANCH_CODE = mll.PARENT_MLL_OBJ' +
        'ECT_BRANCH_CODE) and'
      
        '              (mlms2.MLL_OBJECT_CODE = mll.PARENT_MLL_OBJECT_COD' +
        'E) and'
      '              (mlms2.ML_MODEL_STAGE_NO = 1)'
      '          )'
      '        ) and'
      
        '        (mlmso2.MLMS_OPERATION_VARIANT_NO = 0)  -- sluchaen vari' +
        'ant - tipa e edin i susht za vsichki varianti'
      '    )'
      '  ) as NEXT_OPERATION_TYPE_CODE,'
      ''
      '  MiscUtils.LargeZero('
      
        '    Greatest( -- ostavasht za razpredeliane brak ot predhodni op' +
        'eracii sled kato e razpredelen po sledvashtite varianti na nasha' +
        'ta operacia'
      '      0,'
      '      ('
      '        ( -- brak po predhodinte operacii i etapi ot toia red'
      '          select'
      '            Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '          from'
      '            ML_MODEL_STAGES mlms2,'
      '            MLMS_OPERATIONS mlmso2,'
      '            OPERATION_MOVEMENTS om'
      '          where'
      
        '            (mlms2.MLL_OBJECT_BRANCH_CODE = mll.MLL_OBJECT_BRANC' +
        'H_CODE) and'
      '            (mlms2.MLL_OBJECT_CODE = mll.MLL_OBJECT_CODE) and'
      ''
      
        '            (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_' +
        'BRANCH_CODE) and'
      
        '            (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) a' +
        'nd'
      ''
      
        '            (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_OBJ' +
        'ECT_BRANCH_CODE) and'
      
        '            (om.FROM_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_COD' +
        'E) and'
      ''
      '            (om.STORNO_EMPLOYEE_CODE is null) and'
      '            (om.TO_DEPT_CODE is not null) and'
      ''
      
        '            ( (mlms2.ML_MODEL_STAGE_NO < mlms.ML_MODEL_STAGE_NO)' +
        ' or'
      
        '              ( (mlms2.ML_MODEL_STAGE_NO = mlms.ML_MODEL_STAGE_N' +
        'O) and'
      
        '                (mlmso2.MLMS_OPERATION_NO < mlmso.MLMS_OPERATION' +
        '_NO)'
      '              )'
      '            )'
      '        )'
      '        -'
      
        '        ( -- ostavashto za vlizane po sledvashtite variatni na n' +
        'ashata operacia'
      '          select'
      '            Coalesce('
      '              Sum('
      '                mlmso2.VARIANT_DETAIL_TECH_QUANTITY'
      '                -'
      
        '                ( -- vliazlo v operaciata mlmso2 ot drugi operac' +
        'ii'
      '                  select'
      
        '                    Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY),' +
        ' 0)'
      '                  from'
      '                    OPERATION_MOVEMENTS om'
      '                  where'
      
        '                    (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLM' +
        'SO_OBJECT_BRANCH_CODE) and'
      
        '                    (om.TO_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJE' +
        'CT_CODE) and'
      '                    (om.STORNO_EMPLOYEE_CODE is null) and'
      '                    (om.TO_DEPT_CODE is null) and'
      '                    (not'
      
        '                      ( (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlms' +
        'o2.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                        (om.FROM_MLMSO_OBJECT_CODE = mlmso2.MLMS' +
        'O_OBJECT_CODE)'
      '                      )'
      '                    )'
      '                )'
      '              ),'
      '              0'
      '            )'
      '          from'
      '            MLMS_OPERATIONS mlmso2'
      '          where'
      
        '            (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJECT_' +
        'BRANCH_CODE) and'
      
        '            (mlmso2.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE) a' +
        'nd'
      
        '            (mlmso2.MLMS_OPERATION_NO = mlmso.MLMS_OPERATION_NO)' +
        ' and'
      
        '            (mlmso2.MLMS_OPERATION_VARIANT_NO > mlmso.MLMS_OPERA' +
        'TION_VARIANT_NO)'
      '        )'
      '      )'
      '    )'
      '  ) as REMAINING_WASTE_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      '    ModelUtils.GetMlmsoRcvdForDetailTechQty('
      '      mlmso.MLMSO_OBJECT_BRANCH_CODE,'
      '      mlmso.MLMSO_OBJECT_CODE,'
      '      ( select'
      '          iv.FEATURE_FLAG_OPERATION_LOADING'
      '        from'
      '          INTERNAL_VALUES iv'
      '        where'
      '          (iv.CODE = 1)'
      '      )'
      '    )'
      '    -'
      '    ( -- vurnato v nashia -1 variant'
      '      select'
      '        Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        OPERATION_MOVEMENTS om'
      '      where'
      
        '        (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJECT_B' +
        'RANCH_CODE) and'
      
        '        (om.FROM_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE) an' +
        'd'
      '        (om.STORNO_EMPLOYEE_CODE is null) and'
      '        (om.OPERATION_MOVEMENT_TYPE_CODE = 12)'
      '    )'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      '    ( -- izliazlo ot nashata operacia za drugi operacii ili brak'
      '      select'
      '        Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        OPERATION_MOVEMENTS om'
      '      where'
      
        '        (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJECT_B' +
        'RANCH_CODE) and'
      
        '        (om.FROM_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE) an' +
        'd'
      '        (om.STORNO_EMPLOYEE_CODE is null) and'
      ''
      '        (om.OPERATION_MOVEMENT_TYPE_CODE <> 12) and'
      ''
      '        ( (om.TO_DEPT_CODE is not null) or'
      '          (not'
      
        '            ( (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJE' +
        'CT_BRANCH_CODE) and'
      
        '              (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE' +
        ')'
      '            )'
      '          )'
      '        )'
      '    )'
      '  ) as OUT_DETAIL_TECH_QUANTITY,'
      ''
      '  ( select'
      '      ( select'
      '          Sum(om.TOTAL_DETAIL_TECH_QUANTITY)'
      '        from'
      '          OPERATION_MOVEMENTS om,'
      '          MLMS_OPERATIONS mlmso5'
      '        where'
      
        '          (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso5.MLMSO_OBJECT_' +
        'BRANCH_CODE) and'
      
        '          (om.TO_MLMSO_OBJECT_CODE = mlmso5.MLMSO_OBJECT_CODE) a' +
        'nd'
      
        '          (mlmso5.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJECT_BR' +
        'ANCH_CODE) and'
      '          (mlmso5.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE) and'
      
        '          (mlmso5.MLMS_OPERATION_NO = mlmso.MLMS_OPERATION_NO) a' +
        'nd'
      '          (mlmso5.MLMS_OPERATION_VARIANT_NO <> -1) and'
      '          (om.OPERATION_MOVEMENT_TYPE_CODE in (1, 2, 3, 4)) and'
      '          (om.STORNO_EMPLOYEE_CODE is null)'
      '      )'
      '    from'
      '      DUAL'
      '    where'
      '      (mlmso.OPERATION_TYPE_CODE = 2) and'
      '      ( (mll.PRODUCT_CODE is not null) or'
      '        (mlms.ML_MODEL_STAGE_NO > 1) or'
      '        (mlmso.MLMS_OPERATION_NO > 1) or'
      '        ( (mlms.ML_MODEL_STAGE_NO = 1) and'
      '          (mlmso.MLMS_OPERATION_NO = 1) and'
      '          (exists'
      '            ( select'
      '                1'
      '              from'
      '                MLMS_OPERATIONS mlmso4'
      '              where'
      
        '                (mlmso4.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJ' +
        'ECT_BRANCH_CODE) and'
      
        '                (mlmso4.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_COD' +
        'E) and'
      '                (mlmso4.MLMS_OPERATION_NO = 0)'
      '            )'
      '          )'
      '        )'
      '      )'
      '  ) as OP_OLD_IN_DETAIL_TECH_QUANTITY,'
      ''
      '  ( select'
      '      ModelUtils.GetMlmsoRcvdForDetailTechQty2('
      '        fake_var_mlmso.MLMSO_OBJECT_BRANCH_CODE,'
      '        fake_var_mlmso.MLMSO_OBJECT_CODE,'
      '        ( select'
      '            iv.FEATURE_FLAG_OPERATION_LOADING'
      '          from'
      '            INTERNAL_VALUES iv'
      '          where'
      '            (iv.CODE = 1)'
      '        )'
      '      )'
      '    from'
      '      MLMS_OPERATIONS fake_var_mlmso'
      '    where'
      
        '      (fake_var_mlmso.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '      (fake_var_mlmso.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE)' +
        ' and'
      
        '      (fake_var_mlmso.MLMS_OPERATION_NO = mlmso.MLMS_OPERATION_N' +
        'O) and'
      '      (fake_var_mlmso.MLMS_OPERATION_VARIANT_NO = -1)'
      '  ) as OP_IN_DETAIL_TECH_QUANTITY,'
      ''
      '  ( select'
      '      MiscUtils.LargeZero('
      
        '        ( -- izliazlo ot nashia -1 variant kam variant ili kam b' +
        'rak'
      '          select'
      '            Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '          from'
      '            OPERATION_MOVEMENTS om'
      '          where'
      
        '            (om.FROM_MLMSO_OBJECT_BRANCH_CODE = fake_var_mlmso.M' +
        'LMSO_OBJECT_BRANCH_CODE) and'
      
        '            (om.FROM_MLMSO_OBJECT_CODE = fake_var_mlmso.MLMSO_OB' +
        'JECT_CODE) and'
      '            (om.STORNO_EMPLOYEE_CODE is null) and'
      ''
      '            ( (om.TO_DEPT_CODE is not null) or'
      '              (not'
      
        '                ( (om.TO_MLMSO_OBJECT_BRANCH_CODE = fake_var_mlm' +
        'so.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                  (om.TO_MLMSO_OBJECT_CODE = fake_var_mlmso.MLMS' +
        'O_OBJECT_CODE)'
      '                )'
      '              )'
      '            )'
      '        )'
      '      )'
      '      -'
      '      MiscUtils.LargeZero('
      '        ( -- vurnato v nashia -1 variant'
      '          select'
      '            Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '          from'
      '            OPERATION_MOVEMENTS om'
      '          where'
      
        '            (om.TO_MLMSO_OBJECT_BRANCH_CODE = fake_var_mlmso.MLM' +
        'SO_OBJECT_BRANCH_CODE) and'
      
        '            (om.TO_MLMSO_OBJECT_CODE = fake_var_mlmso.MLMSO_OBJE' +
        'CT_CODE) and'
      '            (om.STORNO_EMPLOYEE_CODE is null) and'
      '            (om.OPERATION_MOVEMENT_TYPE_CODE = 12)'
      '        )'
      '      )'
      '    from'
      '      MLMS_OPERATIONS fake_var_mlmso'
      '    where'
      
        '      (fake_var_mlmso.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '      (fake_var_mlmso.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE)' +
        ' and'
      
        '      (fake_var_mlmso.MLMS_OPERATION_NO = mlmso.MLMS_OPERATION_N' +
        'O) and'
      '      (fake_var_mlmso.MLMS_OPERATION_VARIANT_NO = -1)'
      '  ) as OP_OUT_DETAIL_TECH_QUANTITY,'
      ''
      '  mll.PRODUCT_CODE as MATERIAL_CODE,'
      ''
      '  ( select'
      '      p.CUSTOM_CODE'
      '    from'
      '      PRODUCTS p'
      '    where'
      '      (p.PRODUCT_CODE = mll.PRODUCT_CODE)'
      '  ) as MATERIAL_NO,'
      ''
      '  ( select'
      '      p.NAME'
      '    from'
      '      PRODUCTS p'
      '    where'
      '      (p.PRODUCT_CODE = mll.PRODUCT_CODE)'
      '  ) as MATERIAL_NAME,'
      ''
      '  ( case'
      '      when'
      '        (mlms.ML_MODEL_STAGE_NO = 1) and'
      '        (mlmso.MLMS_OPERATION_NO <= 1)'
      '      then'
      '        ( select'
      '            m.MEASURE_ABBREV'
      '          from'
      '            PRODUCTS p,'
      '            MEASURES m'
      '          where'
      '            (p.MEASURE_CODE = m.MEASURE_CODE) and'
      '            (p.PRODUCT_CODE = mll.PRODUCT_CODE)'
      '        )'
      '    end'
      '  ) as MATERIAL_WORK_MEASURE_ABBREV,'
      ''
      '  ( case'
      '      when'
      '        (mlms.ML_MODEL_STAGE_NO = 1) and'
      '        (mlmso.MLMS_OPERATION_NO <= 1)'
      '      then'
      '        ( select'
      '            m.MEASURE_ABBREV'
      '          from'
      '            PRODUCTS p,'
      '            MEASURES m'
      '          where'
      '            (p.TECH_MEASURE_CODE = m.MEASURE_CODE) and'
      '            (p.PRODUCT_CODE = mll.PRODUCT_CODE)'
      '        )'
      '    end'
      '  ) as MATERIAL_TECH_MEASURE_ABBREV,'
      ''
      '  ( case'
      '      when'
      '        (mlms.ML_MODEL_STAGE_NO = 1) and'
      '        (mlmso.MLMS_OPERATION_NO <= 1)'
      '      then'
      '        ( select'
      '            p.TECH_MEASURE_COEF'
      '          from'
      '            PRODUCTS p'
      '          where'
      '            (p.PRODUCT_CODE = mll.PRODUCT_CODE)'
      '        )'
      '    end'
      '  ) as MATERIAL_TECH_MEASURE_COEF,'
      ''
      '  ( case'
      '      when'
      '        (mlms.ML_MODEL_STAGE_NO = 1) and'
      '        (mlmso.MLMS_OPERATION_NO <= 1)'
      '      then'
      '        mll.PRODUCT_TECH_QUANTITY'
      '    end'
      '  ) as MATERIAL_TECH_QUANTITY,'
      ''
      '  mlmso.IS_AUTO_SETUP as MLMSO_IS_AUTO_SETUP,'
      '  mlmso.IS_AUTO_MOVEMENT as MLMSO_IS_AUTO_MOVEMENT,'
      ''
      '  ( select'
      '      %HAS_DOC_ITEMS[d]'
      '    from'
      '      DEPTS d'
      '    where'
      '      (d.DEPT_CODE = mlmso.DEPT_CODE)'
      '  ) as DEPT_HAS_DOC_ITEMS,'
      ''
      '  ( select'
      '      d.DOC_BRANCH_CODE'
      '    from'
      '      DEPTS d'
      '    where'
      '      (d.DEPT_CODE = mlmso.DEPT_CODE)'
      '  ) as DEPT_DOC_BRANCH_CODE,'
      ''
      '  ( select'
      '      d.DOC_CODE'
      '    from'
      '      DEPTS d'
      '    where'
      '      (d.DEPT_CODE = mlmso.DEPT_CODE)'
      '  ) as DEPT_DOC_CODE,'
      ''
      '  ( select'
      '      d.PRODUCT_CODE'
      '    from'
      '      DEPTS d'
      '    where'
      '      (d.DEPT_CODE = mlmso.DEPT_CODE)'
      '  ) as DEPT_PRODUCT_CODE,'
      ''
      '  0 as IS_RECORD_CHANGED,'
      ''
      '  ( select'
      '      c.COMPANY_NO'
      '    from'
      '      EMPLOYEES e,'
      '      COMPANIES c'
      '    where'
      '      (e.COMPANY_CODE = c.COMPANY_CODE) and'
      '      (e.EMPLOYEE_CODE = s.MANAGER_EMPLOYEE_CODE)'
      '  ) as MANAGER_EMPLOYEE_NO,'
      ''
      '  ( select'
      
        '      e.FIRST_NAME || '#39' '#39' || Nvl2(e.MIDDLE_NAME, e.MIDDLE_NAME |' +
        '| '#39' '#39', '#39#39') || e.LAST_NAME'
      '    from'
      '      EMPLOYEES e'
      '    where'
      '      (e.EMPLOYEE_CODE = s.MANAGER_EMPLOYEE_CODE)'
      '  ) as MANAGER_EMPLOYEE_NAME,'
      ''
      '  s.CONSUME_BEGIN_DATE,'
      '  s.CONSUME_END_DATE,'
      ''
      
        '  Decode(mlms.ML_MODEL_STAGE_NO, 0, 1, 0) as IS_BEGIN_STORE_STAG' +
        'E,'
      
        '  Decode(mlms.ML_MODEL_STAGE_NO, 0, 0, Decode(mlms.OUTGOING_WORK' +
        'DAYS, 0, 0, 1)) as IS_NORMAL_STAGE,'
      '  Decode(mlms.OUTGOING_WORKDAYS, 0, 1, 0) as IS_END_STORE_STAGE,'
      ''
      '  mlmso.DONE_SETUP_COUNT,'
      '  mlmso.SETUP_DATE as DONE_SETUP_DATE,'
      '  mlmso.SETUP_TIME as DONE_SETUP_TIME,'
      ''
      '  s.ENTER_SH_STORE_PLAN_BEGIN_DATE,'
      '  s.ENTER_SH_STORE_PLAN_END_DATE,'
      ''
      '  mll.DETAIL_TECH_QUANTITY,'
      ''
      '  dprod.PARAMS_EXPORT_DATA as DETAIL_PARAMS_EXPORT_DATA,'
      ''
      '  ( select'
      '      om.TO_DEPT_ZONE_NO'
      '    from'
      '      OPERATION_MOVEMENTS om'
      '    where'
      
        '      (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJECT_BRANC' +
        'H_CODE) and'
      '      (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE) and'
      '      (om.STORNO_EMPLOYEE_CODE is null) and'
      '      (om.OPERATION_MOVEMENT_TYPE_CODE = 11) and'
      '      (not exists'
      '        ( select'
      '            1'
      '          from'
      '            OPERATION_MOVEMENTS om2'
      '          where'
      
        '            (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '            (om2.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE)' +
        ' and'
      '            (om2.STORNO_EMPLOYEE_CODE is null) and'
      '            (om2.OPERATION_MOVEMENT_TYPE_CODE = 11) and'
      '            ( (om2.OM_DATE > om.OM_DATE) or'
      '              ( (om2.OM_DATE = om.OM_DATE) and'
      '                ( (om2.OM_TIME > om.OM_TIME) or'
      '                  ( (om2.OM_TIME = om.OM_TIME) and'
      '                    (om2.OM_CODE > om.OM_CODE)'
      '                  )'
      '                )'
      '              )'
      '            )'
      '        )'
      '      )'
      '  ) as OM_LOAD_TO_DEPT_ZONE_NO,'
      ''
      '  ( select'
      '      ( select'
      '          c.COMPANY_NO'
      '        from'
      '          EMPLOYEES e,'
      '          COMPANIES c'
      '        where'
      '          (e.EMPLOYEE_CODE = om.TO_EMPLOYEE_CODE) and'
      '          (e.COMPANY_CODE = c.COMPANY_CODE)'
      '      )'
      '    from'
      '      OPERATION_MOVEMENTS om'
      '    where'
      
        '      (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJECT_BRANC' +
        'H_CODE) and'
      '      (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE) and'
      '      (om.STORNO_EMPLOYEE_CODE is null) and'
      '      (om.OPERATION_MOVEMENT_TYPE_CODE = 11) and'
      '      (not exists'
      '        ( select'
      '            1'
      '          from'
      '            OPERATION_MOVEMENTS om2'
      '          where'
      
        '            (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '            (om2.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE)' +
        ' and'
      '            (om2.STORNO_EMPLOYEE_CODE is null) and'
      '            (om2.OPERATION_MOVEMENT_TYPE_CODE = 11) and'
      '            ( (om2.OM_DATE > om.OM_DATE) or'
      '              ( (om2.OM_DATE = om.OM_DATE) and'
      '                ( (om2.OM_TIME > om.OM_TIME) or'
      '                  ( (om2.OM_TIME = om.OM_TIME) and'
      '                    (om2.OM_CODE > om.OM_CODE)'
      '                  )'
      '                )'
      '              )'
      '            )'
      '        )'
      '      )'
      '  ) as OM_LOAD_TO_EMPLOYEE_NO,'
      ''
      '  ( select'
      '      Coalesce('
      '        ( select'
      '            (e.FIRST_NAME || '#39' '#39' || e.LAST_NAME)'
      '          from'
      '            EMPLOYEES e'
      '          where'
      '            (e.EMPLOYEE_CODE = om.TO_EMPLOYEE_CODE)'
      '        ),'
      '        ( select'
      '            t.TEAM_NAME'
      '          from'
      '            TEAMS t'
      '          where'
      '            (t.TEAM_CODE = om.TO_TEAM_CODE)'
      '        )'
      '      )'
      '    from'
      '      OPERATION_MOVEMENTS om'
      '    where'
      
        '      (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJECT_BRANC' +
        'H_CODE) and'
      '      (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE) and'
      '      (om.STORNO_EMPLOYEE_CODE is null) and'
      '      (om.OPERATION_MOVEMENT_TYPE_CODE = 11) and'
      '      (not exists'
      '        ( select'
      '            1'
      '          from'
      '            OPERATION_MOVEMENTS om2'
      '          where'
      
        '            (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '            (om2.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE)' +
        ' and'
      '            (om2.STORNO_EMPLOYEE_CODE is null) and'
      '            (om2.OPERATION_MOVEMENT_TYPE_CODE = 11) and'
      '            ( (om2.OM_DATE > om.OM_DATE) or'
      '              ( (om2.OM_DATE = om.OM_DATE) and'
      '                ( (om2.OM_TIME > om.OM_TIME) or'
      '                  ( (om2.OM_TIME = om.OM_TIME) and'
      '                    (om2.OM_CODE > om.OM_CODE)'
      '                  )'
      '                )'
      '              )'
      '            )'
      '        )'
      '      )'
      '  ) as OM_LOAD_TO_EMPLOYEE_NAME,'
      ''
      '  ( select'
      '      om.OM_DATE'
      '    from'
      '      OPERATION_MOVEMENTS om'
      '    where'
      
        '      (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJECT_BRANC' +
        'H_CODE) and'
      '      (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE) and'
      '      (om.STORNO_EMPLOYEE_CODE is null) and'
      '      (om.OPERATION_MOVEMENT_TYPE_CODE = 11) and'
      '      (not exists'
      '        ( select'
      '            1'
      '          from'
      '            OPERATION_MOVEMENTS om2'
      '          where'
      
        '            (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '            (om2.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE)' +
        ' and'
      '            (om2.STORNO_EMPLOYEE_CODE is null) and'
      '            (om2.OPERATION_MOVEMENT_TYPE_CODE = 11) and'
      '            ( (om2.OM_DATE > om.OM_DATE) or'
      '              ( (om2.OM_DATE = om.OM_DATE) and'
      '                ( (om2.OM_TIME > om.OM_TIME) or'
      '                  ( (om2.OM_TIME = om.OM_TIME) and'
      '                    (om2.OM_CODE > om.OM_CODE)'
      '                  )'
      '                )'
      '              )'
      '            )'
      '        )'
      '      )'
      '  ) as OM_LOAD_DATE,'
      ''
      '  ( select'
      '      om.OM_TIME'
      '    from'
      '      OPERATION_MOVEMENTS om'
      '    where'
      
        '      (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJECT_BRANC' +
        'H_CODE) and'
      '      (om.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE) and'
      '      (om.STORNO_EMPLOYEE_CODE is null) and'
      '      (om.OPERATION_MOVEMENT_TYPE_CODE = 11) and'
      '      (not exists'
      '        ( select'
      '            1'
      '          from'
      '            OPERATION_MOVEMENTS om2'
      '          where'
      
        '            (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso.MLMSO_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '            (om2.TO_MLMSO_OBJECT_CODE = mlmso.MLMSO_OBJECT_CODE)' +
        ' and'
      '            (om2.STORNO_EMPLOYEE_CODE is null) and'
      '            (om2.OPERATION_MOVEMENT_TYPE_CODE = 11) and'
      '            ( (om2.OM_DATE > om.OM_DATE) or'
      '              ( (om2.OM_DATE = om.OM_DATE) and'
      '                ( (om2.OM_TIME > om.OM_TIME) or'
      '                  ( (om2.OM_TIME = om.OM_TIME) and'
      '                    (om2.OM_CODE > om.OM_CODE)'
      '                  )'
      '                )'
      '              )'
      '            )'
      '        )'
      '      )'
      '  ) as OM_LOAD_TIME'
      ''
      'from'
      '  MATERIAL_LISTS ml,'
      '  SALES s,'
      '  PRODUCTION_ORDER_TYPES pot,'
      '  SALE_GROUPS sg,'
      '  MATERIAL_LIST_LINES mll,'
      '  ML_MODEL_STAGES mlms,'
      '  MLMS_OPERATIONS mlmso,'
      '  PRODUCTS dprod'
      ''
      'where'
      
        '  (sg.SALE_GROUP_OBJECT_BRANCH_CODE = s.SALE_GROUP_OBJECT_BRANCH' +
        '_CODE) and'
      '  (sg.SALE_GROUP_OBJECT_CODE = s.SALE_GROUP_OBJECT_CODE) and'
      ''
      
        '  (s.SALE_OBJECT_BRANCH_CODE = ml.BND_PROCESS_OBJECT_BRANCH_CODE' +
        ') and'
      '  (s.SALE_OBJECT_CODE = ml.BND_PROCESS_OBJECT_CODE) and'
      ''
      
        '  (s.PRODUCTION_ORDER_TYPE_CODE = pot.PRODUCTION_ORDER_TYPE_CODE' +
        ') and'
      ''
      '  (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH_CODE) and'
      '  (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      '  (mll.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_BRANCH_CODE) and'
      '  (mll.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) and'
      ''
      
        '  (mlms.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJECT_BRANCH_CODE)' +
        ' and'
      '  (mlms.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE) and'
      ''
      '  (mll.DETAIL_CODE = dprod.PRODUCT_CODE) and'
      ''
      '  (s.FINISH_EMPLOYEE_CODE is null) and'
      '  (s.ANNUL_EMPLOYEE_CODE is null) and'
      '  (ml.CLOSE_EMPLOYEE_CODE is null) and'
      '  (ml.ANNUL_EMPLOYEE_CODE is null) and'
      '  (mll.ANNUL_EMPLOYEE_CODE is null) and'
      '  (mlmso.MLMS_OPERATION_VARIANT_NO <> -1) and'
      ''
      '  ( (:IS_BEGIN_STORE_STAGE = 1) or'
      '    (mlms.ML_MODEL_STAGE_NO <> 0)'
      '  ) and'
      ''
      '  ( (:IS_NORMAL_STAGE = 1) or'
      '    (mlms.ML_MODEL_STAGE_NO = 0) or'
      '    (mlms.OUTGOING_WORKDAYS = 0)'
      '  ) and'
      ''
      '  ( (:IS_END_STORE_STAGE = 1) or'
      '    (mlms.OUTGOING_WORKDAYS <> 0)'
      '  ) and'
      ''
      '  ( (:ACTIVE_STATE is null) or'
      '    (:ACTIVE_STATE = 1) or'
      '    ( (:ACTIVE_STATE = 2) and'
      '      (ml.LIMITING_EMPLOYEE_CODE is null)'
      '    ) or'
      '    ( (:ACTIVE_STATE = 3) and'
      '      (ml.LIMITING_EMPLOYEE_CODE is not null)'
      '    )'
      '  ) and'
      ''
      '  ( (:VARIANT_ACTIVE_STATE is null) or'
      '    (:VARIANT_ACTIVE_STATE = 1) or'
      '    ( (:VARIANT_ACTIVE_STATE = 2) and'
      '      (mlmso.IS_ACTIVE = 0) and'
      '      (mlmso.MLMS_OPERATION_VARIANT_NO <> -1)'
      '    ) or'
      '    ( (:VARIANT_ACTIVE_STATE = 3) and'
      '      (mlmso.IS_ACTIVE = 1) and'
      '      (mlmso.MLMS_OPERATION_VARIANT_NO <> -1)'
      '    )'
      '  ) and'
      ''
      '  -- narochno nqma ALL_FILTERED_DEPTS'
      '  (exists'
      '    ( select'
      '        1'
      '      from'
      '        TEMP_FILTERED_DEPTS tfd'
      '      where'
      '        (tfd.DEPT_CODE = mlmso.DEPT_CODE)'
      '    )'
      '  ) and'
      ''
      '  ( (mlmso.TREATMENT_BEGIN_DATE >= :BEGIN_DATE) or'
      '    (ContextDate >= :BEGIN_DATE)'
      '  ) and'
      ''
      '  (mlmso.TREATMENT_BEGIN_DATE <= :END_DATE) and'
      '  (ContextDate <= :END_DATE) and'
      ''
      '  ( (:PRODUCTION_ORDER_BASE_TYPE_CODE is null) or'
      '    (:PRODUCTION_ORDER_BASE_TYPE_CODE = 0) or'
      
        '    (pot.PROD_ORDER_BASE_TYPE_CODE = :PRODUCTION_ORDER_BASE_TYPE' +
        '_CODE)'
      '  ) and'
      ''
      '  ( (:PRODUCTION_ORDER_TYPE_CODE is null) or'
      '    (s.PRODUCTION_ORDER_TYPE_CODE = :PRODUCTION_ORDER_TYPE_CODE)'
      '  ) and'
      ''
      '  ( (:SALE_BRANCH_CODE is null) or'
      '    (s.SALE_BRANCH_CODE = :SALE_BRANCH_CODE)'
      '  ) and'
      ''
      '  ( (:SALE_NO is null) or'
      '    (s.SALE_NO = :SALE_NO)'
      '  ) and'
      ''
      '  ( (:SALE_TYPE_CODE is null) or'
      '    (s.SALE_TYPE_CODE = :SALE_TYPE_CODE)'
      '  ) and'
      ''
      '  (mll.NO_AS_TEXT like :MLL_NO_AS_TEXT) and'
      ''
      '  ( (:MLL_FORK_NO is null) or'
      '    (mll.FORK_NO = :MLL_FORK_NO)'
      '  ) and'
      ''
      '  ( (:HAS_SPECIAL_CONTROL is null) or'
      '    (:HAS_SPECIAL_CONTROL = 2) or'
      '    (mlmso.HAS_SPECIAL_CONTROL = :HAS_SPECIAL_CONTROL)'
      '  ) and'
      ''
      '  ( (:IS_BEGIN_ORG_OPERATION = 1) or'
      '    (mlmso.OPERATION_TYPE_CODE <> 1)'
      '  ) and'
      ''
      '  ( (:IS_NORMAL_OPERATION = 1) or'
      '    (mlmso.OPERATION_TYPE_CODE <> 2)'
      '  ) and'
      ''
      '  ( (:IS_END_ORG_OPERATION = 1) or'
      '    (mlmso.OPERATION_TYPE_CODE <> 3)'
      '  ) and'
      ''
      '  ( (:HAS_NO_SETUP = 1) or'
      '    (mlmso.SETUP_PROFESSION_CODE is not null)'
      '  ) and'
      ''
      '  ( (:IS_SETUP_NOT_DONE = 1) or'
      '    (mlmso.SETUP_PROFESSION_CODE is null) or'
      '    (mlmso.SETUP_DATE is not null)'
      '  ) and'
      ''
      '  ( (:IS_SETUP_DONE = 1) or'
      '    (mlmso.SETUP_PROFESSION_CODE is null) or'
      '    (mlmso.SETUP_DATE is null)'
      '  ) and'
      ''
      
        '  -- purvoto Coalesce() na sledvashtia red e za da ne se oburkva' +
        ' orakala'
      '  ( Coalesce('
      '      ( select'
      '          Max(p.PRIORITY_NO)'
      '        from'
      '          PRIORITIES p'
      '        where'
      '          (p.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '      ),'
      '    0) between'
      '      Coalesce('
      '        ( select'
      '            Max(p.PRIORITY_NO)'
      '          from'
      '            PRIORITIES p'
      '          where'
      '            (p.PRIORITY_CODE = :BEGIN_PRIORITY_CODE)'
      '        ), 0) and'
      '      Coalesce('
      '        ( select'
      '            Max(p.PRIORITY_NO)'
      '          from'
      '            PRIORITIES p'
      '          where'
      '            (p.PRIORITY_CODE = :END_PRIORITY_CODE)'
      '        ), 1000000)'
      '  ) and'
      ''
      '  ( (1 = 1) or -- just include the params'
      '   (:OPERATION_STATUS is null) or'
      '   (:AVAILABLE_QUANTITY_STATUS is null) or'
      '   (:OP_AVAILABLE_QUANTITY_STATUS is null)'
      '  )'
      ''
      'order by'
      '  PRIORITY_NO,'
      '  WORK_PRIORITY_NO,'
      '  STAGE_DEPT_NAME,'
      '  SALE_BRANCH_NO,'
      '  s.SALE_NO,'
      '  NO_AS_FORMATED_TEXT_EX,'
      '  mll.FORK_NO,'
      '  mlms.ML_MODEL_STAGE_NO,'
      '  mlmso.MLMS_OPERATION_NO,'
      '  mlmso.MLMS_OPERATION_VARIANT_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'IS_AUTO_RECEIVING_OPERATION[mll~mlms~mlmso]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 
          'PRODUCT_COMPANY_PRODUCT_NAMES[mll.DETAIL_CODE~s.CLIENT_COMPANY_C' +
          'ODE]'
        ParamType = ptInput
        Value = #39'a'#39
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[mlmso]'
        ParamType = ptInput
        Value = '1'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[d]'
        ParamType = ptInput
        Value = '1'
      end>
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftWideString
        Name = 'CHOSEN_DEPTS'
        ParamType = ptInput
        Size = 4000
      end>
    Left = 360
    Top = 56
    object qryOperationalTasksMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationalTasksMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationalTasksMLMS_OPERATION_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_NO'
    end
    object qryOperationalTasksMLMS_OPERATION_VARIANT_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_VARIANT_NO'
    end
    object qryOperationalTasksOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryOperationalTasksMLMS_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_BRANCH_CODE'
    end
    object qryOperationalTasksMLMS_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_CODE'
    end
    object qryOperationalTasksML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryOperationalTasksIS_AUTO_RECEIVING_OPERATION: TAbmesFloatField
      FieldName = 'IS_AUTO_RECEIVING_OPERATION'
      FieldValueType = fvtBoolean
    end
    object qryOperationalTasksVARIANT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'VARIANT_DETAIL_TECH_QUANTITY'
    end
    object qryOperationalTasksLINE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'LINE_DETAIL_TECH_QUANTITY'
    end
    object qryOperationalTasksTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryOperationalTasksTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryOperationalTasksEFFECTIVE_TREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'EFFECTIVE_TREATMENT_BEGIN_DATE'
    end
    object qryOperationalTasksEFFECTIVE_TREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'EFFECTIVE_TREATMENT_END_DATE'
    end
    object qryOperationalTasksIS_LATE: TAbmesFloatField
      FieldName = 'IS_LATE'
    end
    object qryOperationalTasksMLL_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_BRANCH_CODE'
    end
    object qryOperationalTasksMLL_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_CODE'
    end
    object qryOperationalTasksNO_AS_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_TEXT'
      Size = 100
    end
    object qryOperationalTasksNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryOperationalTasksNO_AS_FORMATED_TEXT_EX: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT_EX'
      Size = 100
    end
    object qryOperationalTasksFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryOperationalTasksDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryOperationalTasksDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryOperationalTasksDETAIL_TECH_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'DETAIL_TECH_MEASURE_ABBREV'
      Size = 5
    end
    object qryOperationalTasksCLIENT_DETAIL_NAME: TAbmesWideStringField
      FieldName = 'CLIENT_DETAIL_NAME'
      Size = 250
    end
    object qryOperationalTasksML_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_BRANCH_CODE'
    end
    object qryOperationalTasksML_OBJECT_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_CODE'
    end
    object qryOperationalTasksSALE_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'SALE_OBJECT_BRANCH_CODE'
    end
    object qryOperationalTasksSALE_OBJECT_CODE: TAbmesFloatField
      FieldName = 'SALE_OBJECT_CODE'
    end
    object qryOperationalTasksPRODUCTION_ORDER_IDENTIFIER: TAbmesWideStringField
      FieldName = 'PRODUCTION_ORDER_IDENTIFIER'
      Size = 125
    end
    object qryOperationalTasksSALE_BRANCH_NO: TAbmesFloatField
      FieldName = 'SALE_BRANCH_NO'
    end
    object qryOperationalTasksIS_WASTE_COMPENSATOR: TAbmesFloatField
      FieldName = 'IS_WASTE_COMPENSATOR'
    end
    object qryOperationalTasksPRIORITY_CODE: TAbmesFloatField
      FieldName = 'PRIORITY_CODE'
    end
    object qryOperationalTasksPRIORITY_NO: TAbmesFloatField
      FieldName = 'PRIORITY_NO'
    end
    object qryOperationalTasksPRIORITY_COLOR: TAbmesFloatField
      FieldName = 'PRIORITY_COLOR'
    end
    object qryOperationalTasksPRIORITY_BACKGROUND_COLOR: TAbmesFloatField
      FieldName = 'PRIORITY_BACKGROUND_COLOR'
    end
    object qryOperationalTasksWORK_PRIORITY_CODE: TAbmesFloatField
      FieldName = 'WORK_PRIORITY_CODE'
    end
    object qryOperationalTasksWORK_PRIORITY_NO: TAbmesFloatField
      FieldName = 'WORK_PRIORITY_NO'
    end
    object qryOperationalTasksSHOW_NO: TAbmesWideStringField
      FieldName = 'SHOW_NO'
      Size = 122
    end
    object qryOperationalTasksHAS_DOCUMENTATION: TAbmesFloatField
      FieldName = 'HAS_DOCUMENTATION'
    end
    object qryOperationalTasksHAS_SPECIAL_CONTROL: TAbmesFloatField
      FieldName = 'HAS_SPECIAL_CONTROL'
    end
    object qryOperationalTasksSTAGE_DEPT_CODE: TAbmesFloatField
      FieldName = 'STAGE_DEPT_CODE'
    end
    object qryOperationalTasksSTAGE_DEPT_NAME: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_NAME'
      Size = 100
    end
    object qryOperationalTasksSTAGE_DEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_IDENTIFIER'
      Size = 16
    end
    object qryOperationalTasksDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
    object qryOperationalTasksDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryOperationalTasksDEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'DEPT_IDENTIFIER'
      Size = 16
    end
    object qryOperationalTasksSETUP_PROFESSION_CODE: TAbmesFloatField
      FieldName = 'SETUP_PROFESSION_CODE'
    end
    object qryOperationalTasksSETUP_EFFORT_COEF: TAbmesFloatField
      FieldName = 'SETUP_EFFORT_COEF'
    end
    object qryOperationalTasksSETUP_HOUR_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'SETUP_HOUR_TECH_QUANTITY'
    end
    object qryOperationalTasksSETUP_COUNT: TAbmesFloatField
      FieldName = 'SETUP_COUNT'
    end
    object qryOperationalTasksREMAINING_SETUP_COUNT: TAbmesFloatField
      FieldName = 'REMAINING_SETUP_COUNT'
    end
    object qryOperationalTasksPROFESSION_CODE: TAbmesFloatField
      FieldName = 'PROFESSION_CODE'
    end
    object qryOperationalTasksEFFORT_COEF: TAbmesFloatField
      FieldName = 'EFFORT_COEF'
    end
    object qryOperationalTasksHOUR_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'HOUR_TECH_QUANTITY'
    end
    object qryOperationalTasksPROGRAM_TOOL_PRODUCT_CODE: TAbmesFloatField
      FieldName = 'PROGRAM_TOOL_PRODUCT_CODE'
    end
    object qryOperationalTasksSPECIFIC_TOOL_PRODUCT_CODE: TAbmesFloatField
      FieldName = 'SPECIFIC_TOOL_PRODUCT_CODE'
    end
    object qryOperationalTasksTYPICAL_TOOL_PRODUCT_CODE: TAbmesFloatField
      FieldName = 'TYPICAL_TOOL_PRODUCT_CODE'
    end
    object qryOperationalTasksPROGRAM_TOOL_REQUIREMENT_CODE: TAbmesFloatField
      FieldName = 'PROGRAM_TOOL_REQUIREMENT_CODE'
    end
    object qryOperationalTasksSPECIFIC_TOOL_REQUIREMENT_CODE: TAbmesFloatField
      FieldName = 'SPECIFIC_TOOL_REQUIREMENT_CODE'
    end
    object qryOperationalTasksTYPICAL_TOOL_REQUIREMENT_CODE: TAbmesFloatField
      FieldName = 'TYPICAL_TOOL_REQUIREMENT_CODE'
    end
    object qryOperationalTasksPROGRAM_TOOL_IS_COMPLETE: TAbmesFloatField
      FieldName = 'PROGRAM_TOOL_IS_COMPLETE'
    end
    object qryOperationalTasksSPECIFIC_TOOL_IS_COMPLETE: TAbmesFloatField
      FieldName = 'SPECIFIC_TOOL_IS_COMPLETE'
    end
    object qryOperationalTasksTYPICAL_TOOL_IS_COMPLETE: TAbmesFloatField
      FieldName = 'TYPICAL_TOOL_IS_COMPLETE'
    end
    object qryOperationalTasksDOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DOC_BRANCH_CODE'
    end
    object qryOperationalTasksDOC_CODE: TAbmesFloatField
      FieldName = 'DOC_CODE'
    end
    object qryOperationalTasksDETAIL_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_BRANCH_CODE'
    end
    object qryOperationalTasksDETAIL_DOC_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_CODE'
    end
    object qryOperationalTasksIS_SETUP_DONE: TAbmesFloatField
      FieldName = 'IS_SETUP_DONE'
      FieldValueType = fvtBoolean
    end
    object qryOperationalTasksOPERATION_VARIANT_COUNT: TAbmesFloatField
      FieldName = 'OPERATION_VARIANT_COUNT'
    end
    object qryOperationalTasksIS_FIRST_OPERATION_IN_STAGE: TAbmesFloatField
      FieldName = 'IS_FIRST_OPERATION_IN_STAGE'
      FieldValueType = fvtBoolean
    end
    object qryOperationalTasksIS_LAST_OPERATION_IN_STAGE: TAbmesFloatField
      FieldName = 'IS_LAST_OPERATION_IN_STAGE'
      FieldValueType = fvtBoolean
    end
    object qryOperationalTasksIS_FIRST_STAGE_IN_MLL: TAbmesFloatField
      FieldName = 'IS_FIRST_STAGE_IN_MLL'
      FieldValueType = fvtBoolean
    end
    object qryOperationalTasksIS_LAST_STAGE_IN_MLL: TAbmesFloatField
      FieldName = 'IS_LAST_STAGE_IN_MLL'
      FieldValueType = fvtBoolean
    end
    object qryOperationalTasksOPERATION_KIND: TAbmesFloatField
      DisplayWidth = 1
      FieldName = 'OPERATION_KIND'
    end
    object qryOperationalTasksNEXT_OPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'NEXT_OPERATION_TYPE_CODE'
    end
    object qryOperationalTasksREMAINING_WASTE_QUANTITY: TAbmesFloatField
      FieldName = 'REMAINING_WASTE_QUANTITY'
    end
    object qryOperationalTasksIN_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'IN_DETAIL_TECH_QUANTITY'
    end
    object qryOperationalTasksOUT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OUT_DETAIL_TECH_QUANTITY'
    end
    object qryOperationalTasksIS_RECORD_CHANGED: TAbmesFloatField
      FieldName = 'IS_RECORD_CHANGED'
    end
    object qryOperationalTasksTO_ENTER_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_ENTER_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryOperationalTasksAVAILABLE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'AVAILABLE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryOperationalTasksTO_LEAVE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_LEAVE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryOperationalTasksVARIANT_SETUP_TIME: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'VARIANT_SETUP_TIME'
      Calculated = True
    end
    object qryOperationalTasksVARIANT_WORK_TIME: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'VARIANT_WORK_TIME'
      Calculated = True
    end
    object qryOperationalTasksREMAINING_SETUP_TIME: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'REMAINING_SETUP_TIME'
      Calculated = True
    end
    object qryOperationalTasksREMAINING_WORK_TIME: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'REMAINING_WORK_TIME'
      Calculated = True
    end
    object qryOperationalTasksSETUP_NO_AS_TEXT: TAbmesWideStringField
      FieldKind = fkCalculated
      FieldName = 'SETUP_NO_AS_TEXT'
      Size = 100
      Calculated = True
    end
    object qryOperationalTasksSETUP_FORK_NO: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'SETUP_FORK_NO'
      Calculated = True
    end
    object qryOperationalTasksSETUP_DETAIL_NAME: TAbmesWideStringField
      FieldKind = fkCalculated
      FieldName = 'SETUP_DETAIL_NAME'
      Size = 100
      Calculated = True
    end
    object qryOperationalTasksSETUP_DETAIL_TECH_MEASURE_ABBR: TAbmesWideStringField
      FieldKind = fkCalculated
      FieldName = 'SETUP_DETAIL_TECH_MEASURE_ABBR'
      Size = 5
      Calculated = True
    end
    object qryOperationalTasksSETUP_SHOW_NO: TAbmesWideStringField
      FieldKind = fkCalculated
      FieldName = 'SETUP_SHOW_NO'
      Size = 100
      Calculated = True
    end
    object qryOperationalTasksHAS_DNC_DOC_ITEMS: TAbmesFloatField
      FieldName = 'HAS_DNC_DOC_ITEMS'
    end
    object qryOperationalTasksMATERIAL_CODE: TAbmesFloatField
      FieldName = 'MATERIAL_CODE'
    end
    object qryOperationalTasksMATERIAL_NO: TAbmesFloatField
      FieldName = 'MATERIAL_NO'
    end
    object qryOperationalTasksMATERIAL_NAME: TAbmesWideStringField
      FieldName = 'MATERIAL_NAME'
      Size = 100
    end
    object qryOperationalTasksMATERIAL_WORK_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'MATERIAL_WORK_MEASURE_ABBREV'
      Size = 5
    end
    object qryOperationalTasksMATERIAL_TECH_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'MATERIAL_TECH_MEASURE_ABBREV'
      Size = 5
    end
    object qryOperationalTasksMATERIAL_TECH_MEASURE_COEF: TAbmesFloatField
      FieldName = 'MATERIAL_TECH_MEASURE_COEF'
    end
    object qryOperationalTasksMATERIAL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'MATERIAL_TECH_QUANTITY'
    end
    object qryOperationalTasksTO_ENTER_MATERIAL_WORK_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_ENTER_MATERIAL_WORK_QUANTITY'
      Calculated = True
    end
    object qryOperationalTasksPROGRAM_TOOL_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'PROGRAM_TOOL_DOC_BRANCH_CODE'
    end
    object qryOperationalTasksPROGRAM_TOOL_DOC_CODE: TAbmesFloatField
      FieldName = 'PROGRAM_TOOL_DOC_CODE'
    end
    object qryOperationalTasksSPECIFIC_TOOL_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'SPECIFIC_TOOL_DOC_BRANCH_CODE'
    end
    object qryOperationalTasksSPECIFIC_TOOL_DOC_CODE: TAbmesFloatField
      FieldName = 'SPECIFIC_TOOL_DOC_CODE'
    end
    object qryOperationalTasksTYPICAL_TOOL_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'TYPICAL_TOOL_DOC_BRANCH_CODE'
    end
    object qryOperationalTasksTYPICAL_TOOL_DOC_CODE: TAbmesFloatField
      FieldName = 'TYPICAL_TOOL_DOC_CODE'
    end
    object qryOperationalTasksMLMSO_IS_AUTO_SETUP: TAbmesFloatField
      FieldName = 'MLMSO_IS_AUTO_SETUP'
      Required = True
    end
    object qryOperationalTasksMLMSO_IS_AUTO_MOVEMENT: TAbmesFloatField
      FieldName = 'MLMSO_IS_AUTO_MOVEMENT'
      Required = True
    end
    object qryOperationalTasksDEPT_HAS_DOC_ITEMS: TAbmesFloatField
      FieldName = 'DEPT_HAS_DOC_ITEMS'
    end
    object qryOperationalTasksDEPT_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DEPT_DOC_BRANCH_CODE'
    end
    object qryOperationalTasksDEPT_DOC_CODE: TAbmesFloatField
      FieldName = 'DEPT_DOC_CODE'
    end
    object qryOperationalTasksDEPT_PRODUCT_CODE: TAbmesFloatField
      FieldName = 'DEPT_PRODUCT_CODE'
    end
    object qryOperationalTasksMANAGER_EMPLOYEE_NO: TAbmesFloatField
      FieldName = 'MANAGER_EMPLOYEE_NO'
    end
    object qryOperationalTasksMANAGER_EMPLOYEE_NAME: TAbmesWideStringField
      FieldName = 'MANAGER_EMPLOYEE_NAME'
      Size = 152
    end
    object qryOperationalTasksDETAIL_NO: TAbmesFloatField
      FieldName = 'DETAIL_NO'
    end
    object qryOperationalTasksMLL_TYPE: TAbmesFloatField
      FieldName = 'MLL_TYPE'
    end
    object qryOperationalTasksCONSUME_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'CONSUME_BEGIN_DATE'
    end
    object qryOperationalTasksCONSUME_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'CONSUME_END_DATE'
    end
    object qryOperationalTasksIS_BEGIN_STORE_STAGE: TAbmesFloatField
      FieldName = 'IS_BEGIN_STORE_STAGE'
      FieldValueType = fvtBoolean
    end
    object qryOperationalTasksIS_NORMAL_STAGE: TAbmesFloatField
      FieldName = 'IS_NORMAL_STAGE'
      FieldValueType = fvtBoolean
    end
    object qryOperationalTasksIS_END_STORE_STAGE: TAbmesFloatField
      FieldName = 'IS_END_STORE_STAGE'
      FieldValueType = fvtBoolean
    end
    object qryOperationalTasksDONE_SETUP_COUNT: TAbmesFloatField
      FieldName = 'DONE_SETUP_COUNT'
    end
    object qryOperationalTasksDONE_SETUP_DATE: TAbmesSQLTimeStampField
      FieldName = 'DONE_SETUP_DATE'
    end
    object qryOperationalTasksDONE_SETUP_TIME: TAbmesSQLTimeStampField
      FieldName = 'DONE_SETUP_TIME'
    end
    object qryOperationalTasksENTER_SH_STORE_PLAN_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'ENTER_SH_STORE_PLAN_BEGIN_DATE'
    end
    object qryOperationalTasksENTER_SH_STORE_PLAN_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'ENTER_SH_STORE_PLAN_END_DATE'
    end
    object qryOperationalTasksDETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'DETAIL_TECH_QUANTITY'
    end
    object qryOperationalTasksDETAIL_PARAMS_EXPORT_DATA: TAbmesWideStringField
      FieldName = 'DETAIL_PARAMS_EXPORT_DATA'
      Size = 250
    end
    object qryOperationalTasksOP_AVAILABLE_DETAIL_TECH_QTY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'OP_AVAILABLE_DETAIL_TECH_QTY'
      Calculated = True
    end
    object qryOperationalTasksOP_IN_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OP_IN_DETAIL_TECH_QUANTITY'
    end
    object qryOperationalTasksOP_OUT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OP_OUT_DETAIL_TECH_QUANTITY'
    end
    object qryOperationalTasksOP_OLD_IN_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OP_OLD_IN_DETAIL_TECH_QUANTITY'
    end
    object qryOperationalTasksSALE_NO: TAbmesFloatField
      FieldName = 'SALE_NO'
    end
    object qryOperationalTasksOM_LOAD_TO_DEPT_ZONE_NO: TAbmesFloatField
      FieldName = 'OM_LOAD_TO_DEPT_ZONE_NO'
    end
    object qryOperationalTasksOM_LOAD_TO_EMPLOYEE_NO: TAbmesFloatField
      FieldName = 'OM_LOAD_TO_EMPLOYEE_NO'
    end
    object qryOperationalTasksOM_LOAD_TO_EMPLOYEE_NAME: TAbmesWideStringField
      FieldName = 'OM_LOAD_TO_EMPLOYEE_NAME'
      Size = 101
    end
    object qryOperationalTasksOM_LOAD_DATE: TAbmesSQLTimeStampField
      FieldName = 'OM_LOAD_DATE'
    end
    object qryOperationalTasksOM_LOAD_TIME: TAbmesSQLTimeStampField
      FieldName = 'OM_LOAD_TIME'
    end
  end
  object prvOperationalTasks: TDataSetProvider
    DataSet = qryOperationalTasks
    UpdateMode = upWhereKeyOnly
    OnGetData = prvOperationalTasksGetData
    Left = 360
    Top = 8
  end
  object qryOneMLMS: TAbmesSQLQuery
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlms.MLMS_OBJECT_BRANCH_CODE,'
      '  mlms.MLMS_OBJECT_CODE,'
      ''
      '  ( select'
      '      ( ( select'
      '            pot.PRODUCTION_ORDER_TYPE_ABBREV'
      '          from'
      '            PRODUCTION_ORDER_TYPES pot'
      '          where'
      
        '            (pot.PRODUCTION_ORDER_TYPE_CODE = s.PRODUCTION_ORDER' +
        '_TYPE_CODE)'
      '        ) ||'
      '        '#39'/'#39' ||'
      '        ( select'
      '            d.CUSTOM_CODE'
      '          from'
      '            DEPTS d'
      '          where'
      '            (d.DEPT_CODE = s.SALE_BRANCH_CODE)'
      '        ) ||'
      '        '#39'/'#39' ||'
      '        s.SALE_NO ||'
      '        '#39'/'#39' ||'
      '        ( select'
      '            st.SALE_TYPE_ABBREV'
      '          from'
      '            SALE_TYPES st'
      '          where'
      '            (st.SALE_TYPE_CODE = s.SALE_TYPE_CODE)'
      '        )'
      '      )'
      '    from'
      '      SALES s'
      '    where'
      
        '      (ml.BND_PROCESS_OBJECT_BRANCH_CODE = s.SALE_OBJECT_BRANCH_' +
        'CODE) and'
      '      (ml.BND_PROCESS_OBJECT_CODE = s.SALE_OBJECT_CODE)'
      '  ) as SALE_IDENTIFIER,'
      ''
      '  ( select'
      '      prt.PRIORITY_NO'
      '    from'
      '      SALES s,'
      '      SALE_GROUPS sg,'
      '      PRIORITIES prt'
      '    where'
      
        '      (s.SALE_OBJECT_BRANCH_CODE = ml.BND_PROCESS_OBJECT_BRANCH_' +
        'CODE) and'
      '      (s.SALE_OBJECT_CODE = ml.BND_PROCESS_OBJECT_CODE) and'
      
        '      (sg.SALE_GROUP_OBJECT_BRANCH_CODE = s.SALE_GROUP_OBJECT_BR' +
        'ANCH_CODE) and'
      '      (sg.SALE_GROUP_OBJECT_CODE = s.SALE_GROUP_OBJECT_CODE) and'
      '      (prt.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '  ) as PRIORITY_NO,'
      ''
      '  ( select'
      '      prt.PRIORITY_COLOR'
      '    from'
      '      SALES s,'
      '      SALE_GROUPS sg,'
      '      PRIORITIES prt'
      '    where'
      
        '      (s.SALE_OBJECT_BRANCH_CODE = ml.BND_PROCESS_OBJECT_BRANCH_' +
        'CODE) and'
      '      (s.SALE_OBJECT_CODE = ml.BND_PROCESS_OBJECT_CODE) and'
      
        '      (sg.SALE_GROUP_OBJECT_BRANCH_CODE = s.SALE_GROUP_OBJECT_BR' +
        'ANCH_CODE) and'
      '      (sg.SALE_GROUP_OBJECT_CODE = s.SALE_GROUP_OBJECT_CODE) and'
      '      (prt.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '  ) as PRIORITY_COLOR,'
      ''
      '  ( select'
      '      prt.PRIORITY_BACKGROUND_COLOR'
      '    from'
      '      SALES s,'
      '      SALE_GROUPS sg,'
      '      PRIORITIES prt'
      '    where'
      
        '      (s.SALE_OBJECT_BRANCH_CODE = ml.BND_PROCESS_OBJECT_BRANCH_' +
        'CODE) and'
      '      (s.SALE_OBJECT_CODE = ml.BND_PROCESS_OBJECT_CODE) and'
      
        '      (sg.SALE_GROUP_OBJECT_BRANCH_CODE = s.SALE_GROUP_OBJECT_BR' +
        'ANCH_CODE) and'
      '      (sg.SALE_GROUP_OBJECT_CODE = s.SALE_GROUP_OBJECT_CODE) and'
      '      (prt.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '  ) as PRIORITY_BACKGROUND_COLOR,'
      ''
      '  ( select'
      '      wp.WORK_PRIORITY_NO'
      '    from'
      '      SALES s,'
      '      WORK_PRIORITIES wp'
      '    where'
      
        '      (s.SALE_OBJECT_BRANCH_CODE = ml.BND_PROCESS_OBJECT_BRANCH_' +
        'CODE) and'
      '      (s.SALE_OBJECT_CODE = ml.BND_PROCESS_OBJECT_CODE) and'
      '      (wp.WORK_PRIORITY_CODE = s.WORK_PRIORITY_CODE)'
      '  ) as WORK_PRIORITY_NO,'
      ''
      '  mll.NO_AS_TEXT,'
      '  mll.FORK_NO,'
      ''
      '  mll.DETAIL_CODE,'
      ''
      '  ('
      '    select'
      '      p.NAME as DETAIL_NAME'
      '    from'
      '      PRODUCTS p'
      '    where'
      '      (p.PRODUCT_CODE = mll.DETAIL_CODE)'
      '  ) as DETAIL_NAME,'
      ''
      '  ('
      '    select'
      '      m.MEASURE_ABBREV as DETAIL_MEASURE_ABBREV'
      '    from'
      '      PRODUCTS p,'
      '      MEASURES m'
      '    where'
      '      (p.PRODUCT_CODE = mll.DETAIL_CODE) and'
      '      (p.TECH_MEASURE_CODE = m.MEASURE_CODE)'
      '  ) as DETAIL_TECH_MEASURE_ABBREV,'
      ''
      '  mll.LINE_DETAIL_TECH_QUANTITY,'
      ''
      '  mlms.ML_MODEL_STAGE_NO,'
      ''
      '  ('
      '    select'
      
        '      (dt.DEPT_TYPE_ABBREV || d.CUSTOM_CODE || d.SUFFIX_LETTER) ' +
        'as DEPT_IDENTIFIER'
      '    from'
      '      DEPTS d,'
      '      DEPT_TYPES dt'
      '    where'
      '      (d.DEPT_TYPE_CODE = dt.DEPT_TYPE_CODE(+)) and'
      '      (d.DEPT_CODE = mlms.DEPT_CODE)'
      '  ) as DEPT_IDENTIFIER,'
      ''
      '  mlms.TREATMENT_WORKDAYS,'
      '  mlms.OUTGOING_WORKDAYS,'
      ''
      
        '  Decode(mlms.TREATMENT_WORKDAYS, 0, par_mlms.TREATMENT_BEGIN_DA' +
        'TE, mlms.TREATMENT_BEGIN_DATE) as TREATMENT_BEGIN_DATE,'
      
        '  Decode(mlms.TREATMENT_WORKDAYS, 0, par_mlms.TREATMENT_END_DATE' +
        ', mlms.TREATMENT_END_DATE) as TREATMENT_END_DATE,'
      ''
      '  mlms.DOC_BRANCH_CODE,'
      '  mlms.DOC_CODE'
      ''
      'from'
      '  ML_MODEL_STAGES mlms,'
      '  MATERIAL_LIST_LINES mll,'
      '  MATERIAL_LISTS ml,'
      '  MATERIAL_LIST_LINES pmll,'
      '  ML_MODEL_STAGES par_mlms'
      ''
      'where'
      '  (mlms.MLL_OBJECT_BRANCH_CODE = mll.MLL_OBJECT_BRANCH_CODE) and'
      '  (mlms.MLL_OBJECT_CODE = mll.MLL_OBJECT_CODE) and'
      ''
      '  (mll.ML_OBJECT_BRANCH_CODE = ml.ML_OBJECT_BRANCH_CODE) and'
      '  (mll.ML_OBJECT_CODE = ml.ML_OBJECT_CODE) and'
      ''
      
        '  (mll.PARENT_MLL_OBJECT_BRANCH_CODE = pmll.MLL_OBJECT_BRANCH_CO' +
        'DE(+)) and'
      '  (mll.PARENT_MLL_OBJECT_CODE = pmll.MLL_OBJECT_CODE(+)) and'
      ''
      
        '  (pmll.MLL_OBJECT_BRANCH_CODE = par_mlms.MLL_OBJECT_BRANCH_CODE' +
        '(+)) and'
      '  (pmll.MLL_OBJECT_CODE = par_mlms.MLL_OBJECT_CODE(+)) and'
      '  (1 = par_mlms.ML_MODEL_STAGE_NO(+)) and'
      ''
      '  (mlms.MLMS_OBJECT_BRANCH_CODE = :MLMS_OBJECT_BRANCH_CODE) and'
      '  (mlms.MLMS_OBJECT_CODE = :MLMS_OBJECT_CODE)')
    SQLConnection = SQLConn
    Macros = <>
    MacroParams = <>
    CustomParams = <>
    Left = 48
    Top = 256
    object qryOneMLMSMLMS_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOneMLMSMLMS_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOneMLMSSALE_IDENTIFIER: TAbmesWideStringField
      FieldName = 'SALE_IDENTIFIER'
      Size = 182
    end
    object qryOneMLMSPRIORITY_NO: TAbmesFloatField
      FieldName = 'PRIORITY_NO'
    end
    object qryOneMLMSPRIORITY_COLOR: TAbmesFloatField
      FieldName = 'PRIORITY_COLOR'
    end
    object qryOneMLMSPRIORITY_BACKGROUND_COLOR: TAbmesFloatField
      FieldName = 'PRIORITY_BACKGROUND_COLOR'
    end
    object qryOneMLMSWORK_PRIORITY_NO: TAbmesFloatField
      FieldName = 'WORK_PRIORITY_NO'
    end
    object qryOneMLMSDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryOneMLMSDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryOneMLMSDETAIL_TECH_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'DETAIL_TECH_MEASURE_ABBREV'
      Size = 5
    end
    object qryOneMLMSLINE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'LINE_DETAIL_TECH_QUANTITY'
    end
    object qryOneMLMSML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryOneMLMSDEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'DEPT_IDENTIFIER'
      Size = 46
    end
    object qryOneMLMSTREATMENT_WORKDAYS: TAbmesFloatField
      FieldName = 'TREATMENT_WORKDAYS'
    end
    object qryOneMLMSOUTGOING_WORKDAYS: TAbmesFloatField
      FieldName = 'OUTGOING_WORKDAYS'
    end
    object qryOneMLMSTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryOneMLMSTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryOneMLMSDOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DOC_BRANCH_CODE'
    end
    object qryOneMLMSDOC_CODE: TAbmesFloatField
      FieldName = 'DOC_CODE'
    end
    object qryOneMLMSNO_AS_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_TEXT'
      Size = 100
    end
    object qryOneMLMSFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
  end
  object qryOperationInputWhenNotFirst: TAbmesSQLQuery
    OnCalcFields = qryOperationInputWhenNotFirstCalcFields
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO,'
      '  mlmso2.OPERATION_TYPE_CODE,'
      ''
      '  mll2.ML_OBJECT_BRANCH_CODE,'
      '  mll2.ML_OBJECT_CODE,'
      '  mll2.MLL_OBJECT_BRANCH_CODE,'
      '  mll2.MLL_OBJECT_CODE,'
      ''
      '  ( select'
      '      ot.OPERATION_TYPE_ABBREV'
      '    from'
      '      OPERATION_TYPES ot'
      '    where'
      '      (ot.OPERATION_TYPE_CODE = mlmso2.OPERATION_TYPE_CODE)'
      '  ) as OPERATION_TYPE_ABBREV,'
      ''
      
        '  (mlms2.ML_MODEL_STAGE_NO || '#39'-'#39' || mlmso2.MLMS_OPERATION_NO ||' +
        ' '#39'.'#39' || mlmso2.MLMS_OPERATION_VARIANT_NO) as SHOW_NO,'
      ''
      '  mlmso2.TREATMENT_BEGIN_DATE,'
      '  mlmso2.TREATMENT_END_DATE,'
      '  mlmso2.TREATMENT_BEGIN_DATE as TREATMENT_DATE,'
      
        '  NullIf(%COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DAT' +
        'E], 0) as RESERVE_DAYS,'
      ''
      '  mlmso2.DEPT_CODE,'
      '  ( select'
      '      d2.NAME'
      '    from'
      '      DEPTS d2'
      '    where'
      '      (d2.DEPT_CODE = mlmso2.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      ''
      '  mlms2.ML_MODEL_STAGE_NO,'
      ''
      '  ( select'
      '      d3.NAME'
      '    from'
      '      DEPTS d3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE)'
      '  ) as STAGE_DEPT_NAME,'
      ''
      '  ( select'
      
        '      (dt3.DEPT_TYPE_ABBREV || d3.CUSTOM_CODE || d3.SUFFIX_LETTE' +
        'R)'
      '    from'
      '      DEPTS d3,'
      '      DEPT_TYPES dt3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE) and'
      '      (d3.DEPT_TYPE_CODE = dt3.DEPT_TYPE_CODE(+))'
      '  ) as STAGE_DEPT_IDENTIFIER,'
      ''
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      ''
      '  mll2.DETAIL_CODE,'
      ''
      '  dprod2.NAME as DETAIL_NAME,'
      ''
      '  dprod2.DOC_BRANCH_CODE as DETAIL_DOC_BRANCH_CODE,'
      '  dprod2.DOC_CODE as DETAIL_DOC_CODE,'
      '  %HAS_DOC_ITEMS[dprod2] as DETAIL_HAS_DOC,'
      ''
      '  ( select'
      '      m.MEASURE_ABBREV'
      '    from'
      '      MEASURES m'
      '    where'
      '      (dprod2.TECH_MEASURE_CODE = m.MEASURE_CODE)'
      '  ) as DETAIL_TECH_MEASURE_ABBREV,'
      ''
      '  ( select'
      
        '      %PRODUCT_COMPANY_PRODUCT_NAMES[mll2.DETAIL_CODE~s2.CLIENT_' +
        'COMPANY_CODE]'
      '    from'
      '      SALES s2'
      '    where'
      '      ( (s2.SALE_OBJECT_BRANCH_CODE, s2.SALE_OBJECT_CODE) ='
      '        ( select'
      
        '            ml2.BND_PROCESS_OBJECT_BRANCH_CODE, ml2.BND_PROCESS_' +
        'OBJECT_CODE'
      '          from'
      '            MATERIAL_LISTS ml2'
      '          where'
      
        '            (ml2.ML_OBJECT_BRANCH_CODE = mll2.ML_OBJECT_BRANCH_C' +
        'ODE) and'
      '            (ml2.ML_OBJECT_CODE = mll2.ML_OBJECT_CODE)'
      '        )'
      '      )'
      '  ) as CLIENT_DETAIL_NAME,'
      ''
      '  mlmso2.DOC_BRANCH_CODE,'
      '  mlmso2.DOC_CODE,'
      ''
      '  %HAS_DOC_ITEMS[mlmso2] as HAS_DOCUMENTATION,'
      ''
      '  mlmso2.SETUP_PROFESSION_CODE,'
      '  Nvl2(mlmso2.SETUP_DATE, 1, 0) as IS_SETUP_DONE,'
      ''
      '  mlmso2.HOUR_TECH_QUANTITY,'
      ''
      '  mlmso2.VARIANT_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      '    Decode('
      '      mlms2.ML_MODEL_STAGE_NO,'
      '      0,'
      '      ( select'
      
        '          Coalesce((Sum(asd.REAL_QUANTITY) keep (dense_rank last' +
        ' order by asd.STORE_DEAL_DATE) * mprod2.TECH_MEASURE_COEF / mll2' +
        '.PRODUCT_TECH_QUANTITY), 0)'
      '        from'
      '          AGGR_STORE_DEALS asd'
      '        where'
      '          (asd.PRODUCT_CODE = mll2.PRODUCT_CODE) and'
      '          (asd.STORE_CODE = mlms2.DEPT_CODE) and'
      '          (asd.STORE_DEAL_DATE <= ContextDate)'
      '      ),'
      '      0'
      '    )'
      '  ) as STORE_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      
        '    Greatest( -- ostavasht za razpredeliane brak ot predhodni op' +
        'eracii sled kato e razpredelen po sledvashtite varianti na nasha' +
        'ta operacia'
      '      0,'
      '      ('
      '        ( -- brak po predhodinte operacii i etapi ot toia red'
      '          select'
      '            Coalesce(Sum(om3.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '          from'
      '            ML_MODEL_STAGES mlms3,'
      '            MLMS_OPERATIONS mlmso3,'
      '            OPERATION_MOVEMENTS om3'
      '          where'
      
        '            (mlms3.MLL_OBJECT_BRANCH_CODE = mll2.MLL_OBJECT_BRAN' +
        'CH_CODE) and'
      '            (mlms3.MLL_OBJECT_CODE = mll2.MLL_OBJECT_CODE) and'
      ''
      
        '            (mlms3.MLMS_OBJECT_BRANCH_CODE = mlmso3.MLMS_OBJECT_' +
        'BRANCH_CODE) and'
      
        '            (mlms3.MLMS_OBJECT_CODE = mlmso3.MLMS_OBJECT_CODE) a' +
        'nd'
      ''
      
        '            (om3.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso3.MLMSO_OB' +
        'JECT_BRANCH_CODE) and'
      
        '            (om3.FROM_MLMSO_OBJECT_CODE = mlmso3.MLMSO_OBJECT_CO' +
        'DE) and'
      ''
      '            (om3.STORNO_EMPLOYEE_CODE is null) and'
      '            (om3.TO_DEPT_CODE is not null) and'
      ''
      
        '            ( (mlms3.ML_MODEL_STAGE_NO < mlms2.ML_MODEL_STAGE_NO' +
        ') or'
      
        '              ( (mlms3.ML_MODEL_STAGE_NO = mlms2.ML_MODEL_STAGE_' +
        'NO) and'
      
        '                (mlmso3.MLMS_OPERATION_NO < mlmso2.MLMS_OPERATIO' +
        'N_NO)'
      '              )'
      '            )'
      '        )'
      '        -'
      
        '        ( -- ostavashto za vlizane po sledvashtite variatni na n' +
        'ashata operacia'
      '          select'
      '            Coalesce('
      '              Sum('
      '                mlmso3.VARIANT_DETAIL_TECH_QUANTITY'
      '                -'
      
        '                ( -- vliazlo v operaciata mlmso2 ot drugi operac' +
        'ii'
      '                  select'
      
        '                    Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY),' +
        ' 0)'
      '                  from'
      '                    OPERATION_MOVEMENTS om'
      '                  where'
      
        '                    (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso3.MLM' +
        'SO_OBJECT_BRANCH_CODE) and'
      
        '                    (om.TO_MLMSO_OBJECT_CODE = mlmso3.MLMSO_OBJE' +
        'CT_CODE) and'
      '                    (om.STORNO_EMPLOYEE_CODE is null) and'
      '                    (om.TO_DEPT_CODE is null) and'
      '                    (not'
      
        '                      ( (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlms' +
        'o3.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                        (om.FROM_MLMSO_OBJECT_CODE = mlmso3.MLMS' +
        'O_OBJECT_CODE)'
      '                      )'
      '                    )'
      '                )'
      '              ),'
      '              0'
      '            )'
      '          from'
      '            MLMS_OPERATIONS mlmso3'
      '          where'
      
        '            (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT' +
        '_BRANCH_CODE) and'
      
        '            (mlmso3.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) ' +
        'and'
      
        '            (mlmso3.MLMS_OPERATION_NO = mlmso2.MLMS_OPERATION_NO' +
        ') and'
      
        '            (mlmso3.MLMS_OPERATION_VARIANT_NO > mlmso2.MLMS_OPER' +
        'ATION_VARIANT_NO)'
      '        )'
      '      )'
      '    )'
      '  ) as WASTED_BEFORE_TECH_QUANTITY,'
      ''
      '/*'
      
        '  MiscUtils.LargeZero( -- vliazlo v nashata operacia ot drugi op' +
        'eracii'
      '    case'
      '      when (mll2.PRODUCT_CODE is null) and'
      '           (mlms2.ML_MODEL_STAGE_NO = 1) and'
      '           (mlmso2.MLMS_OPERATION_NO ='
      '              ( select'
      '                  Min(mlmso3.MLMS_OPERATION_NO)'
      '                from'
      '                  MLMS_OPERATIONS mlmso3'
      '                where'
      
        '                  (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_O' +
        'BJECT_BRANCH_CODE) and'
      
        '                  (mlmso3.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_C' +
        'ODE)'
      '              )'
      '           ) then'
      
        '        Coalesce((%MLL_COMPLECTATION_PERCENT[mll2] * mlmso2.VARI' +
        'ANT_DETAIL_TECH_QUANTITY), 0)'
      '    else'
      '      ( select'
      '          Coalesce(Sum(om2.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '        from'
      '          OPERATION_MOVEMENTS om2'
      '        where'
      
        '          (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_OBJECT' +
        '_BRANCH_CODE) and'
      
        '          (om2.TO_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_CODE) ' +
        'and'
      '          (om2.STORNO_EMPLOYEE_CODE is null) and'
      '          (om2.TO_DEPT_CODE is null) and'
      '          (not'
      
        '            ( (om2.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_' +
        'OBJECT_BRANCH_CODE) and'
      
        '              (om2.FROM_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_' +
        'CODE)'
      '            )'
      '          )'
      '      )'
      '    end'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      '*/'
      ''
      '  ModelUtils.GetMlmsoRcvdForDetailTechQty('
      '    mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '    mlmso2.MLMSO_OBJECT_CODE,'
      '    ( select'
      '        iv.FEATURE_FLAG_OPERATION_LOADING'
      '      from'
      '        INTERNAL_VALUES iv'
      '      where'
      '        (iv.CODE = 1)'
      '    )'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      ''
      
        '  MiscUtils.LargeZero( -- izliazlo ot nashata operacia za drugi ' +
        'operacii ili brak'
      '    ( select'
      '        Coalesce(Sum(om2.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        OPERATION_MOVEMENTS om2'
      '      where'
      
        '        (om2.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_OBJECT' +
        '_BRANCH_CODE) and'
      
        '        (om2.FROM_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_CODE) ' +
        'and'
      '        (om2.STORNO_EMPLOYEE_CODE is null) and'
      ''
      '        ( (om2.TO_DEPT_CODE is not null) or'
      '          (not'
      
        '            ( (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_OB' +
        'JECT_BRANCH_CODE) and'
      
        '              (om2.TO_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_CO' +
        'DE)'
      '            )'
      '          )'
      '        )'
      '    )'
      '  ) as OUT_DETAIL_TECH_QUANTITY,'
      ''
      '  Decode(mlmso2.OPERATION_TYPE_CODE,'
      
        '    2, CapacityUtils.HasMlmsoPlanExcess(mlmso2.MLMSO_OBJECT_BRAN' +
        'CH_CODE, mlmso2.MLMSO_OBJECT_CODE),'
      '    0'
      '  ) as HAS_CAPACITY_DEFICIT,'
      ''
      '  mlmso2.IS_AUTO_MOVEMENT as MLMSO_IS_AUTO_MOVEMENT'
      ''
      'from'
      '  MLMS_OPERATIONS mlmso2,'
      '  ML_MODEL_STAGES mlms2,'
      '  MATERIAL_LIST_LINES mll2,'
      '  PRODUCTS dprod2,'
      '  PRODUCTS mprod2'
      ''
      'where'
      
        '  ( (mlmso2.MLMS_OBJECT_BRANCH_CODE, mlmso2.MLMS_OBJECT_CODE, ml' +
        'mso2.MLMS_OPERATION_NO) ='
      '    ( select'
      
        '        mlmso.MLMS_OBJECT_BRANCH_CODE, mlmso.MLMS_OBJECT_CODE, (' +
        'mlmso.MLMS_OPERATION_NO - 1)'
      '      from'
      '        MLMS_OPERATIONS mlmso'
      '      where'
      
        '        (mlmso.MLMSO_OBJECT_BRANCH_CODE = :MLMSO_OBJECT_BRANCH_C' +
        'ODE) and'
      '        (mlmso.MLMSO_OBJECT_CODE = :MLMSO_OBJECT_CODE)'
      '    )'
      '  ) and'
      ''
      
        '  (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_OBJECT_BRANCH_COD' +
        'E) and'
      '  (mlmso2.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_CODE) and'
      ''
      
        '  (mlms2.MLL_OBJECT_BRANCH_CODE = mll2.MLL_OBJECT_BRANCH_CODE) a' +
        'nd'
      '  (mlms2.MLL_OBJECT_CODE = mll2.MLL_OBJECT_CODE) and'
      ''
      '  (mll2.DETAIL_CODE = dprod2.PRODUCT_CODE) and'
      ''
      '  (mll2.PRODUCT_CODE = mprod2.PRODUCT_CODE(+)) and'
      ''
      '  (mll2.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '  (mlmso2.IS_ACTIVE = 1) and'
      '  (mlmso2.MLMS_OPERATION_VARIANT_NO >= 0)'
      ''
      'order by'
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      '  mlms2.ML_MODEL_STAGE_NO,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DATE]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[dprod2]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 
          'PRODUCT_COMPANY_PRODUCT_NAMES[mll2.DETAIL_CODE~s2.CLIENT_COMPANY' +
          '_CODE]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[mlmso2]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'MLL_COMPLECTATION_PERCENT[mll2]'
        ParamType = ptInput
        Value = '0=0'
      end>
    DefaultOrder.Fields = 
      'NO_AS_FORMATED_TEXT;FORK_NO;ML_MODEL_STAGE_NO;MLMS_OPERATION_NO;' +
      'MLMS_OPERATION_VARIANT_NO'
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftFloat
        Name = 'IS_FIRST_OPERATION_IN_STAGE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_FIRST_STAGE_IN_MLL'
        ParamType = ptInput
      end>
    Left = 264
    Top = 168
    object qryOperationInputWhenNotFirstMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationInputWhenNotFirstMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationInputWhenNotFirstMLMS_OPERATION_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_NO'
    end
    object qryOperationInputWhenNotFirstMLMS_OPERATION_VARIANT_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_VARIANT_NO'
    end
    object qryOperationInputWhenNotFirstOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryOperationInputWhenNotFirstOPERATION_TYPE_ABBREV: TAbmesWideStringField
      FieldName = 'OPERATION_TYPE_ABBREV'
      Size = 100
    end
    object qryOperationInputWhenNotFirstSHOW_NO: TAbmesWideStringField
      FieldName = 'SHOW_NO'
      Size = 122
    end
    object qryOperationInputWhenNotFirstTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryOperationInputWhenNotFirstTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryOperationInputWhenNotFirstTREATMENT_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_DATE'
    end
    object qryOperationInputWhenNotFirstRESERVE_DAYS: TAbmesFloatField
      FieldName = 'RESERVE_DAYS'
    end
    object qryOperationInputWhenNotFirstDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryOperationInputWhenNotFirstML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryOperationInputWhenNotFirstSTAGE_DEPT_NAME: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_NAME'
      Size = 100
    end
    object qryOperationInputWhenNotFirstSTAGE_DEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_IDENTIFIER'
      Size = 46
    end
    object qryOperationInputWhenNotFirstNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryOperationInputWhenNotFirstFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryOperationInputWhenNotFirstDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryOperationInputWhenNotFirstDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryOperationInputWhenNotFirstDETAIL_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_BRANCH_CODE'
    end
    object qryOperationInputWhenNotFirstDETAIL_DOC_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_CODE'
    end
    object qryOperationInputWhenNotFirstDETAIL_HAS_DOC: TAbmesFloatField
      FieldName = 'DETAIL_HAS_DOC'
    end
    object qryOperationInputWhenNotFirstDETAIL_TECH_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'DETAIL_TECH_MEASURE_ABBREV'
      Size = 5
    end
    object qryOperationInputWhenNotFirstCLIENT_DETAIL_NAME: TAbmesWideStringField
      FieldName = 'CLIENT_DETAIL_NAME'
      Size = 250
    end
    object qryOperationInputWhenNotFirstDOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DOC_BRANCH_CODE'
    end
    object qryOperationInputWhenNotFirstDOC_CODE: TAbmesFloatField
      FieldName = 'DOC_CODE'
    end
    object qryOperationInputWhenNotFirstHAS_DOCUMENTATION: TAbmesFloatField
      FieldName = 'HAS_DOCUMENTATION'
    end
    object qryOperationInputWhenNotFirstSETUP_PROFESSION_CODE: TAbmesFloatField
      FieldName = 'SETUP_PROFESSION_CODE'
    end
    object qryOperationInputWhenNotFirstIS_SETUP_DONE: TAbmesFloatField
      FieldName = 'IS_SETUP_DONE'
    end
    object qryOperationInputWhenNotFirstHOUR_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'HOUR_TECH_QUANTITY'
    end
    object qryOperationInputWhenNotFirstDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
    object qryOperationInputWhenNotFirstHAS_CAPACITY_DEFICIT: TAbmesFloatField
      FieldName = 'HAS_CAPACITY_DEFICIT'
    end
    object qryOperationInputWhenNotFirstML_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_BRANCH_CODE'
    end
    object qryOperationInputWhenNotFirstML_OBJECT_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_CODE'
    end
    object qryOperationInputWhenNotFirstMLL_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_BRANCH_CODE'
    end
    object qryOperationInputWhenNotFirstMLL_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_CODE'
    end
    object qryOperationInputWhenNotFirstMLMSO_IS_AUTO_MOVEMENT: TAbmesFloatField
      FieldName = 'MLMSO_IS_AUTO_MOVEMENT'
    end
    object qryOperationInputWhenNotFirstVARIANT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'VARIANT_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenNotFirstSTORE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'STORE_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenNotFirstWASTED_BEFORE_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'WASTED_BEFORE_TECH_QUANTITY'
    end
    object qryOperationInputWhenNotFirstIN_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'IN_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenNotFirstOUT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OUT_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenNotFirstTO_LEAVE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_LEAVE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryOperationInputWhenNotFirstAVAILABLE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'AVAILABLE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
  end
  object qryOperationInputWhenFirstInStage: TAbmesSQLQuery
    OnCalcFields = qryOperationInputWhenFirstInStageCalcFields
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO,'
      '  mlmso2.OPERATION_TYPE_CODE,'
      ''
      '  mll2.ML_OBJECT_BRANCH_CODE,'
      '  mll2.ML_OBJECT_CODE,'
      '  mll2.MLL_OBJECT_BRANCH_CODE,'
      '  mll2.MLL_OBJECT_CODE,'
      ''
      '  ( select'
      '      ot.OPERATION_TYPE_ABBREV'
      '    from'
      '      OPERATION_TYPES ot'
      '    where'
      '      (ot.OPERATION_TYPE_CODE = mlmso2.OPERATION_TYPE_CODE)'
      '  ) as OPERATION_TYPE_ABBREV,'
      '  '
      
        '  (mlms2.ML_MODEL_STAGE_NO || '#39'-'#39' || mlmso2.MLMS_OPERATION_NO ||' +
        ' '#39'.'#39' || mlmso2.MLMS_OPERATION_VARIANT_NO) as SHOW_NO,'
      ''
      '  mlmso2.TREATMENT_BEGIN_DATE,'
      '  mlmso2.TREATMENT_END_DATE,'
      '  mlmso2.TREATMENT_BEGIN_DATE as TREATMENT_DATE,'
      
        '  NullIf(%COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DAT' +
        'E], 0) as RESERVE_DAYS,'
      '  '
      '  mlmso2.DEPT_CODE,'
      '  ( select'
      '      d2.NAME'
      '    from'
      '      DEPTS d2'
      '    where'
      '      (d2.DEPT_CODE = mlmso2.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      '  '
      '  mlms2.ML_MODEL_STAGE_NO,'
      '  '
      '  ( select'
      '      d3.NAME'
      '    from'
      '      DEPTS d3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE)'
      '  ) as STAGE_DEPT_NAME,'
      '  '
      '  ( select'
      
        '      (dt3.DEPT_TYPE_ABBREV || d3.CUSTOM_CODE || d3.SUFFIX_LETTE' +
        'R)'
      '    from'
      '      DEPTS d3,'
      '      DEPT_TYPES dt3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE) and'
      '      (d3.DEPT_TYPE_CODE = dt3.DEPT_TYPE_CODE(+))'
      '  ) as STAGE_DEPT_IDENTIFIER,'
      ''
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      ''
      '  mll2.DETAIL_CODE,'
      '  '
      '  dprod2.NAME as DETAIL_NAME,'
      '  '
      '  dprod2.DOC_BRANCH_CODE as DETAIL_DOC_BRANCH_CODE,'
      '  dprod2.DOC_CODE as DETAIL_DOC_CODE,'
      '  %HAS_DOC_ITEMS[dprod2] as DETAIL_HAS_DOC,'
      ''
      '  ( select'
      '      m.MEASURE_ABBREV'
      '    from'
      '      MEASURES m'
      '    where'
      '      (dprod2.TECH_MEASURE_CODE = m.MEASURE_CODE)'
      '  ) as DETAIL_TECH_MEASURE_ABBREV,'
      ''
      '  ( select'
      
        '      %PRODUCT_COMPANY_PRODUCT_NAMES[mll2.DETAIL_CODE~s2.CLIENT_' +
        'COMPANY_CODE]'
      '    from'
      '      SALES s2'
      '    where'
      '      ( (s2.SALE_OBJECT_BRANCH_CODE, s2.SALE_OBJECT_CODE) ='
      '        ( select'
      
        '            ml2.BND_PROCESS_OBJECT_BRANCH_CODE, ml2.BND_PROCESS_' +
        'OBJECT_CODE'
      '          from'
      '            MATERIAL_LISTS ml2'
      '          where'
      
        '            (ml2.ML_OBJECT_BRANCH_CODE = mll2.ML_OBJECT_BRANCH_C' +
        'ODE) and'
      '            (ml2.ML_OBJECT_CODE = mll2.ML_OBJECT_CODE)'
      '        )'
      '      )'
      '  ) as CLIENT_DETAIL_NAME,'
      '  '
      '  mlmso2.DOC_BRANCH_CODE,'
      '  mlmso2.DOC_CODE,'
      ''
      '  %HAS_DOC_ITEMS[mlmso2] as HAS_DOCUMENTATION,'
      ''
      '  mlmso2.SETUP_PROFESSION_CODE,'
      '  Nvl2(mlmso2.SETUP_DATE, 1, 0) as IS_SETUP_DONE,'
      ''
      '  mlmso2.HOUR_TECH_QUANTITY,'
      ''
      '  mlmso2.VARIANT_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      '    Decode('
      '      mlms2.ML_MODEL_STAGE_NO,'
      '      0,'
      '      ( select'
      
        '          Coalesce((Sum(asd.REAL_QUANTITY) keep (dense_rank last' +
        ' order by asd.STORE_DEAL_DATE) * mprod2.TECH_MEASURE_COEF / mll2' +
        '.PRODUCT_TECH_QUANTITY), 0)'
      '        from'
      '          AGGR_STORE_DEALS asd'
      '        where'
      '          (asd.PRODUCT_CODE = mll2.PRODUCT_CODE) and'
      '          (asd.STORE_CODE = mlms2.DEPT_CODE) and'
      '          (asd.STORE_DEAL_DATE <= ContextDate)'
      '      ),'
      '      0'
      '    )'
      '  ) as STORE_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      
        '    Greatest( -- ostavasht za razpredeliane brak ot predhodni op' +
        'eracii sled kato e razpredelen po sledvashtite varianti na nasha' +
        'ta operacia'
      '      0,'
      '      ('
      '        ( -- brak po predhodinte operacii i etapi ot toia red'
      '          select'
      '            Coalesce(Sum(om3.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '          from'
      '            ML_MODEL_STAGES mlms3,'
      '            MLMS_OPERATIONS mlmso3,'
      '            OPERATION_MOVEMENTS om3'
      '          where'
      
        '            (mlms3.MLL_OBJECT_BRANCH_CODE = mll2.MLL_OBJECT_BRAN' +
        'CH_CODE) and'
      '            (mlms3.MLL_OBJECT_CODE = mll2.MLL_OBJECT_CODE) and'
      ''
      
        '            (mlms3.MLMS_OBJECT_BRANCH_CODE = mlmso3.MLMS_OBJECT_' +
        'BRANCH_CODE) and'
      
        '            (mlms3.MLMS_OBJECT_CODE = mlmso3.MLMS_OBJECT_CODE) a' +
        'nd'
      ''
      
        '            (om3.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso3.MLMSO_OB' +
        'JECT_BRANCH_CODE) and'
      
        '            (om3.FROM_MLMSO_OBJECT_CODE = mlmso3.MLMSO_OBJECT_CO' +
        'DE) and'
      ''
      '            (om3.STORNO_EMPLOYEE_CODE is null) and'
      '            (om3.TO_DEPT_CODE is not null) and'
      ''
      
        '            ( (mlms3.ML_MODEL_STAGE_NO < mlms2.ML_MODEL_STAGE_NO' +
        ') or'
      
        '              ( (mlms3.ML_MODEL_STAGE_NO = mlms2.ML_MODEL_STAGE_' +
        'NO) and'
      
        '                (mlmso3.MLMS_OPERATION_NO < mlmso2.MLMS_OPERATIO' +
        'N_NO)'
      '              )'
      '            )'
      '        )'
      '        -'
      
        '        ( -- ostavashto za vlizane po sledvashtite variatni na n' +
        'ashata operacia'
      '          select'
      '            Coalesce('
      '              Sum('
      '                mlmso3.VARIANT_DETAIL_TECH_QUANTITY'
      '                -'
      
        '                ( -- vliazlo v operaciata mlmso2 ot drugi operac' +
        'ii'
      '                  select'
      
        '                    Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY),' +
        ' 0)'
      '                  from'
      '                    OPERATION_MOVEMENTS om'
      '                  where'
      
        '                    (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso3.MLM' +
        'SO_OBJECT_BRANCH_CODE) and'
      
        '                    (om.TO_MLMSO_OBJECT_CODE = mlmso3.MLMSO_OBJE' +
        'CT_CODE) and'
      '                    (om.STORNO_EMPLOYEE_CODE is null) and'
      '                    (om.TO_DEPT_CODE is null) and'
      '                    (not'
      
        '                      ( (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlms' +
        'o3.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                        (om.FROM_MLMSO_OBJECT_CODE = mlmso3.MLMS' +
        'O_OBJECT_CODE)'
      '                      )'
      '                    )'
      '                )'
      '              ),'
      '              0'
      '            )'
      '          from'
      '            MLMS_OPERATIONS mlmso3'
      '          where'
      
        '            (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT' +
        '_BRANCH_CODE) and'
      
        '            (mlmso3.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) ' +
        'and'
      
        '            (mlmso3.MLMS_OPERATION_NO = mlmso2.MLMS_OPERATION_NO' +
        ') and'
      
        '            (mlmso3.MLMS_OPERATION_VARIANT_NO > mlmso2.MLMS_OPER' +
        'ATION_VARIANT_NO)'
      '        )'
      '      )'
      '    )'
      '  ) as WASTED_BEFORE_TECH_QUANTITY,'
      ''
      '/*'
      
        '  MiscUtils.LargeZero( -- vliazlo v nashata operacia ot drugi op' +
        'eracii'
      '    case'
      '      when (mll2.PRODUCT_CODE is null) and'
      '           (mlms2.ML_MODEL_STAGE_NO = 1) and'
      '           (mlmso2.MLMS_OPERATION_NO ='
      '              ( select'
      '                  Min(mlmso3.MLMS_OPERATION_NO)'
      '                from'
      '                  MLMS_OPERATIONS mlmso3'
      '                where'
      
        '                  (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_O' +
        'BJECT_BRANCH_CODE) and'
      
        '                  (mlmso3.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_C' +
        'ODE)'
      '              )'
      '           ) then'
      
        '        Coalesce((%MLL_COMPLECTATION_PERCENT[mll2] * mlmso2.VARI' +
        'ANT_DETAIL_TECH_QUANTITY), 0)'
      '    else'
      '      ( select'
      '          Coalesce(Sum(om2.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '        from'
      '          OPERATION_MOVEMENTS om2'
      '        where'
      
        '          (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_OBJECT' +
        '_BRANCH_CODE) and'
      
        '          (om2.TO_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_CODE) ' +
        'and'
      '          (om2.STORNO_EMPLOYEE_CODE is null) and'
      '          (om2.TO_DEPT_CODE is null) and'
      '          (not'
      
        '            ( (om2.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_' +
        'OBJECT_BRANCH_CODE) and'
      
        '              (om2.FROM_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_' +
        'CODE)'
      '            )'
      '          )'
      '      )'
      '    end'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      '*/'
      ''
      '  ModelUtils.GetMlmsoRcvdForDetailTechQty('
      '    mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '    mlmso2.MLMSO_OBJECT_CODE,'
      '    ( select'
      '        iv.FEATURE_FLAG_OPERATION_LOADING'
      '      from'
      '        INTERNAL_VALUES iv'
      '      where'
      '        (iv.CODE = 1)'
      '    )'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      ''
      
        '  MiscUtils.LargeZero( -- izliazlo ot nashata operacia za drugi ' +
        'operacii ili brak'
      '    ( select'
      '        Coalesce(Sum(om2.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        OPERATION_MOVEMENTS om2'
      '      where'
      
        '        (om2.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_OBJECT' +
        '_BRANCH_CODE) and'
      
        '        (om2.FROM_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_CODE) ' +
        'and'
      '        (om2.STORNO_EMPLOYEE_CODE is null) and'
      ''
      '        ( (om2.TO_DEPT_CODE is not null) or'
      '          (not'
      
        '            ( (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_OB' +
        'JECT_BRANCH_CODE) and'
      
        '              (om2.TO_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_CO' +
        'DE)'
      '            )'
      '          )'
      '        )'
      '    )'
      '  ) as OUT_DETAIL_TECH_QUANTITY,'
      ''
      '  Decode(mlmso2.OPERATION_TYPE_CODE,'
      
        '    2, CapacityUtils.HasMlmsoPlanExcess(mlmso2.MLMSO_OBJECT_BRAN' +
        'CH_CODE, mlmso2.MLMSO_OBJECT_CODE),'
      '    0'
      '  ) as HAS_CAPACITY_DEFICIT,'
      ''
      '  mlmso2.IS_AUTO_MOVEMENT as MLMSO_IS_AUTO_MOVEMENT'
      ''
      'from'
      '  MLMS_OPERATIONS mlmso2,'
      '  ML_MODEL_STAGES mlms2,'
      '  MATERIAL_LIST_LINES mll2,'
      '  PRODUCTS dprod2,'
      '  PRODUCTS mprod2'
      ''
      'where'
      
        '  ( (mlms2.MLL_OBJECT_BRANCH_CODE, mlms2.MLL_OBJECT_CODE, mlms2.' +
        'ML_MODEL_STAGE_NO) ='
      '    ( select'
      
        '        mlms.MLL_OBJECT_BRANCH_CODE, mlms.MLL_OBJECT_CODE, (mlms' +
        '.ML_MODEL_STAGE_NO - 1)'
      '      from'
      '        ML_MODEL_STAGES mlms'
      '      where'
      
        '        ( (mlms.MLMS_OBJECT_BRANCH_CODE, mlms.MLMS_OBJECT_CODE) ' +
        '='
      '          ( select'
      
        '              mlmso.MLMS_OBJECT_BRANCH_CODE, mlmso.MLMS_OBJECT_C' +
        'ODE'
      '            from'
      '              MLMS_OPERATIONS mlmso'
      '            where'
      
        '              (mlmso.MLMSO_OBJECT_BRANCH_CODE = :MLMSO_OBJECT_BR' +
        'ANCH_CODE) and'
      '              (mlmso.MLMSO_OBJECT_CODE = :MLMSO_OBJECT_CODE)'
      '          )'
      '        )'
      '    )'
      '  ) and'
      ''
      '  (not exists'
      '    ( select'
      '        1'
      '      from'
      '        MLMS_OPERATIONS mlmso3'
      '      where'
      
        '        (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRA' +
        'NCH_CODE) and'
      '        (mlmso3.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      '        (mlmso3.MLMS_OPERATION_NO > mlmso2.MLMS_OPERATION_NO)'
      '    )'
      '  ) and'
      ''
      
        '  (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRANCH_COD' +
        'E) and'
      '  (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      ''
      
        '  (mlms2.MLL_OBJECT_BRANCH_CODE = mll2.MLL_OBJECT_BRANCH_CODE) a' +
        'nd'
      '  (mlms2.MLL_OBJECT_CODE = mll2.MLL_OBJECT_CODE) and'
      ''
      '  (mll2.DETAIL_CODE = dprod2.PRODUCT_CODE) and'
      ''
      '  (mll2.PRODUCT_CODE = mprod2.PRODUCT_CODE(+)) and'
      ''
      '  (mll2.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '  (mlmso2.IS_ACTIVE = 1) and'
      '  (mlmso2.MLMS_OPERATION_VARIANT_NO >= 0)'
      ''
      'order by'
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      '  mlms2.ML_MODEL_STAGE_NO,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DATE]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[dprod2]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 
          'PRODUCT_COMPANY_PRODUCT_NAMES[mll2.DETAIL_CODE~s2.CLIENT_COMPANY' +
          '_CODE]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[mlmso2]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'MLL_COMPLECTATION_PERCENT[mll2]'
        ParamType = ptInput
        Value = '0=0'
      end>
    DefaultOrder.Fields = 
      'NO_AS_FORMATED_TEXT;FORK_NO;ML_MODEL_STAGE_NO;MLMS_OPERATION_NO;' +
      'MLMS_OPERATION_VARIANT_NO'
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftFloat
        Name = 'IS_FIRST_OPERATION_IN_STAGE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_FIRST_STAGE_IN_MLL'
        ParamType = ptInput
      end>
    Left = 264
    Top = 216
    object qryOperationInputWhenFirstInStageMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationInputWhenFirstInStageMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationInputWhenFirstInStageMLMS_OPERATION_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_NO'
    end
    object qryOperationInputWhenFirstInStageMLMS_OPERATION_VARIANT_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_VARIANT_NO'
    end
    object qryOperationInputWhenFirstInStageOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryOperationInputWhenFirstInStageOPERATION_TYPE_ABBREV: TAbmesWideStringField
      FieldName = 'OPERATION_TYPE_ABBREV'
      Size = 100
    end
    object qryOperationInputWhenFirstInStageSHOW_NO: TAbmesWideStringField
      FieldName = 'SHOW_NO'
      Size = 122
    end
    object qryOperationInputWhenFirstInStageTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryOperationInputWhenFirstInStageTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryOperationInputWhenFirstInStageTREATMENT_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_DATE'
    end
    object qryOperationInputWhenFirstInStageRESERVE_DAYS: TAbmesFloatField
      FieldName = 'RESERVE_DAYS'
    end
    object qryOperationInputWhenFirstInStageDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryOperationInputWhenFirstInStageML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryOperationInputWhenFirstInStageSTAGE_DEPT_NAME: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_NAME'
      Size = 100
    end
    object qryOperationInputWhenFirstInStageSTAGE_DEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_IDENTIFIER'
      Size = 46
    end
    object qryOperationInputWhenFirstInStageNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryOperationInputWhenFirstInStageFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryOperationInputWhenFirstInStageDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryOperationInputWhenFirstInStageDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryOperationInputWhenFirstInStageDETAIL_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_BRANCH_CODE'
    end
    object qryOperationInputWhenFirstInStageDETAIL_DOC_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_CODE'
    end
    object qryOperationInputWhenFirstInStageDETAIL_HAS_DOC: TAbmesFloatField
      FieldName = 'DETAIL_HAS_DOC'
    end
    object qryOperationInputWhenFirstInStageDETAIL_TECH_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'DETAIL_TECH_MEASURE_ABBREV'
      Size = 5
    end
    object qryOperationInputWhenFirstInStageCLIENT_DETAIL_NAME: TAbmesWideStringField
      FieldName = 'CLIENT_DETAIL_NAME'
      Size = 250
    end
    object qryOperationInputWhenFirstInStageDOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DOC_BRANCH_CODE'
    end
    object qryOperationInputWhenFirstInStageDOC_CODE: TAbmesFloatField
      FieldName = 'DOC_CODE'
    end
    object qryOperationInputWhenFirstInStageHAS_DOCUMENTATION: TAbmesFloatField
      FieldName = 'HAS_DOCUMENTATION'
    end
    object qryOperationInputWhenFirstInStageSETUP_PROFESSION_CODE: TAbmesFloatField
      FieldName = 'SETUP_PROFESSION_CODE'
    end
    object qryOperationInputWhenFirstInStageIS_SETUP_DONE: TAbmesFloatField
      FieldName = 'IS_SETUP_DONE'
    end
    object qryOperationInputWhenFirstInStageHOUR_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'HOUR_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInStageDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
    object qryOperationInputWhenFirstInStageHAS_CAPACITY_DEFICIT: TAbmesFloatField
      FieldName = 'HAS_CAPACITY_DEFICIT'
    end
    object qryOperationInputWhenFirstInStageML_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_BRANCH_CODE'
    end
    object qryOperationInputWhenFirstInStageML_OBJECT_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_CODE'
    end
    object qryOperationInputWhenFirstInStageMLL_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_BRANCH_CODE'
    end
    object qryOperationInputWhenFirstInStageMLL_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_CODE'
    end
    object qryOperationInputWhenFirstInStageMLMSO_IS_AUTO_MOVEMENT: TAbmesFloatField
      FieldName = 'MLMSO_IS_AUTO_MOVEMENT'
    end
    object qryOperationInputWhenFirstInStageVARIANT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'VARIANT_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInStageSTORE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'STORE_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInStageWASTED_BEFORE_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'WASTED_BEFORE_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInStageIN_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'IN_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInStageOUT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OUT_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInStageTO_LEAVE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_LEAVE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryOperationInputWhenFirstInStageAVAILABLE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'AVAILABLE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
  end
  object qryOperationInputWhenFirstInMll: TAbmesSQLQuery
    OnCalcFields = qryOperationInputWhenFirstInMllCalcFields
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO,'
      '  mlmso2.OPERATION_TYPE_CODE,'
      ''
      '  mll2.ML_OBJECT_BRANCH_CODE,'
      '  mll2.ML_OBJECT_CODE,'
      '  mll2.MLL_OBJECT_BRANCH_CODE,'
      '  mll2.MLL_OBJECT_CODE,'
      ''
      '  ( select'
      '      ot.OPERATION_TYPE_ABBREV'
      '    from'
      '      OPERATION_TYPES ot'
      '    where'
      '      (ot.OPERATION_TYPE_CODE = mlmso2.OPERATION_TYPE_CODE)'
      '  ) as OPERATION_TYPE_ABBREV,'
      '  '
      
        '  (mlms2.ML_MODEL_STAGE_NO || '#39'-'#39' || mlmso2.MLMS_OPERATION_NO ||' +
        ' '#39'.'#39' || mlmso2.MLMS_OPERATION_VARIANT_NO) as SHOW_NO,'
      ''
      '  mlmso2.TREATMENT_BEGIN_DATE,'
      '  mlmso2.TREATMENT_END_DATE,'
      '  mlmso2.TREATMENT_BEGIN_DATE as TREATMENT_DATE,'
      
        '  NullIf(%COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DAT' +
        'E], 0) as RESERVE_DAYS,'
      '  '
      '  mlmso2.DEPT_CODE,'
      '  ( select'
      '      d2.NAME'
      '    from'
      '      DEPTS d2'
      '    where'
      '      (d2.DEPT_CODE = mlmso2.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      '  '
      '  mlms2.ML_MODEL_STAGE_NO,'
      '  '
      '  ( select'
      '      d3.NAME'
      '    from'
      '      DEPTS d3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE)'
      '  ) as STAGE_DEPT_NAME,'
      '  '
      '  ( select'
      
        '      (dt3.DEPT_TYPE_ABBREV || d3.CUSTOM_CODE || d3.SUFFIX_LETTE' +
        'R)'
      '    from'
      '      DEPTS d3,'
      '      DEPT_TYPES dt3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE) and'
      '      (d3.DEPT_TYPE_CODE = dt3.DEPT_TYPE_CODE(+))'
      '  ) as STAGE_DEPT_IDENTIFIER,'
      ''
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      ''
      '  mll2.DETAIL_CODE,'
      ''
      '  dprod2.NAME as DETAIL_NAME,'
      ''
      '  dprod2.DOC_BRANCH_CODE as DETAIL_DOC_BRANCH_CODE,'
      '  dprod2.DOC_CODE as DETAIL_DOC_CODE,'
      '  %HAS_DOC_ITEMS[dprod2] as DETAIL_HAS_DOC,'
      ''
      '  ( select'
      '      m.MEASURE_ABBREV'
      '    from'
      '      MEASURES m'
      '    where'
      '      (dprod2.TECH_MEASURE_CODE = m.MEASURE_CODE)'
      '  ) as DETAIL_TECH_MEASURE_ABBREV,'
      ''
      '  ( select'
      
        '      %PRODUCT_COMPANY_PRODUCT_NAMES[mll2.DETAIL_CODE~s2.CLIENT_' +
        'COMPANY_CODE]'
      '    from'
      '      SALES s2'
      '    where'
      '      ( (s2.SALE_OBJECT_BRANCH_CODE, s2.SALE_OBJECT_CODE) ='
      '        ( select'
      
        '            ml2.BND_PROCESS_OBJECT_BRANCH_CODE, ml2.BND_PROCESS_' +
        'OBJECT_CODE'
      '          from'
      '            MATERIAL_LISTS ml2'
      '          where'
      
        '            (ml2.ML_OBJECT_BRANCH_CODE = mll2.ML_OBJECT_BRANCH_C' +
        'ODE) and'
      '            (ml2.ML_OBJECT_CODE = mll2.ML_OBJECT_CODE)'
      '        )'
      '      )'
      '  ) as CLIENT_DETAIL_NAME,'
      '  '
      '  mlmso2.DOC_BRANCH_CODE,'
      '  mlmso2.DOC_CODE,'
      ''
      '  %HAS_DOC_ITEMS[mlmso2] as HAS_DOCUMENTATION,'
      '  '
      '  mlmso2.SETUP_PROFESSION_CODE,'
      '  Nvl2(mlmso2.SETUP_DATE, 1, 0) as IS_SETUP_DONE,'
      ''
      '  mlmso2.HOUR_TECH_QUANTITY,'
      ''
      '  mlmso2.VARIANT_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      '    Decode('
      '      mlms2.ML_MODEL_STAGE_NO,'
      '      0,'
      '      ( select'
      
        '          Coalesce((Sum(asd.REAL_QUANTITY) keep (dense_rank last' +
        ' order by asd.STORE_DEAL_DATE) * mprod2.TECH_MEASURE_COEF / mll2' +
        '.PRODUCT_TECH_QUANTITY), 0)'
      '        from'
      '          AGGR_STORE_DEALS asd'
      '        where'
      '          (asd.PRODUCT_CODE = mll2.PRODUCT_CODE) and'
      '          (asd.STORE_CODE = mlms2.DEPT_CODE) and'
      '          (asd.STORE_DEAL_DATE <= ContextDate)'
      '      ),'
      '      0'
      '    )'
      '  ) as STORE_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      
        '    Greatest( -- ostavasht za razpredeliane brak ot predhodni op' +
        'eracii sled kato e razpredelen po sledvashtite varianti na nasha' +
        'ta operacia'
      '      0,'
      '      ('
      '        ( -- brak po predhodinte operacii i etapi ot toia red'
      '          select'
      '            Coalesce(Sum(om3.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '          from'
      '            ML_MODEL_STAGES mlms3,'
      '            MLMS_OPERATIONS mlmso3,'
      '            OPERATION_MOVEMENTS om3'
      '          where'
      
        '            (mlms3.MLL_OBJECT_BRANCH_CODE = mll2.MLL_OBJECT_BRAN' +
        'CH_CODE) and'
      '            (mlms3.MLL_OBJECT_CODE = mll2.MLL_OBJECT_CODE) and'
      ''
      
        '            (mlms3.MLMS_OBJECT_BRANCH_CODE = mlmso3.MLMS_OBJECT_' +
        'BRANCH_CODE) and'
      
        '            (mlms3.MLMS_OBJECT_CODE = mlmso3.MLMS_OBJECT_CODE) a' +
        'nd'
      ''
      
        '            (om3.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso3.MLMSO_OB' +
        'JECT_BRANCH_CODE) and'
      
        '            (om3.FROM_MLMSO_OBJECT_CODE = mlmso3.MLMSO_OBJECT_CO' +
        'DE) and'
      ''
      '            (om3.STORNO_EMPLOYEE_CODE is null) and'
      '            (om3.TO_DEPT_CODE is not null) and'
      ''
      
        '            ( (mlms3.ML_MODEL_STAGE_NO < mlms2.ML_MODEL_STAGE_NO' +
        ') or'
      
        '              ( (mlms3.ML_MODEL_STAGE_NO = mlms2.ML_MODEL_STAGE_' +
        'NO) and'
      
        '                (mlmso3.MLMS_OPERATION_NO < mlmso2.MLMS_OPERATIO' +
        'N_NO)'
      '              )'
      '            )'
      '        )'
      '        -'
      
        '        ( -- ostavashto za vlizane po sledvashtite variatni na n' +
        'ashata operacia'
      '          select'
      '            Coalesce('
      '              Sum('
      '                mlmso3.VARIANT_DETAIL_TECH_QUANTITY'
      '                -'
      
        '                ( -- vliazlo v operaciata mlmso2 ot drugi operac' +
        'ii'
      '                  select'
      
        '                    Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTITY),' +
        ' 0)'
      '                  from'
      '                    OPERATION_MOVEMENTS om'
      '                  where'
      
        '                    (om.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso3.MLM' +
        'SO_OBJECT_BRANCH_CODE) and'
      
        '                    (om.TO_MLMSO_OBJECT_CODE = mlmso3.MLMSO_OBJE' +
        'CT_CODE) and'
      '                    (om.STORNO_EMPLOYEE_CODE is null) and'
      '                    (om.TO_DEPT_CODE is null) and'
      '                    (not'
      
        '                      ( (om.FROM_MLMSO_OBJECT_BRANCH_CODE = mlms' +
        'o3.MLMSO_OBJECT_BRANCH_CODE) and'
      
        '                        (om.FROM_MLMSO_OBJECT_CODE = mlmso3.MLMS' +
        'O_OBJECT_CODE)'
      '                      )'
      '                    )'
      '                )'
      '              ),'
      '              0'
      '            )'
      '          from'
      '            MLMS_OPERATIONS mlmso3'
      '          where'
      
        '            (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT' +
        '_BRANCH_CODE) and'
      
        '            (mlmso3.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) ' +
        'and'
      
        '            (mlmso3.MLMS_OPERATION_NO = mlmso2.MLMS_OPERATION_NO' +
        ') and'
      
        '            (mlmso3.MLMS_OPERATION_VARIANT_NO > mlmso2.MLMS_OPER' +
        'ATION_VARIANT_NO)'
      '        )'
      '      )'
      '    )'
      '  ) as WASTED_BEFORE_TECH_QUANTITY,'
      ''
      '/*'
      
        '  MiscUtils.LargeZero( -- vliazlo v nashata operacia ot drugi op' +
        'eracii'
      '    case'
      '      when (mll2.PRODUCT_CODE is null) and'
      '           (mlms2.ML_MODEL_STAGE_NO = 1) and'
      '           (mlmso2.MLMS_OPERATION_NO ='
      '              ( select'
      '                  Min(mlmso3.MLMS_OPERATION_NO)'
      '                from'
      '                  MLMS_OPERATIONS mlmso3'
      '                where'
      
        '                  (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_O' +
        'BJECT_BRANCH_CODE) and'
      
        '                  (mlmso3.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_C' +
        'ODE)'
      '              )'
      '           ) then'
      
        '        Coalesce((%MLL_COMPLECTATION_PERCENT[mll2] * mlmso2.VARI' +
        'ANT_DETAIL_TECH_QUANTITY), 0)'
      '    else'
      '      ( select'
      '          Coalesce(Sum(om2.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '        from'
      '          OPERATION_MOVEMENTS om2'
      '        where'
      
        '          (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_OBJECT' +
        '_BRANCH_CODE) and'
      
        '          (om2.TO_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_CODE) ' +
        'and'
      '          (om2.STORNO_EMPLOYEE_CODE is null) and'
      '          (om2.TO_DEPT_CODE is null) and'
      '          (not'
      
        '            ( (om2.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_' +
        'OBJECT_BRANCH_CODE) and'
      
        '              (om2.FROM_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_' +
        'CODE)'
      '            )'
      '          )'
      '      )'
      '    end'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      '*/'
      ''
      '  ModelUtils.GetMlmsoRcvdForDetailTechQty('
      '    mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '    mlmso2.MLMSO_OBJECT_CODE,'
      '    ( select'
      '        iv.FEATURE_FLAG_OPERATION_LOADING'
      '      from'
      '        INTERNAL_VALUES iv'
      '      where'
      '        (iv.CODE = 1)'
      '    )'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      ''
      
        '  MiscUtils.LargeZero( -- izliazlo ot nashata operacia za drugi ' +
        'operacii ili brak'
      '    ( select'
      '        Coalesce(Sum(om2.TOTAL_DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        OPERATION_MOVEMENTS om2'
      '      where'
      
        '        (om2.FROM_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_OBJECT' +
        '_BRANCH_CODE) and'
      
        '        (om2.FROM_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_CODE) ' +
        'and'
      '        (om2.STORNO_EMPLOYEE_CODE is null) and'
      ''
      '        ( (om2.TO_DEPT_CODE is not null) or'
      '          (not'
      
        '            ( (om2.TO_MLMSO_OBJECT_BRANCH_CODE = mlmso2.MLMSO_OB' +
        'JECT_BRANCH_CODE) and'
      
        '              (om2.TO_MLMSO_OBJECT_CODE = mlmso2.MLMSO_OBJECT_CO' +
        'DE)'
      '            )'
      '          )'
      '        )'
      '    )'
      '  ) as OUT_DETAIL_TECH_QUANTITY,'
      ''
      '  Decode(mlmso2.OPERATION_TYPE_CODE,'
      
        '    2, CapacityUtils.HasMlmsoPlanExcess(mlmso2.MLMSO_OBJECT_BRAN' +
        'CH_CODE, mlmso2.MLMSO_OBJECT_CODE),'
      '    0'
      '  ) as HAS_CAPACITY_DEFICIT,'
      ''
      '  mlmso2.IS_AUTO_MOVEMENT as MLMSO_IS_AUTO_MOVEMENT'
      ''
      'from'
      '  MLMS_OPERATIONS mlmso2,'
      '  ML_MODEL_STAGES mlms2,'
      '  MATERIAL_LIST_LINES mll2,'
      '  PRODUCTS dprod2,'
      '  PRODUCTS mprod2'
      ''
      'where'
      
        '  ( (mll2.PARENT_MLL_OBJECT_BRANCH_CODE, mll2.PARENT_MLL_OBJECT_' +
        'CODE) ='
      '    ( select'
      '        mlms.MLL_OBJECT_BRANCH_CODE, mlms.MLL_OBJECT_CODE'
      '      from'
      '        ML_MODEL_STAGES mlms'
      '      where'
      
        '        ( (mlms.MLMS_OBJECT_BRANCH_CODE, mlms.MLMS_OBJECT_CODE) ' +
        '='
      '          ( select'
      
        '              mlmso.MLMS_OBJECT_BRANCH_CODE, mlmso.MLMS_OBJECT_C' +
        'ODE'
      '            from'
      '              MLMS_OPERATIONS mlmso'
      '            where'
      
        '              (mlmso.MLMSO_OBJECT_BRANCH_CODE = :MLMSO_OBJECT_BR' +
        'ANCH_CODE) and'
      '              (mlmso.MLMSO_OBJECT_CODE = :MLMSO_OBJECT_CODE)'
      '          )'
      '        )'
      '    )'
      '  ) and'
      ''
      '  (mlms2.OUTGOING_WORKDAYS > 0) and'
      '  (not exists'
      '    ( select'
      '        1'
      '      from'
      '        ML_MODEL_STAGES mlms3'
      '      where'
      
        '        (mlms3.MLL_OBJECT_BRANCH_CODE = mlms2.MLL_OBJECT_BRANCH_' +
        'CODE) and'
      '        (mlms3.MLL_OBJECT_CODE = mlms2.MLL_OBJECT_CODE) and'
      '        (mlms3.ML_MODEL_STAGE_NO > mlms2.ML_MODEL_STAGE_NO) and'
      '        (mlms3.OUTGOING_WORKDAYS > 0)'
      '    )'
      '  ) and'
      ''
      '  (not exists'
      '    ( select'
      '        1'
      '      from'
      '        MLMS_OPERATIONS mlmso3'
      '      where'
      
        '        (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRA' +
        'NCH_CODE) and'
      '        (mlmso3.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      '        (mlmso3.MLMS_OPERATION_NO > mlmso2.MLMS_OPERATION_NO)'
      '    )'
      '  ) and'
      ''
      
        '  (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRANCH_COD' +
        'E) and'
      '  (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      ''
      
        '  (mll2.MLL_OBJECT_BRANCH_CODE = mlms2.MLL_OBJECT_BRANCH_CODE) a' +
        'nd'
      '  (mll2.MLL_OBJECT_CODE = mlms2.MLL_OBJECT_CODE) and'
      ''
      '  (mll2.DETAIL_CODE = dprod2.PRODUCT_CODE) and'
      ''
      '  (mll2.PRODUCT_CODE = mprod2.PRODUCT_CODE(+)) and'
      ''
      '  (mll2.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      '  (mlmso2.IS_ACTIVE = 1) and'
      '  (mlmso2.MLMS_OPERATION_VARIANT_NO >= 0)'
      ''
      'order by'
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      '  mlms2.ML_MODEL_STAGE_NO,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DATE]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[dprod2]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 
          'PRODUCT_COMPANY_PRODUCT_NAMES[mll2.DETAIL_CODE~s2.CLIENT_COMPANY' +
          '_CODE]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[mlmso2]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'MLL_COMPLECTATION_PERCENT[mll2]'
        ParamType = ptInput
        Value = '0=0'
      end>
    DefaultOrder.Fields = 
      'NO_AS_FORMATED_TEXT;FORK_NO;ML_MODEL_STAGE_NO;MLMS_OPERATION_NO;' +
      'MLMS_OPERATION_VARIANT_NO'
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftFloat
        Name = 'IS_FIRST_OPERATION_IN_STAGE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_FIRST_STAGE_IN_MLL'
        ParamType = ptInput
      end>
    Left = 264
    Top = 264
    object qryOperationInputWhenFirstInMllMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationInputWhenFirstInMllMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationInputWhenFirstInMllMLMS_OPERATION_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_NO'
    end
    object qryOperationInputWhenFirstInMllMLMS_OPERATION_VARIANT_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_VARIANT_NO'
    end
    object qryOperationInputWhenFirstInMllOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryOperationInputWhenFirstInMllOPERATION_TYPE_ABBREV: TAbmesWideStringField
      FieldName = 'OPERATION_TYPE_ABBREV'
      Size = 100
    end
    object qryOperationInputWhenFirstInMllSHOW_NO: TAbmesWideStringField
      FieldName = 'SHOW_NO'
      Size = 122
    end
    object qryOperationInputWhenFirstInMllTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryOperationInputWhenFirstInMllTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryOperationInputWhenFirstInMllTREATMENT_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_DATE'
    end
    object qryOperationInputWhenFirstInMllRESERVE_DAYS: TAbmesFloatField
      FieldName = 'RESERVE_DAYS'
    end
    object qryOperationInputWhenFirstInMllDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryOperationInputWhenFirstInMllML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryOperationInputWhenFirstInMllSTAGE_DEPT_NAME: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_NAME'
      Size = 100
    end
    object qryOperationInputWhenFirstInMllSTAGE_DEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_IDENTIFIER'
      Size = 46
    end
    object qryOperationInputWhenFirstInMllNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryOperationInputWhenFirstInMllFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryOperationInputWhenFirstInMllDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryOperationInputWhenFirstInMllDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryOperationInputWhenFirstInMllDETAIL_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_BRANCH_CODE'
    end
    object qryOperationInputWhenFirstInMllDETAIL_DOC_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_CODE'
    end
    object qryOperationInputWhenFirstInMllDETAIL_HAS_DOC: TAbmesFloatField
      FieldName = 'DETAIL_HAS_DOC'
    end
    object qryOperationInputWhenFirstInMllDETAIL_TECH_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'DETAIL_TECH_MEASURE_ABBREV'
      Size = 5
    end
    object qryOperationInputWhenFirstInMllCLIENT_DETAIL_NAME: TAbmesWideStringField
      FieldName = 'CLIENT_DETAIL_NAME'
      Size = 250
    end
    object qryOperationInputWhenFirstInMllDOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DOC_BRANCH_CODE'
    end
    object qryOperationInputWhenFirstInMllDOC_CODE: TAbmesFloatField
      FieldName = 'DOC_CODE'
    end
    object qryOperationInputWhenFirstInMllHAS_DOCUMENTATION: TAbmesFloatField
      FieldName = 'HAS_DOCUMENTATION'
    end
    object qryOperationInputWhenFirstInMllSETUP_PROFESSION_CODE: TAbmesFloatField
      FieldName = 'SETUP_PROFESSION_CODE'
    end
    object qryOperationInputWhenFirstInMllIS_SETUP_DONE: TAbmesFloatField
      FieldName = 'IS_SETUP_DONE'
    end
    object qryOperationInputWhenFirstInMllHOUR_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'HOUR_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInMllDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
    object qryOperationInputWhenFirstInMllHAS_CAPACITY_DEFICIT: TAbmesFloatField
      FieldName = 'HAS_CAPACITY_DEFICIT'
    end
    object qryOperationInputWhenFirstInMllML_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_BRANCH_CODE'
    end
    object qryOperationInputWhenFirstInMllML_OBJECT_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_CODE'
    end
    object qryOperationInputWhenFirstInMllMLL_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_BRANCH_CODE'
    end
    object qryOperationInputWhenFirstInMllMLL_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_CODE'
    end
    object qryOperationInputWhenFirstInMllMLMSO_IS_AUTO_MOVEMENT: TAbmesFloatField
      FieldName = 'MLMSO_IS_AUTO_MOVEMENT'
    end
    object qryOperationInputWhenFirstInMllVARIANT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'VARIANT_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInMllSTORE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'STORE_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInMllWASTED_BEFORE_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'WASTED_BEFORE_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInMllIN_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'IN_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInMllOUT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OUT_DETAIL_TECH_QUANTITY'
    end
    object qryOperationInputWhenFirstInMllAVAILABLE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'AVAILABLE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryOperationInputWhenFirstInMllTO_LEAVE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_LEAVE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
  end
  object prvOperationInput: TDataSetProvider
    DataSet = qryOperationInputWhenNotFirst
    UpdateMode = upWhereKeyOnly
    BeforeGetRecords = prvOperationInputBeforeGetRecords
    Left = 264
    Top = 120
  end
  object prvOperationOutput: TDataSetProvider
    DataSet = qryOperationOutputWhenNotLast
    UpdateMode = upWhereKeyOnly
    BeforeGetRecords = prvOperationOutputBeforeGetRecords
    Left = 448
    Top = 120
  end
  object qryOperationOutputWhenNotLast: TAbmesSQLQuery
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO,'
      '  mlmso2.OPERATION_TYPE_CODE,'
      ''
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      ''
      '  mll2.DETAIL_CODE,'
      '  dprod2.NAME as DETAIL_NAME,'
      ''
      
        '  (mlms2.ML_MODEL_STAGE_NO || '#39'-'#39' || mlmso2.MLMS_OPERATION_NO ||' +
        ' '#39'.'#39' || mlmso2.MLMS_OPERATION_VARIANT_NO) as SHOW_NO,'
      ''
      '  mlmso2.TREATMENT_BEGIN_DATE,'
      '  mlmso2.TREATMENT_END_DATE,'
      '  mlmso2.TREATMENT_BEGIN_DATE as TREATMENT_DATE,'
      
        '  NullIf(%COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DAT' +
        'E], 0) as RESERVE_DAYS,'
      '  '
      '  mlmso2.DEPT_CODE,'
      '  ( select'
      '      d2.NAME'
      '    from'
      '      DEPTS d2'
      '    where'
      '      (d2.DEPT_CODE = mlmso2.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      '  '
      '  ( select'
      '      d3.NAME'
      '    from'
      '      DEPTS d3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE)'
      '  ) as STAGE_DEPT_NAME,'
      ''
      '  ( select'
      
        '      (dt3.DEPT_TYPE_ABBREV || d3.CUSTOM_CODE || d3.SUFFIX_LETTE' +
        'R)'
      '    from'
      '      DEPTS d3,'
      '      DEPT_TYPES dt3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE) and'
      '      (d3.DEPT_TYPE_CODE = dt3.DEPT_TYPE_CODE(+))'
      '  ) as STAGE_DEPT_IDENTIFIER'
      ''
      'from'
      '  MLMS_OPERATIONS mlmso2,'
      '  ML_MODEL_STAGES mlms2,'
      '  MATERIAL_LIST_LINES mll2,'
      '  PRODUCTS dprod2'
      ''
      'where'
      
        '  (mlms2.MLL_OBJECT_BRANCH_CODE = mll2.MLL_OBJECT_BRANCH_CODE) a' +
        'nd'
      '  (mlms2.MLL_OBJECT_CODE = mll2.MLL_OBJECT_CODE) and'
      ''
      '  (dprod2.PRODUCT_CODE = mll2.DETAIL_CODE) and'
      ''
      
        '  (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_OBJECT_BRANCH_COD' +
        'E) and'
      '  (mlmso2.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_CODE) and'
      '  (mlmso2.IS_ACTIVE = 1) and'
      '  (mlmso2.MLMS_OPERATION_VARIANT_NO >= 0) and'
      ''
      
        '  ( (mlmso2.MLMS_OBJECT_BRANCH_CODE, mlmso2.MLMS_OBJECT_CODE, ml' +
        'mso2.MLMS_OPERATION_NO) ='
      '    ( select'
      
        '        mlmso.MLMS_OBJECT_BRANCH_CODE, mlmso.MLMS_OBJECT_CODE, (' +
        'mlmso.MLMS_OPERATION_NO + 1)'
      '      from'
      '        MLMS_OPERATIONS mlmso'
      '      where'
      
        '        (mlmso.MLMSO_OBJECT_BRANCH_CODE = :MLMSO_OBJECT_BRANCH_C' +
        'ODE) and'
      '        (mlmso.MLMSO_OBJECT_CODE = :MLMSO_OBJECT_CODE)'
      '    )'
      '  )'
      ''
      'order by'
      '  mlms2.ML_MODEL_STAGE_NO,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DATE]'
        ParamType = ptInput
        Value = '0=0'
      end>
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftFloat
        Name = 'IS_LAST_OPERATION_IN_STAGE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_LAST_STAGE_IN_MLL'
        ParamType = ptInput
      end>
    Left = 448
    Top = 168
    object qryOperationOutputWhenNotLastMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationOutputWhenNotLastMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationOutputWhenNotLastMLMS_OPERATION_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_NO'
    end
    object qryOperationOutputWhenNotLastMLMS_OPERATION_VARIANT_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_VARIANT_NO'
    end
    object qryOperationOutputWhenNotLastOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryOperationOutputWhenNotLastNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryOperationOutputWhenNotLastFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryOperationOutputWhenNotLastDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryOperationOutputWhenNotLastDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryOperationOutputWhenNotLastSHOW_NO: TAbmesWideStringField
      FieldName = 'SHOW_NO'
      Size = 122
    end
    object qryOperationOutputWhenNotLastTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryOperationOutputWhenNotLastTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryOperationOutputWhenNotLastTREATMENT_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_DATE'
    end
    object qryOperationOutputWhenNotLastRESERVE_DAYS: TAbmesFloatField
      FieldName = 'RESERVE_DAYS'
    end
    object qryOperationOutputWhenNotLastDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryOperationOutputWhenNotLastSTAGE_DEPT_NAME: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_NAME'
      Size = 100
    end
    object qryOperationOutputWhenNotLastSTAGE_DEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_IDENTIFIER'
      Size = 46
    end
    object qryOperationOutputWhenNotLastDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
  end
  object qryOperationOutputWhenLastInStage: TAbmesSQLQuery
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO,'
      '  mlmso2.OPERATION_TYPE_CODE,'
      ''
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      ''
      '  mll2.DETAIL_CODE,'
      '  dprod2.NAME as DETAIL_NAME,'
      ''
      
        '  (mlms2.ML_MODEL_STAGE_NO || '#39'-'#39' || mlmso2.MLMS_OPERATION_NO ||' +
        ' '#39'.'#39' || mlmso2.MLMS_OPERATION_VARIANT_NO) as SHOW_NO,'
      ''
      '  mlmso2.TREATMENT_BEGIN_DATE,'
      '  mlmso2.TREATMENT_END_DATE,'
      '  mlmso2.TREATMENT_BEGIN_DATE as TREATMENT_DATE,'
      
        '  NullIf(%COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DAT' +
        'E], 0) as RESERVE_DAYS,'
      '  '
      '  mlmso2.DEPT_CODE,'
      '  ( select'
      '      d2.NAME'
      '    from'
      '      DEPTS d2'
      '    where'
      '      (d2.DEPT_CODE = mlmso2.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      '  '
      '  ( select'
      '      d3.NAME'
      '    from'
      '      DEPTS d3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE)'
      '  ) as STAGE_DEPT_NAME,'
      ''
      '  ( select'
      
        '      (dt3.DEPT_TYPE_ABBREV || d3.CUSTOM_CODE || d3.SUFFIX_LETTE' +
        'R)'
      '    from'
      '      DEPTS d3,'
      '      DEPT_TYPES dt3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE) and'
      '      (d3.DEPT_TYPE_CODE = dt3.DEPT_TYPE_CODE(+))'
      '  ) as STAGE_DEPT_IDENTIFIER'
      ''
      'from'
      '  ML_MODEL_STAGES mlms2,'
      '  MLMS_OPERATIONS mlmso2,'
      '  MATERIAL_LIST_LINES mll2,'
      '  PRODUCTS dprod2'
      ''
      'where'
      
        '  (mlms2.MLL_OBJECT_BRANCH_CODE = mll2.MLL_OBJECT_BRANCH_CODE) a' +
        'nd'
      '  (mlms2.MLL_OBJECT_CODE = mll2.MLL_OBJECT_CODE) and'
      ''
      '  (dprod2.PRODUCT_CODE = mll2.DETAIL_CODE) and'
      ''
      
        '  ( (mlms2.MLL_OBJECT_BRANCH_CODE, mlms2.MLL_OBJECT_CODE, mlms2.' +
        'ML_MODEL_STAGE_NO) ='
      '    ( select'
      
        '        mlms.MLL_OBJECT_BRANCH_CODE, mlms.MLL_OBJECT_CODE, (mlms' +
        '.ML_MODEL_STAGE_NO + 1)'
      '      from'
      '        ML_MODEL_STAGES mlms'
      '      where'
      
        '        ( (mlms.MLMS_OBJECT_BRANCH_CODE, mlms.MLMS_OBJECT_CODE) ' +
        '='
      '          ( select'
      
        '              mlmso.MLMS_OBJECT_BRANCH_CODE, mlmso.MLMS_OBJECT_C' +
        'ODE'
      '            from'
      '              MLMS_OPERATIONS mlmso'
      '            where'
      
        '              (mlmso.MLMSO_OBJECT_BRANCH_CODE = :MLMSO_OBJECT_BR' +
        'ANCH_CODE) and'
      '              (mlmso.MLMSO_OBJECT_CODE = :MLMSO_OBJECT_CODE)'
      '          )'
      '        )'
      '    )'
      '  ) and'
      ''
      
        '  (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRANCH_COD' +
        'E) and'
      '  (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      ''
      '  (not exists'
      '    ( select'
      '        1'
      '      from'
      '        MLMS_OPERATIONS mlmso3'
      '      where'
      
        '        (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRA' +
        'NCH_CODE) and'
      '        (mlmso3.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      '        (mlmso3.MLMS_OPERATION_NO < mlmso2.MLMS_OPERATION_NO)'
      '    )'
      '  ) and'
      ''
      '  (mlmso2.IS_ACTIVE = 1) and'
      '  (mlmso2.MLMS_OPERATION_VARIANT_NO >= 0)'
      ''
      'order by'
      '  mlms2.ML_MODEL_STAGE_NO,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DATE]'
        ParamType = ptInput
        Value = '0=0'
      end>
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftFloat
        Name = 'IS_LAST_OPERATION_IN_STAGE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_LAST_STAGE_IN_MLL'
        ParamType = ptInput
      end>
    Left = 448
    Top = 216
    object qryOperationOutputWhenLastInStageMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationOutputWhenLastInStageMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationOutputWhenLastInStageMLMS_OPERATION_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_NO'
    end
    object qryOperationOutputWhenLastInStageMLMS_OPERATION_VARIANT_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_VARIANT_NO'
    end
    object qryOperationOutputWhenLastInStageOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryOperationOutputWhenLastInStageNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryOperationOutputWhenLastInStageFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryOperationOutputWhenLastInStageDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryOperationOutputWhenLastInStageDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryOperationOutputWhenLastInStageSHOW_NO: TAbmesWideStringField
      FieldName = 'SHOW_NO'
      Size = 122
    end
    object qryOperationOutputWhenLastInStageTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryOperationOutputWhenLastInStageTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryOperationOutputWhenLastInStageTREATMENT_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_DATE'
    end
    object qryOperationOutputWhenLastInStageRESERVE_DAYS: TAbmesFloatField
      FieldName = 'RESERVE_DAYS'
    end
    object qryOperationOutputWhenLastInStageDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryOperationOutputWhenLastInStageSTAGE_DEPT_NAME: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_NAME'
      Size = 100
    end
    object qryOperationOutputWhenLastInStageSTAGE_DEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_IDENTIFIER'
      Size = 46
    end
    object qryOperationOutputWhenLastInStageDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
  end
  object qryOperationOutputWhenLastInMll: TAbmesSQLQuery
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMSO_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO,'
      '  mlmso2.OPERATION_TYPE_CODE,'
      ''
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      ''
      '  mll2.DETAIL_CODE,'
      '  dprod2.NAME as DETAIL_NAME,'
      ''
      
        '  (mlms2.ML_MODEL_STAGE_NO || '#39'-'#39' || mlmso2.MLMS_OPERATION_NO ||' +
        ' '#39'.'#39' || mlmso2.MLMS_OPERATION_VARIANT_NO) as SHOW_NO,'
      ''
      '  mlmso2.TREATMENT_BEGIN_DATE,'
      '  mlmso2.TREATMENT_END_DATE,'
      '  mlmso2.TREATMENT_BEGIN_DATE as TREATMENT_DATE,'
      
        '  NullIf(%COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DAT' +
        'E], 0) as RESERVE_DAYS,'
      ''
      '  mlmso2.DEPT_CODE,'
      '  ( select'
      '      d2.NAME'
      '    from'
      '      DEPTS d2'
      '    where'
      '      (d2.DEPT_CODE = mlmso2.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      '  '
      '  ( select'
      '      d3.NAME'
      '    from'
      '      DEPTS d3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE)'
      '  ) as STAGE_DEPT_NAME,'
      ''
      '  ( select'
      
        '      (dt3.DEPT_TYPE_ABBREV || d3.CUSTOM_CODE || d3.SUFFIX_LETTE' +
        'R)'
      '    from'
      '      DEPTS d3,'
      '      DEPT_TYPES dt3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE) and'
      '      (d3.DEPT_TYPE_CODE = dt3.DEPT_TYPE_CODE(+))'
      '  ) as STAGE_DEPT_IDENTIFIER'
      ''
      'from'
      '  ML_MODEL_STAGES mlms2,'
      '  MLMS_OPERATIONS mlmso2,'
      '  MATERIAL_LIST_LINES mll2,'
      '  PRODUCTS dprod2'
      '  '
      'where'
      
        '  (mlms2.MLL_OBJECT_BRANCH_CODE = mll2.MLL_OBJECT_BRANCH_CODE) a' +
        'nd'
      '  (mlms2.MLL_OBJECT_CODE = mll2.MLL_OBJECT_CODE) and'
      ''
      '  (dprod2.PRODUCT_CODE = mll2.DETAIL_CODE) and'
      ''
      '  ( (mlms2.MLL_OBJECT_BRANCH_CODE, mlms2.MLL_OBJECT_CODE) ='
      '    ( select'
      
        '        mll.PARENT_MLL_OBJECT_BRANCH_CODE, mll.PARENT_MLL_OBJECT' +
        '_CODE'
      '      from'
      '        MATERIAL_LIST_LINES mll'
      '      where'
      '        ( (mll.MLL_OBJECT_BRANCH_CODE, mll.MLL_OBJECT_CODE) ='
      '          ( select'
      '              mlms.MLL_OBJECT_BRANCH_CODE, mlms.MLL_OBJECT_CODE'
      '            from'
      '              ML_MODEL_STAGES mlms'
      '            where'
      
        '              ( (mlms.MLMS_OBJECT_BRANCH_CODE, mlms.MLMS_OBJECT_' +
        'CODE) ='
      '                ( select'
      
        '                    mlmso.MLMS_OBJECT_BRANCH_CODE, mlmso.MLMS_OB' +
        'JECT_CODE'
      '                  from'
      '                    MLMS_OPERATIONS mlmso'
      '                  where'
      
        '                    (mlmso.MLMSO_OBJECT_BRANCH_CODE = :MLMSO_OBJ' +
        'ECT_BRANCH_CODE) and'
      
        '                    (mlmso.MLMSO_OBJECT_CODE = :MLMSO_OBJECT_COD' +
        'E)'
      '                )'
      '              )'
      '          )'
      '        )'
      '    )'
      '  ) and'
      ''
      '  (mlms2.ML_MODEL_STAGE_NO = 1) and'
      
        '  (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRANCH_COD' +
        'E) and'
      '  (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      ''
      '  (not exists'
      '    ( select'
      '        1'
      '      from'
      '        MLMS_OPERATIONS mlmso3'
      '      where'
      
        '        (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRA' +
        'NCH_CODE) and'
      '        (mlmso3.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      '        (mlmso3.MLMS_OPERATION_NO < mlmso2.MLMS_OPERATION_NO)'
      '    )'
      '  ) and'
      ''
      '  (mlmso2.IS_ACTIVE = 1) and'
      '  (mlmso2.MLMS_OPERATION_VARIANT_NO >= 0)'
      ''
      'order by'
      '  mlms2.ML_MODEL_STAGE_NO,'
      '  mlmso2.MLMS_OPERATION_NO,'
      '  mlmso2.MLMS_OPERATION_VARIANT_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DATE]'
        ParamType = ptInput
        Value = '0=0'
      end>
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftFloat
        Name = 'IS_LAST_OPERATION_IN_STAGE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'IS_LAST_STAGE_IN_MLL'
        ParamType = ptInput
      end>
    Left = 448
    Top = 264
    object qryOperationOutputWhenLastInMllMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationOutputWhenLastInMllMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryOperationOutputWhenLastInMllMLMS_OPERATION_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_NO'
    end
    object qryOperationOutputWhenLastInMllMLMS_OPERATION_VARIANT_NO: TAbmesFloatField
      FieldName = 'MLMS_OPERATION_VARIANT_NO'
    end
    object qryOperationOutputWhenLastInMllOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryOperationOutputWhenLastInMllNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryOperationOutputWhenLastInMllFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryOperationOutputWhenLastInMllDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryOperationOutputWhenLastInMllDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryOperationOutputWhenLastInMllSHOW_NO: TAbmesWideStringField
      FieldName = 'SHOW_NO'
      Size = 122
    end
    object qryOperationOutputWhenLastInMllTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryOperationOutputWhenLastInMllTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryOperationOutputWhenLastInMllTREATMENT_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_DATE'
    end
    object qryOperationOutputWhenLastInMllRESERVE_DAYS: TAbmesFloatField
      FieldName = 'RESERVE_DAYS'
    end
    object qryOperationOutputWhenLastInMllDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryOperationOutputWhenLastInMllSTAGE_DEPT_NAME: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_NAME'
      Size = 100
    end
    object qryOperationOutputWhenLastInMllSTAGE_DEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_IDENTIFIER'
      Size = 46
    end
    object qryOperationOutputWhenLastInMllDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
  end
  object prvOneMLMSOperations: TDataSetProvider
    DataSet = qryOneMLMSOperations
    UpdateMode = upWhereKeyOnly
    Left = 48
    Top = 312
  end
  object shActiveSaleCondition: TJvStrHolder
    Capacity = 4
    Macros = <>
    Left = 112
    Top = 112
    InternalVer = 2
    StrData = (
      ''
      
        '202028732e46494e4953485f454d504c4f5945455f434f4445206973206e756c' +
        '6c2920616e64'
      
        '202028732e414e4e554c5f454d504c4f5945455f434f4445206973206e756c6c' +
        '29')
  end
  object qryStageLevelTasks: TAbmesSQLQuery
    BeforeOpen = qryStageLevelTasksBeforeOpen
    AfterClose = qryStageLevelTasksAfterClose
    OnCalcFields = qryStageLevelTasksCalcFields
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftTimeStamp
        Name = 'BEGIN_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'BEGIN_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'END_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftTimeStamp
        Name = 'END_DATE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_BASE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_BASE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_BASE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'PRODUCTION_ORDER_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_NO'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_NO'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'SALE_TYPE_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftWideString
        Name = 'MLL_NO_AS_TEXT'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLL_FORK_NO'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLL_FORK_NO'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'ALL_FILTERED_PRODUCTS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'ALL_FILTERED_PRODUCTS_2'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'BEGIN_PRIORITY_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'END_PRIORITY_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'OPERATION_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'OPERATION_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'OPERATION_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'OPERATION_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'AVAILABLE_QUANTITY_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'AVAILABLE_QUANTITY_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'AVAILABLE_QUANTITY_STATUS'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'AVAILABLE_QUANTITY_STATUS'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      
        '  /*+ INDEX(ml idxML__CLOSE_EMPLOYEE_2) INDEX(s pkSALES) INDEX(m' +
        'll) INDEX(mlms) LEADING(ml)*/'
      '  mlms.MLMS_OBJECT_BRANCH_CODE,'
      '  mlms.MLMS_OBJECT_CODE,'
      '  mlms.ML_MODEL_STAGE_NO,'
      '  mlms.IS_AUTO_MOVEMENT,'
      '  %IS_AUTO_RECEIVING_STAGE[mlms] as IS_AUTO_RECEIVING_STAGE,'
      '  mlms.TREATMENT_BEGIN_DATE,'
      '  mlms.TREATMENT_END_DATE,'
      '  mlms.TREATMENT_WORKDAYS,'
      
        '  Greatest(mlms.TREATMENT_BEGIN_DATE, ContextDate) as EFFECTIVE_' +
        'TREATMENT_BEGIN_DATE,'
      
        '  Greatest(mlms.TREATMENT_END_DATE, ContextDate) as EFFECTIVE_TR' +
        'EATMENT_END_DATE,'
      ''
      '  %COUNT_WORKDAYS['
      '    Greatest(mlms.TREATMENT_BEGIN_DATE, ContextDate)~'
      '    Greatest(mlms.TREATMENT_END_DATE, ContextDate)'
      '  ] as EFFECTIVE_TREATMENT_WORKDAYS,'
      ''
      '  ( case'
      '      when  (ContextDate > mlms.TREATMENT_END_DATE) and'
      '            ( MiscUtils.LargeZero('
      '                mll.LINE_DETAIL_TECH_QUANTITY'
      '                -'
      
        '                ( select -- izliazlo ot nashia etap za sledvasht' +
        'ia etap ili brak (OUT_DETAIL_TECH_QUANTITY)'
      '                    Coalesce(Sum(mm.DETAIL_TECH_QUANTITY), 0)'
      '                  from'
      '                    MODEL_MOVEMENTS mm'
      '                  where'
      
        '                    (mm.FROM_MLMS_OBJECT_BRANCH_CODE = mlms.MLMS' +
        '_OBJECT_BRANCH_CODE) and'
      
        '                    (mm.FROM_MLMS_OBJECT_CODE = mlms.MLMS_OBJECT' +
        '_CODE) and'
      '                    (mm.STORNO_EMPLOYEE_CODE is null)'
      '                )'
      '              )'
      '              >'
      '              0'
      '            )'
      '      then'
      '        1'
      '      else'
      '        0'
      '    end'
      '  ) as IS_LATE,'
      ''
      '  mll.MLL_OBJECT_BRANCH_CODE,'
      '  mll.MLL_OBJECT_CODE,'
      '  mll.NO_AS_TEXT,'
      '  mll.NO_AS_FORMATED_TEXT,'
      
        '  RPad(mll.NO_AS_FORMATED_TEXT, 100, Decode(mll.FORK_NO, 0, '#39' '#39',' +
        ' '#39'x'#39')) as NO_AS_FORMATED_TEXT_EX,'
      '  mll.FORK_NO,'
      '  mll.DETAIL_CODE,'
      ''
      '  dprod.NAME as DETAIL_NAME,'
      ''
      '  ( select'
      '      m.MEASURE_ABBREV'
      '    from'
      '      MEASURES m'
      '    where'
      '      (dprod.TECH_MEASURE_CODE = m.MEASURE_CODE)'
      '  ) as DETAIL_TECH_MEASURE_ABBREV,'
      ''
      
        '  %PRODUCT_COMPANY_PRODUCT_NAMES[mll.DETAIL_CODE~s.CLIENT_COMPAN' +
        'Y_CODE] as CLIENT_DETAIL_NAME,'
      '  '
      '  mll.LINE_DETAIL_TECH_QUANTITY,'
      ''
      '  ml.ML_OBJECT_BRANCH_CODE,'
      '  ml.ML_OBJECT_CODE,'
      ''
      '  s.SALE_OBJECT_BRANCH_CODE,'
      '  s.SALE_OBJECT_CODE,'
      ''
      '  ( ( select'
      '        pot.PRODUCTION_ORDER_TYPE_ABBREV'
      '      from'
      '        PRODUCTION_ORDER_TYPES pot'
      '      where'
      
        '        (pot.PRODUCTION_ORDER_TYPE_CODE = s.PRODUCTION_ORDER_TYP' +
        'E_CODE)'
      '    ) ||'
      '    '#39'/'#39' ||'
      '    ( select'
      '        d.CUSTOM_CODE'
      '      from'
      '        DEPTS d'
      '      where'
      '        (d.DEPT_CODE = s.SALE_BRANCH_CODE)'
      '    ) ||'
      '    '#39'/'#39' ||'
      '    s.SALE_NO ||'
      '    '#39'/'#39' ||'
      '    ( select'
      '        st.SALE_TYPE_ABBREV'
      '      from'
      '        SALE_TYPES st'
      '      where'
      '        (st.SALE_TYPE_CODE = s.SALE_TYPE_CODE)'
      '    )'
      '  ) as PRODUCTION_ORDER_IDENTIFIER,'
      ''
      '  ( select'
      '      d.CUSTOM_CODE'
      '    from'
      '      DEPTS d'
      '    where'
      '      (d.DEPT_CODE = s.SALE_BRANCH_CODE)'
      '  ) as SALE_BRANCH_NO,'
      ''
      
        '  Nvl2(s.WASTING_SALE_OBJ_BRANCH_CODE, 1, 0) as IS_WASTE_COMPENS' +
        'ATOR,'
      ''
      '  sg.PRIORITY_CODE,'
      ''
      '  ( select'
      '      prt.PRIORITY_NO'
      '    from'
      '      PRIORITIES prt'
      '    where'
      '      (prt.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '  ) as PRIORITY_NO,'
      ''
      '  ( select'
      '      prt.PRIORITY_COLOR'
      '    from'
      '      PRIORITIES prt'
      '    where'
      '      (prt.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '  ) as PRIORITY_COLOR,'
      ''
      '  ( select'
      '      prt.PRIORITY_BACKGROUND_COLOR'
      '    from'
      '      PRIORITIES prt'
      '    where'
      '      (prt.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '  ) as PRIORITY_BACKGROUND_COLOR,'
      ''
      '  s.WORK_PRIORITY_CODE,'
      ''
      '  ( select'
      '      wprt.WORK_PRIORITY_NO'
      '    from'
      '      WORK_PRIORITIES wprt'
      '    where'
      '      (wprt.WORK_PRIORITY_CODE = s.WORK_PRIORITY_CODE)'
      '  ) as WORK_PRIORITY_NO,'
      ''
      '  mlms.DEPT_CODE as STAGE_DEPT_CODE,'
      ''
      '  ( select'
      '      d.NAME'
      '    from'
      '      DEPTS d'
      '    where'
      '      (d.DEPT_CODE = mlms.DEPT_CODE)'
      '  ) as STAGE_DEPT_NAME,'
      ''
      '  ( select'
      '      (dt.DEPT_TYPE_ABBREV || d.CUSTOM_CODE || d.SUFFIX_LETTER)'
      '    from'
      '      DEPTS d,'
      '      DEPT_TYPES dt'
      '    where'
      '      (d.DEPT_CODE = mlms.DEPT_CODE) and'
      '      (d.DEPT_TYPE_CODE = dt.DEPT_TYPE_CODE(+))'
      '  ) as STAGE_DEPT_IDENTIFIER,'
      ''
      '  mlms.DOC_BRANCH_CODE,'
      '  mlms.DOC_CODE,'
      ''
      '  %HAS_DOC_ITEMS[mlms] as HAS_DOCUMENTATION,'
      ''
      '  dprod.DOC_BRANCH_CODE as DETAIL_DOC_BRANCH_CODE,'
      '  dprod.DOC_CODE as DETAIL_DOC_CODE,'
      ''
      '  ( select'
      '      (1 - Sign(Count(*)))'
      '    from'
      '      ML_MODEL_STAGES mlms2'
      '    where'
      
        '      (mlms2.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_BRANCH_COD' +
        'E) and'
      '      (mlms2.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) and'
      '      (mlms2.ML_MODEL_STAGE_NO < mlms.ML_MODEL_STAGE_NO)'
      '  ) as IS_FIRST_STAGE_IN_MLL,'
      ''
      '  ( select'
      '      (1 - Sign(Count(*)))'
      '    from'
      '      ML_MODEL_STAGES mlms2'
      '    where'
      
        '      (mlms2.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_BRANCH_COD' +
        'E) and'
      '      (mlms2.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) and'
      '      (mlms2.ML_MODEL_STAGE_NO > mlms.ML_MODEL_STAGE_NO) and'
      '      (mlms2.TREATMENT_WORKDAYS > 0)'
      '  ) as IS_LAST_STAGE_IN_MLL,'
      ''
      '  mlmso.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso.MLMSO_OBJECT_CODE,'
      '  mlmso.OPERATION_TYPE_CODE,'
      ''
      '  Coalesce('
      '    ( select'
      '        mlmso2.OPERATION_TYPE_CODE'
      '      from'
      '        MLMS_OPERATIONS mlmso2'
      '      where'
      
        '        (mlmso2.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJECT_BRAN' +
        'CH_CODE) and'
      '        (mlmso2.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE) and'
      
        '        (mlmso2.MLMS_OPERATION_NO = mlmso.MLMS_OPERATION_NO + 1)' +
        ' and'
      
        '        (mlmso2.MLMS_OPERATION_VARIANT_NO = 0)  -- sluchaen vari' +
        'ant - tipa e edin i susht za vsichki varianti'
      '    ),'
      '    Coalesce('
      '      ( select'
      '          mlmso2.OPERATION_TYPE_CODE'
      '        from'
      '          MLMS_OPERATIONS mlmso2'
      '        where'
      
        '          ( (mlmso2.MLMS_OBJECT_BRANCH_CODE, mlmso2.MLMS_OBJECT_' +
        'CODE, mlmso2.MLMS_OPERATION_NO) ='
      '            ( select'
      '                mlms2.MLMS_OBJECT_BRANCH_CODE,'
      '                mlms2.MLMS_OBJECT_CODE,'
      '                ( select'
      '                    Min(mlmso3.MLMS_OPERATION_NO)'
      '                  from'
      '                    MLMS_OPERATIONS mlmso3'
      '                  where'
      
        '                    (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS' +
        '_OBJECT_BRANCH_CODE) and'
      
        '                    (mlmso3.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT' +
        '_CODE)'
      '                ) as MIN_MLMS_OPERATION_NO'
      '              from'
      '                ML_MODEL_STAGES mlms2'
      '              where'
      
        '                (mlms2.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_' +
        'BRANCH_CODE) and'
      
        '                (mlms2.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) a' +
        'nd'
      
        '                (mlms2.ML_MODEL_STAGE_NO = mlms.ML_MODEL_STAGE_N' +
        'O + 1)'
      '            )'
      '          ) and'
      
        '          (mlmso2.MLMS_OPERATION_VARIANT_NO = 0)  -- sluchaen va' +
        'riant - tipa e edin i susht za vsichki varianti'
      '      ),'
      '      ( select'
      '          mlmso2.OPERATION_TYPE_CODE'
      '        from'
      '          MLMS_OPERATIONS mlmso2'
      '        where'
      
        '          ( (mlmso2.MLMS_OBJECT_BRANCH_CODE, mlmso2.MLMS_OBJECT_' +
        'CODE, mlmso2.MLMS_OPERATION_NO) ='
      '            ( select'
      '                mlms2.MLMS_OBJECT_BRANCH_CODE,'
      '                mlms2.MLMS_OBJECT_CODE,'
      '                ( select'
      '                    Min(mlmso3.MLMS_OPERATION_NO)'
      '                  from'
      '                    MLMS_OPERATIONS mlmso3'
      '                  where'
      
        '                    (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS' +
        '_OBJECT_BRANCH_CODE) and'
      
        '                    (mlmso3.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT' +
        '_CODE)'
      '                ) as MIN_MLMS_OPERATION_NO'
      '              from'
      '                ML_MODEL_STAGES mlms2'
      '              where'
      
        '                (mlms2.MLL_OBJECT_BRANCH_CODE = mll.PARENT_MLL_O' +
        'BJECT_BRANCH_CODE) and'
      
        '                (mlms2.MLL_OBJECT_CODE = mll.PARENT_MLL_OBJECT_C' +
        'ODE) and'
      '                (mlms2.ML_MODEL_STAGE_NO = 1)'
      '            )'
      '          ) and'
      
        '          (mlmso2.MLMS_OPERATION_VARIANT_NO = 0)  -- sluchaen va' +
        'riant - tipa e edin i susht za vsichki varianti'
      '      )'
      '    )'
      '  ) as NEXT_OPERATION_TYPE_CODE,'
      ''
      '  MiscUtils.LargeZero('
      '    ( select -- brak po predhodinte etapi ot toia red'
      '        Coalesce(Sum(mm.DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        ML_MODEL_STAGES mlms2,'
      '        MODEL_MOVEMENTS mm'
      '      where'
      
        '        (mlms2.MLL_OBJECT_BRANCH_CODE = mll.MLL_OBJECT_BRANCH_CO' +
        'DE) and'
      '        (mlms2.MLL_OBJECT_CODE = mll.MLL_OBJECT_CODE) and'
      '  '
      
        '        (mm.FROM_MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_OBJECT_BRA' +
        'NCH_CODE) and'
      '        (mm.FROM_MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_CODE) and'
      '  '
      '        (mm.STORNO_EMPLOYEE_CODE is null) and'
      '        (mm.TO_DEPT_CODE is not null) and'
      '  '
      '        (mlms2.ML_MODEL_STAGE_NO < mlms.ML_MODEL_STAGE_NO)'
      '    )'
      '  ) as WASTED_BEFORE_TECH_QUANTITY,'
      ''
      '  ModelUtils.GetMlmsRcvdForDetailTechQty('
      '    mlms.MLMS_OBJECT_BRANCH_CODE,'
      '    mlms.MLMS_OBJECT_CODE,'
      '    ( select'
      '        iv.FEATURE_FLAG_OPERATION_LOADING'
      '      from'
      '        INTERNAL_VALUES iv'
      '      where'
      '        (iv.CODE = 1)'
      '    )'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      
        '    ( select -- izliazlo ot nashia etap za sledvashtia etap ili ' +
        'brak'
      '        Coalesce(Sum(mm.DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        MODEL_MOVEMENTS mm'
      '      where'
      
        '        (mm.FROM_MLMS_OBJECT_BRANCH_CODE = mlms.MLMS_OBJECT_BRAN' +
        'CH_CODE) and'
      '        (mm.FROM_MLMS_OBJECT_CODE = mlms.MLMS_OBJECT_CODE) and'
      '        (mm.STORNO_EMPLOYEE_CODE is null)'
      '    )'
      '  ) as OUT_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      '    ( select -- izliazlo ot nashia etap za brak'
      
        '        Sum(mm.DETAIL_TECH_QUANTITY) -- narochno niama Coalesce(' +
        ')'
      '      from'
      '        MODEL_MOVEMENTS mm'
      '      where'
      
        '        (mm.FROM_MLMS_OBJECT_BRANCH_CODE = mlms.MLMS_OBJECT_BRAN' +
        'CH_CODE) and'
      '        (mm.FROM_MLMS_OBJECT_CODE = mlms.MLMS_OBJECT_CODE) and'
      '        (mm.STORNO_EMPLOYEE_CODE is null) and'
      '        (mm.TO_DEPT_CODE is not null)'
      '    )'
      '  ) as OUT_WASTE_DETAIL_TECH_QUANTITY,'
      ''
      '  0 as IS_RECORD_CHANGED'
      ''
      'from'
      '  MATERIAL_LISTS ml,'
      '  SALES s,'
      '  PRODUCTION_ORDER_TYPES pot,'
      '  SALE_GROUPS sg,'
      '  MATERIAL_LIST_LINES mll,'
      '  ML_MODEL_STAGES mlms,'
      '  PRODUCTS dprod,'
      '  MLMS_OPERATIONS mlmso'
      ''
      'where'
      
        '  (sg.SALE_GROUP_OBJECT_BRANCH_CODE = s.SALE_GROUP_OBJECT_BRANCH' +
        '_CODE) and'
      '  (sg.SALE_GROUP_OBJECT_CODE = s.SALE_GROUP_OBJECT_CODE) and'
      ''
      
        '  (s.SALE_OBJECT_BRANCH_CODE = ml.BND_PROCESS_OBJECT_BRANCH_CODE' +
        ') and'
      '  (s.SALE_OBJECT_CODE = ml.BND_PROCESS_OBJECT_CODE) and'
      ''
      
        '  (s.PRODUCTION_ORDER_TYPE_CODE = pot.PRODUCTION_ORDER_TYPE_CODE' +
        ') and'
      ''
      '  (ml.ML_OBJECT_BRANCH_CODE = mll.ML_OBJECT_BRANCH_CODE) and'
      '  (ml.ML_OBJECT_CODE = mll.ML_OBJECT_CODE) and'
      ''
      '  (mll.MLL_OBJECT_BRANCH_CODE = mlms.MLL_OBJECT_BRANCH_CODE) and'
      '  (mll.MLL_OBJECT_CODE = mlms.MLL_OBJECT_CODE) and'
      ''
      '  (mll.DETAIL_CODE = dprod.PRODUCT_CODE) and'
      ''
      
        '  (mlms.MLMS_OBJECT_BRANCH_CODE = mlmso.MLMS_OBJECT_BRANCH_CODE(' +
        '+)) and'
      '  (mlms.MLMS_OBJECT_CODE = mlmso.MLMS_OBJECT_CODE(+)) and'
      '  (1 = mlmso.OPERATION_TYPE_CODE(+)) and'
      ''
      '  (s.FINISH_EMPLOYEE_CODE is null) and'
      '  (s.ANNUL_EMPLOYEE_CODE is null) and'
      '  (ml.LIMITING_EMPLOYEE_CODE is not null) and'
      '  (ml.CLOSE_EMPLOYEE_CODE is null) and'
      '  (ml.ANNUL_EMPLOYEE_CODE is null) and'
      '  (mll.ANNUL_EMPLOYEE_CODE is null) and'
      '  (mlms.ML_MODEL_STAGE_NO <> 0) and'
      '  (mlms.OUTGOING_WORKDAYS <> 0) and'
      ''
      '  -- narochno nqma ALL_FILTERED_DEPTS'
      '  (exists'
      '    ( select'
      '        1'
      '      from'
      '        TEMP_FILTERED_DEPTS tfd'
      '      where'
      '        (tfd.DEPT_CODE = mlms.DEPT_CODE)'
      '    )'
      '  ) and'
      ''
      '  ( (mlms.TREATMENT_BEGIN_DATE >= :BEGIN_DATE) or'
      '    (ContextDate >= :BEGIN_DATE)'
      '  ) and'
      ''
      '  (mlms.TREATMENT_BEGIN_DATE <= :END_DATE) and'
      '  (ContextDate <= :END_DATE) and'
      ''
      '  ( (:PRODUCTION_ORDER_BASE_TYPE_CODE is null) or'
      '    (:PRODUCTION_ORDER_BASE_TYPE_CODE = 0) or'
      
        '    (pot.PROD_ORDER_BASE_TYPE_CODE = :PRODUCTION_ORDER_BASE_TYPE' +
        '_CODE)'
      '  ) and'
      ''
      '  ( (:PRODUCTION_ORDER_TYPE_CODE is null) or'
      '    (s.PRODUCTION_ORDER_TYPE_CODE = :PRODUCTION_ORDER_TYPE_CODE)'
      '  ) and'
      ''
      '  ( (:SALE_BRANCH_CODE is null) or'
      '    (s.SALE_BRANCH_CODE = :SALE_BRANCH_CODE)'
      '  ) and'
      ''
      '  ( (:SALE_NO is null) or'
      '    (s.SALE_NO = :SALE_NO)'
      '  ) and'
      ''
      '  ( (:SALE_TYPE_CODE is null) or'
      '    (s.SALE_TYPE_CODE = :SALE_TYPE_CODE)'
      '  ) and'
      ''
      '  (mll.NO_AS_TEXT like :MLL_NO_AS_TEXT) and'
      ''
      '  ( (:MLL_FORK_NO is null) or'
      '    (mll.FORK_NO = :MLL_FORK_NO)'
      '  ) and'
      ''
      '  ( (:ALL_FILTERED_PRODUCTS = 1) or'
      '    (exists'
      '      ( select'
      '          1'
      '        from'
      '          TEMP_FILTERED_PRODUCTS tfp'
      '        where'
      '          (tfp.PRODUCT_CODE = ml.RESULT_PRODUCT_CODE)'
      '      )'
      '    )'
      '  ) and'
      ''
      '  ( (:ALL_FILTERED_PRODUCTS_2 = 1) or'
      '    (exists'
      '      ( select'
      '          1'
      '        from'
      '          TEMP_FILTERED_PRODUCTS_2 tfp2'
      '        where'
      '          (tfp2.PRODUCT_CODE = mll.DETAIL_CODE)'
      '      )'
      '    )'
      '  ) and'
      ''
      '  -- purvoto Coalesce() e za da ne se oburkva orakala'
      '  ( Coalesce('
      '      ( select'
      '          Max(p.PRIORITY_NO)'
      '        from'
      '          PRIORITIES p'
      '        where'
      '          (p.PRIORITY_CODE = sg.PRIORITY_CODE)'
      '      ),'
      '      0'
      '    ) between'
      '      Coalesce('
      '        ( select'
      '            Max(p.PRIORITY_NO)'
      '          from'
      '            PRIORITIES p'
      '          where'
      '            (p.PRIORITY_CODE = :BEGIN_PRIORITY_CODE)'
      '        ), 0) and'
      '      Coalesce('
      '        ( select'
      '            Max(p.PRIORITY_NO)'
      '          from'
      '            PRIORITIES p'
      '          where'
      '            (p.PRIORITY_CODE = :END_PRIORITY_CODE)'
      '        ), 1000000)'
      '  ) and'
      ''
      '  ( (:OPERATION_STATUS is null) or'
      '    (:OPERATION_STATUS = 0) or'
      ''
      '    ( (:OPERATION_STATUS = 1) and'
      '      ( ('
      '          MiscUtils.LargeZero( -- TO_ENTER_DETAIL_TECH_QUANTITY'
      '            ( Greatest('
      '                0,'
      '                ( mll.LINE_DETAIL_TECH_QUANTITY'
      '                  -'
      '                  ModelUtils.GetMlmsRcvdForDetailTechQty('
      '                    mlms.MLMS_OBJECT_BRANCH_CODE,'
      '                    mlms.MLMS_OBJECT_CODE,'
      '                    ( select'
      '                        iv.FEATURE_FLAG_OPERATION_LOADING'
      '                      from'
      '                        INTERNAL_VALUES iv'
      '                      where'
      '                        (iv.CODE = 1)'
      '                    )'
      '                  ) -- IN_DETAIL_TECH_QUANTITY,'
      '                  -'
      
        '                  ( select  -- brak po predhodinte etapi ot toia' +
        ' red (WASTED_BEFORE_QUANTITY)'
      '                      Coalesce(Sum(mm.DETAIL_TECH_QUANTITY), 0)'
      '                    from'
      '                      ML_MODEL_STAGES mlms2,'
      '                      MODEL_MOVEMENTS mm'
      '                    where'
      
        '                      (mlms2.MLL_OBJECT_BRANCH_CODE = mll.MLL_OB' +
        'JECT_BRANCH_CODE) and'
      
        '                      (mlms2.MLL_OBJECT_CODE = mll.MLL_OBJECT_CO' +
        'DE) and'
      '                '
      
        '                      (mm.FROM_MLMS_OBJECT_BRANCH_CODE = mlms2.M' +
        'LMS_OBJECT_BRANCH_CODE) and'
      
        '                      (mm.FROM_MLMS_OBJECT_CODE = mlms2.MLMS_OBJ' +
        'ECT_CODE) and'
      '                '
      '                      (mm.STORNO_EMPLOYEE_CODE is null) and'
      '                      (mm.TO_DEPT_CODE is not null) and'
      '                '
      
        '                      (mlms2.ML_MODEL_STAGE_NO < mlms.ML_MODEL_S' +
        'TAGE_NO)'
      '                  )'
      '                )'
      '              )'
      '            )'
      '          )'
      '          >'
      '          0'
      '        ) or'
      ''
      '        ( MiscUtils.LargeZero( -- AVAILABLE_DETAIL_TECH_QUANTITY'
      '            ( ModelUtils.GetMlmsRcvdForDetailTechQty('
      '                mlms.MLMS_OBJECT_BRANCH_CODE,'
      '                mlms.MLMS_OBJECT_CODE,'
      '                ( select'
      '                    iv.FEATURE_FLAG_OPERATION_LOADING'
      '                  from'
      '                    INTERNAL_VALUES iv'
      '                  where'
      '                    (iv.CODE = 1)'
      '                )'
      '              ) -- IN_DETAIL_TECH_QUANTITY,'
      '              -'
      
        '              ( select -- izliazlo ot nashia etap za sledvashtia' +
        ' etap ili brak (OUT_DETAIL_TECH_QUANTITY)'
      '                  Coalesce(Sum(mm.DETAIL_TECH_QUANTITY), 0)'
      '                from'
      '                  MODEL_MOVEMENTS mm'
      '                where'
      
        '                  (mm.FROM_MLMS_OBJECT_BRANCH_CODE = mlms.MLMS_O' +
        'BJECT_BRANCH_CODE) and'
      
        '                  (mm.FROM_MLMS_OBJECT_CODE = mlms.MLMS_OBJECT_C' +
        'ODE) and'
      '                  (mm.STORNO_EMPLOYEE_CODE is null)'
      '              )'
      '            )'
      '          )'
      '          >'
      '          0'
      '        )'
      '      )'
      '    ) or'
      ''
      '    ( (:OPERATION_STATUS = 2) and'
      '      ( ( '
      '          MiscUtils.LargeZero( -- TO_ENTER_DETAIL_TECH_QUANTITY'
      '            ( Greatest('
      '                0,'
      '                ( mll.LINE_DETAIL_TECH_QUANTITY'
      '                  -'
      '                  ModelUtils.GetMlmsRcvdForDetailTechQty('
      '                    mlms.MLMS_OBJECT_BRANCH_CODE,'
      '                    mlms.MLMS_OBJECT_CODE,'
      '                    ( select'
      '                        iv.FEATURE_FLAG_OPERATION_LOADING'
      '                      from'
      '                        INTERNAL_VALUES iv'
      '                      where'
      '                        (iv.CODE = 1)'
      '                    )'
      '                  ) -- IN_DETAIL_TECH_QUANTITY,'
      '                  -'
      
        '                  ( select  -- brak po predhodinte etapi ot toia' +
        ' red (WASTED_BEFORE_QUANTITY)'
      '                      Coalesce(Sum(mm.DETAIL_TECH_QUANTITY), 0)'
      '                    from'
      '                      ML_MODEL_STAGES mlms2,'
      '                      MODEL_MOVEMENTS mm'
      '                    where'
      
        '                      (mlms2.MLL_OBJECT_BRANCH_CODE = mll.MLL_OB' +
        'JECT_BRANCH_CODE) and'
      
        '                      (mlms2.MLL_OBJECT_CODE = mll.MLL_OBJECT_CO' +
        'DE) and'
      '                '
      
        '                      (mm.FROM_MLMS_OBJECT_BRANCH_CODE = mlms2.M' +
        'LMS_OBJECT_BRANCH_CODE) and'
      
        '                      (mm.FROM_MLMS_OBJECT_CODE = mlms2.MLMS_OBJ' +
        'ECT_CODE) and'
      '                '
      '                      (mm.STORNO_EMPLOYEE_CODE is null) and'
      '                      (mm.TO_DEPT_CODE is not null) and'
      '                '
      
        '                      (mlms2.ML_MODEL_STAGE_NO < mlms.ML_MODEL_S' +
        'TAGE_NO)'
      '                  )'
      '                )'
      '              )'
      '            )'
      '          )'
      '          <='
      '          0'
      '        ) and'
      ''
      '        ( MiscUtils.LargeZero( -- AVAILABLE_DETAIL_TECH_QUANTITY'
      '            ( ModelUtils.GetMlmsRcvdForDetailTechQty('
      '                mlms.MLMS_OBJECT_BRANCH_CODE,'
      '                mlms.MLMS_OBJECT_CODE,'
      '                ( select'
      '                    iv.FEATURE_FLAG_OPERATION_LOADING'
      '                  from'
      '                    INTERNAL_VALUES iv'
      '                  where'
      '                    (iv.CODE = 1)'
      '                )'
      '              ) -- IN_DETAIL_TECH_QUANTITY,'
      '              -'
      
        '              ( select -- izliazlo ot nashia etap za sledvashtia' +
        ' etap ili brak (OUT_DETAIL_TECH_QUANTITY)'
      '                  Coalesce(Sum(mm.DETAIL_TECH_QUANTITY), 0)'
      '                from'
      '                  MODEL_MOVEMENTS mm'
      '                where'
      
        '                  (mm.FROM_MLMS_OBJECT_BRANCH_CODE = mlms.MLMS_O' +
        'BJECT_BRANCH_CODE) and'
      
        '                  (mm.FROM_MLMS_OBJECT_CODE = mlms.MLMS_OBJECT_C' +
        'ODE) and'
      '                  (mm.STORNO_EMPLOYEE_CODE is null)'
      '              )'
      '            )'
      '          )'
      '          <='
      '          0'
      '        )'
      '      )'
      '    )'
      '  ) and'
      ''
      '  ( (:AVAILABLE_QUANTITY_STATUS is null) or'
      '    (:AVAILABLE_QUANTITY_STATUS = 0) or'
      ''
      '    ( (:AVAILABLE_QUANTITY_STATUS = 1) and'
      '      ( MiscUtils.LargeZero( -- AVAILABLE_DETAIL_TECH_QUANTITY'
      '          ModelUtils.GetMlmsRcvdForDetailTechQty('
      '            mlms.MLMS_OBJECT_BRANCH_CODE,'
      '            mlms.MLMS_OBJECT_CODE,'
      '            ( select'
      '                iv.FEATURE_FLAG_OPERATION_LOADING'
      '              from'
      '                INTERNAL_VALUES iv'
      '              where'
      '                (iv.CODE = 1)'
      '            )'
      '          )  -- IN_DETAIL_TECH_QUANTITY'
      '          -        '
      
        '          ( -- izliazlo ot nashia etap za sledvashtia etap ili b' +
        'rak (OUT_DETAIL_TECH_QUANTITY)'
      '            select'
      '              Coalesce(Sum(mm.DETAIL_TECH_QUANTITY), 0)'
      '            from'
      '              MODEL_MOVEMENTS mm'
      '            where'
      
        '              (mm.FROM_MLMS_OBJECT_BRANCH_CODE = mlms.MLMS_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '              (mm.FROM_MLMS_OBJECT_CODE = mlms.MLMS_OBJECT_CODE)' +
        ' and'
      '              (mm.STORNO_EMPLOYEE_CODE is null)'
      '          )'
      '        ) '
      '        >'
      '        0'
      '      )'
      '    ) or'
      ''
      '    ( (:AVAILABLE_QUANTITY_STATUS = 2) and'
      '      ( MiscUtils.LargeZero( -- AVAILABLE_DETAIL_TECH_QUANTITY'
      '          ModelUtils.GetMlmsRcvdForDetailTechQty('
      '            mlms.MLMS_OBJECT_BRANCH_CODE,'
      '            mlms.MLMS_OBJECT_CODE,'
      '            ( select'
      '                iv.FEATURE_FLAG_OPERATION_LOADING'
      '              from'
      '                INTERNAL_VALUES iv'
      '              where'
      '                (iv.CODE = 1)'
      '            )'
      '          )  -- IN_DETAIL_TECH_QUANTITY'
      '          -'
      
        '          ( -- izliazlo ot nashia etap za sledvashtia etap ili b' +
        'rak (OUT_DETAIL_TECH_QUANTITY)'
      '            select'
      '              Coalesce(Sum(mm.DETAIL_TECH_QUANTITY), 0)'
      '            from'
      '              MODEL_MOVEMENTS mm'
      '            where'
      
        '              (mm.FROM_MLMS_OBJECT_BRANCH_CODE = mlms.MLMS_OBJEC' +
        'T_BRANCH_CODE) and'
      
        '              (mm.FROM_MLMS_OBJECT_CODE = mlms.MLMS_OBJECT_CODE)' +
        ' and'
      '              (mm.STORNO_EMPLOYEE_CODE is null)'
      '          )'
      '        )'
      '        <='
      '        0'
      '      )'
      '    )'
      '  )'
      ''
      'order by'
      '  PRIORITY_NO,'
      '  WORK_PRIORITY_NO,'
      '  IS_LATE desc,'
      '  EFFECTIVE_TREATMENT_BEGIN_DATE,'
      '  STAGE_DEPT_NAME,'
      '  SALE_BRANCH_NO,'
      '  s.SALE_NO,'
      '  NO_AS_FORMATED_TEXT_EX,'
      '  mll.FORK_NO,'
      '  mlms.ML_MODEL_STAGE_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'IS_AUTO_RECEIVING_STAGE[mlms]'
        ParamType = ptInput
        Value = '0'
      end
      item
        DataType = ftWideString
        Name = 
          'COUNT_WORKDAYS['#13#10'    Greatest(mlms.TREATMENT_BEGIN_DATE, Context' +
          'Date)~'#13#10'    Greatest(mlms.TREATMENT_END_DATE, ContextDate)'#13#10'  ]'
        ParamType = ptInput
        Value = '0'
      end
      item
        DataType = ftWideString
        Name = 
          'PRODUCT_COMPANY_PRODUCT_NAMES[mll.DETAIL_CODE~s.CLIENT_COMPANY_C' +
          'ODE]'
        ParamType = ptInput
        Value = #39'a'#39
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[mlms]'
        ParamType = ptInput
        Value = '0'
      end>
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftWideString
        Name = 'CHOSEN_DEPTS'
        ParamType = ptInput
        Size = 4000
      end
      item
        DataType = ftWideString
        Name = 'RESULT_PRODUCT_CHOSEN_PRODUCTS'
        ParamType = ptInput
        Size = 4000
      end
      item
        DataType = ftWideString
        Name = 'DETAIL_CHOSEN_PRODUCTS'
        ParamType = ptInput
        Size = 4000
      end>
    Left = 704
    Top = 56
    object qryStageLevelTasksMLMS_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryStageLevelTasksMLMS_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryStageLevelTasksML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryStageLevelTasksIS_AUTO_MOVEMENT: TAbmesFloatField
      FieldName = 'IS_AUTO_MOVEMENT'
    end
    object qryStageLevelTasksIS_AUTO_RECEIVING_STAGE: TAbmesFloatField
      FieldName = 'IS_AUTO_RECEIVING_STAGE'
    end
    object qryStageLevelTasksTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryStageLevelTasksTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryStageLevelTasksTREATMENT_WORKDAYS: TAbmesFloatField
      FieldName = 'TREATMENT_WORKDAYS'
    end
    object qryStageLevelTasksEFFECTIVE_TREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'EFFECTIVE_TREATMENT_BEGIN_DATE'
    end
    object qryStageLevelTasksEFFECTIVE_TREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'EFFECTIVE_TREATMENT_END_DATE'
    end
    object qryStageLevelTasksEFFECTIVE_TREATMENT_WORKDAYS: TAbmesFloatField
      FieldName = 'EFFECTIVE_TREATMENT_WORKDAYS'
    end
    object qryStageLevelTasksIS_LATE: TAbmesFloatField
      FieldName = 'IS_LATE'
    end
    object qryStageLevelTasksMLL_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_BRANCH_CODE'
    end
    object qryStageLevelTasksMLL_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_CODE'
    end
    object qryStageLevelTasksNO_AS_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_TEXT'
      Size = 100
    end
    object qryStageLevelTasksNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryStageLevelTasksNO_AS_FORMATED_TEXT_EX: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT_EX'
      Size = 100
    end
    object qryStageLevelTasksFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryStageLevelTasksDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryStageLevelTasksDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryStageLevelTasksDETAIL_TECH_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'DETAIL_TECH_MEASURE_ABBREV'
      Size = 5
    end
    object qryStageLevelTasksCLIENT_DETAIL_NAME: TAbmesWideStringField
      FieldName = 'CLIENT_DETAIL_NAME'
      Size = 250
    end
    object qryStageLevelTasksLINE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'LINE_DETAIL_TECH_QUANTITY'
    end
    object qryStageLevelTasksML_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_BRANCH_CODE'
    end
    object qryStageLevelTasksML_OBJECT_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_CODE'
    end
    object qryStageLevelTasksSALE_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'SALE_OBJECT_BRANCH_CODE'
    end
    object qryStageLevelTasksSALE_OBJECT_CODE: TAbmesFloatField
      FieldName = 'SALE_OBJECT_CODE'
    end
    object qryStageLevelTasksPRODUCTION_ORDER_IDENTIFIER: TAbmesWideStringField
      FieldName = 'PRODUCTION_ORDER_IDENTIFIER'
      Size = 188
    end
    object qryStageLevelTasksSALE_BRANCH_NO: TAbmesFloatField
      FieldName = 'SALE_BRANCH_NO'
    end
    object qryStageLevelTasksIS_WASTE_COMPENSATOR: TAbmesFloatField
      FieldName = 'IS_WASTE_COMPENSATOR'
    end
    object qryStageLevelTasksPRIORITY_CODE: TAbmesFloatField
      FieldName = 'PRIORITY_CODE'
    end
    object qryStageLevelTasksPRIORITY_NO: TAbmesFloatField
      FieldName = 'PRIORITY_NO'
    end
    object qryStageLevelTasksPRIORITY_COLOR: TAbmesFloatField
      FieldName = 'PRIORITY_COLOR'
    end
    object qryStageLevelTasksPRIORITY_BACKGROUND_COLOR: TAbmesFloatField
      FieldName = 'PRIORITY_BACKGROUND_COLOR'
    end
    object qryStageLevelTasksWORK_PRIORITY_CODE: TAbmesFloatField
      FieldName = 'WORK_PRIORITY_CODE'
    end
    object qryStageLevelTasksWORK_PRIORITY_NO: TAbmesFloatField
      FieldName = 'WORK_PRIORITY_NO'
    end
    object qryStageLevelTasksSTAGE_DEPT_CODE: TAbmesFloatField
      FieldName = 'STAGE_DEPT_CODE'
    end
    object qryStageLevelTasksSTAGE_DEPT_NAME: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_NAME'
      Size = 100
    end
    object qryStageLevelTasksSTAGE_DEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'STAGE_DEPT_IDENTIFIER'
      Size = 46
    end
    object qryStageLevelTasksDOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DOC_BRANCH_CODE'
    end
    object qryStageLevelTasksDOC_CODE: TAbmesFloatField
      FieldName = 'DOC_CODE'
    end
    object qryStageLevelTasksHAS_DOCUMENTATION: TAbmesFloatField
      FieldName = 'HAS_DOCUMENTATION'
    end
    object qryStageLevelTasksDETAIL_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_BRANCH_CODE'
    end
    object qryStageLevelTasksDETAIL_DOC_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_CODE'
    end
    object qryStageLevelTasksIS_FIRST_STAGE_IN_MLL: TAbmesFloatField
      FieldName = 'IS_FIRST_STAGE_IN_MLL'
    end
    object qryStageLevelTasksIS_LAST_STAGE_IN_MLL: TAbmesFloatField
      FieldName = 'IS_LAST_STAGE_IN_MLL'
    end
    object qryStageLevelTasksMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
    end
    object qryStageLevelTasksMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
    end
    object qryStageLevelTasksOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryStageLevelTasksNEXT_OPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'NEXT_OPERATION_TYPE_CODE'
    end
    object qryStageLevelTasksWASTED_BEFORE_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'WASTED_BEFORE_TECH_QUANTITY'
    end
    object qryStageLevelTasksIN_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'IN_DETAIL_TECH_QUANTITY'
    end
    object qryStageLevelTasksOUT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OUT_DETAIL_TECH_QUANTITY'
    end
    object qryStageLevelTasksOUT_WASTE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OUT_WASTE_DETAIL_TECH_QUANTITY'
    end
    object qryStageLevelTasksIS_RECORD_CHANGED: TAbmesFloatField
      FieldName = 'IS_RECORD_CHANGED'
    end
    object qryStageLevelTasksTO_ENTER_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_ENTER_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryStageLevelTasksAVAILABLE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'AVAILABLE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryStageLevelTasksTO_LEAVE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_LEAVE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
  end
  object prvStageLevelTasks: TDataSetProvider
    DataSet = qryStageLevelTasks
    UpdateMode = upWhereKeyOnly
    Left = 704
    Top = 8
  end
  object prvStageOutput: TDataSetProvider
    DataSet = qryStageOutputWhenNotLastInMll
    UpdateMode = upWhereKeyOnly
    BeforeGetRecords = prvStageOutputBeforeGetRecords
    Left = 784
    Top = 120
  end
  object qryStageOutputWhenNotLastInMll: TAbmesSQLQuery
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlms2.MLMS_OBJECT_BRANCH_CODE,'
      '  mlms2.MLMS_OBJECT_CODE,'
      '  '
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.OPERATION_TYPE_CODE,'
      ''
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      ''
      '  mll2.DETAIL_CODE,'
      '  dprod2.NAME as DETAIL_NAME,'
      ''
      '  mlms2.ML_MODEL_STAGE_NO,'
      ''
      '  mlms2.TREATMENT_BEGIN_DATE,'
      '  mlms2.TREATMENT_END_DATE,'
      
        '  NullIf(%COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DAT' +
        'E], 0) as RESERVE_DAYS,'
      ''
      '  mlms2.DEPT_CODE,'
      ''
      '  ( select'
      '      d3.NAME'
      '    from'
      '      DEPTS d3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      ''
      '  ( select'
      
        '      (dt3.DEPT_TYPE_ABBREV || d3.CUSTOM_CODE || d3.SUFFIX_LETTE' +
        'R)'
      '    from'
      '      DEPTS d3,'
      '      DEPT_TYPES dt3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE) and'
      '      (d3.DEPT_TYPE_CODE = dt3.DEPT_TYPE_CODE(+))'
      '  ) as DEPT_IDENTIFIER'
      ''
      'from'
      '  MATERIAL_LIST_LINES mll2,'
      '  PRODUCTS dprod2,'
      '  ML_MODEL_STAGES mlms2,'
      '  MLMS_OPERATIONS mlmso2'
      ''
      'where'
      
        '  (mll2.MLL_OBJECT_BRANCH_CODE = mlms2.MLL_OBJECT_BRANCH_CODE) a' +
        'nd'
      '  (mll2.MLL_OBJECT_CODE = mlms2.MLL_OBJECT_CODE) and'
      ''
      '  (mll2.DETAIL_CODE = dprod2.PRODUCT_CODE) and'
      ''
      
        '  (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRANCH_COD' +
        'E(+)) and'
      '  (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE(+)) and'
      '  (1 = mlmso2.OPERATION_TYPE_CODE(+)) and'
      ''
      
        '  ( (mlms2.MLL_OBJECT_BRANCH_CODE, mlms2.MLL_OBJECT_CODE, mlms2.' +
        'ML_MODEL_STAGE_NO) ='
      '    ( select'
      
        '        mlms.MLL_OBJECT_BRANCH_CODE, mlms.MLL_OBJECT_CODE, (mlms' +
        '.ML_MODEL_STAGE_NO + 1)'
      '      from'
      '        ML_MODEL_STAGES mlms'
      '      where'
      
        '        (mlms.MLMS_OBJECT_BRANCH_CODE = :MLMS_OBJECT_BRANCH_CODE' +
        ') and'
      '        (mlms.MLMS_OBJECT_CODE = :MLMS_OBJECT_CODE)'
      '    )'
      '  ) and'
      ''
      '  (mlmso2.MLMS_OPERATION_VARIANT_NO >= 0)'
      ''
      'order by'
      '  mlms2.MLL_OBJECT_BRANCH_CODE,'
      '  mlms2.MLL_OBJECT_CODE,'
      '  mlms2.ML_MODEL_STAGE_NO'
      '')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DATE]'
        ParamType = ptInput
        Value = '0=0'
      end>
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftFloat
        Name = 'IS_LAST_STAGE_IN_MLL'
        ParamType = ptInput
      end>
    Left = 784
    Top = 168
    object qryStageOutputWhenNotLastInMllMLMS_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryStageOutputWhenNotLastInMllMLMS_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryStageOutputWhenNotLastInMllMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
    end
    object qryStageOutputWhenNotLastInMllMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
    end
    object qryStageOutputWhenNotLastInMllOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryStageOutputWhenNotLastInMllNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryStageOutputWhenNotLastInMllFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryStageOutputWhenNotLastInMllDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryStageOutputWhenNotLastInMllDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryStageOutputWhenNotLastInMllML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryStageOutputWhenNotLastInMllTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryStageOutputWhenNotLastInMllTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryStageOutputWhenNotLastInMllRESERVE_DAYS: TAbmesFloatField
      FieldName = 'RESERVE_DAYS'
    end
    object qryStageOutputWhenNotLastInMllDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
    object qryStageOutputWhenNotLastInMllDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryStageOutputWhenNotLastInMllDEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'DEPT_IDENTIFIER'
      Size = 46
    end
  end
  object qryStageOutputWhenLastInMll: TAbmesSQLQuery
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlms2.MLMS_OBJECT_BRANCH_CODE,'
      '  mlms2.MLMS_OBJECT_CODE,'
      ''
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.OPERATION_TYPE_CODE,'
      ''
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      ''
      '  mll2.DETAIL_CODE,'
      '  dprod2.NAME as DETAIL_NAME,'
      ''
      '  mlms2.ML_MODEL_STAGE_NO,'
      ''
      '  mlms2.TREATMENT_BEGIN_DATE,'
      '  mlms2.TREATMENT_END_DATE,'
      
        '  NullIf(%COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DAT' +
        'E], 0) as RESERVE_DAYS,'
      ''
      '  mlms2.DEPT_CODE,'
      '  '
      '  ( select'
      '      d3.NAME'
      '    from'
      '      DEPTS d3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      ''
      '  ( select'
      
        '      (dt3.DEPT_TYPE_ABBREV || d3.CUSTOM_CODE || d3.SUFFIX_LETTE' +
        'R)'
      '    from'
      '      DEPTS d3,'
      '      DEPT_TYPES dt3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE) and'
      '      (d3.DEPT_TYPE_CODE = dt3.DEPT_TYPE_CODE(+))'
      '  ) as DEPT_IDENTIFIER'
      ''
      'from'
      '  MATERIAL_LIST_LINES mll2,'
      '  PRODUCTS dprod2,'
      '  ML_MODEL_STAGES mlms2,'
      '  MLMS_OPERATIONS mlmso2'
      ''
      'where'
      
        '  (mll2.MLL_OBJECT_BRANCH_CODE = mlms2.MLL_OBJECT_BRANCH_CODE) a' +
        'nd'
      '  (mll2.MLL_OBJECT_CODE = mlms2.MLL_OBJECT_CODE) and'
      ''
      '  (mll2.DETAIL_CODE = dprod2.PRODUCT_CODE) and'
      ''
      
        '  (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRANCH_COD' +
        'E(+)) and'
      '  (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE(+)) and'
      '  (1 = mlmso2.OPERATION_TYPE_CODE(+)) and'
      ''
      '  (mlms2.ML_MODEL_STAGE_NO = 1) and'
      ''
      '  ( (mll2.MLL_OBJECT_BRANCH_CODE, mll2.MLL_OBJECT_CODE) ='
      '    ( select'
      
        '        mll.PARENT_MLL_OBJECT_BRANCH_CODE, mll.PARENT_MLL_OBJECT' +
        '_CODE'
      '      from'
      '        MATERIAL_LIST_LINES mll'
      '      where'
      '        ( (mll.MLL_OBJECT_BRANCH_CODE, mll.MLL_OBJECT_CODE) ='
      '          ( select'
      '              mlms.MLL_OBJECT_BRANCH_CODE, mlms.MLL_OBJECT_CODE'
      '            from'
      '              ML_MODEL_STAGES mlms'
      '            where'
      
        '              (mlms.MLMS_OBJECT_BRANCH_CODE = :MLMS_OBJECT_BRANC' +
        'H_CODE) and'
      '              (mlms.MLMS_OBJECT_CODE = :MLMS_OBJECT_CODE)'
      '          )'
      '        )'
      '    )'
      '  ) and'
      ''
      '  (mlmso2.MLMS_OPERATION_VARIANT_NO >= 0)'
      ''
      'order by'
      '  mlms2.MLL_OBJECT_BRANCH_CODE,'
      '  mlms2.MLL_OBJECT_CODE,'
      '  mlms2.ML_MODEL_STAGE_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DATE]'
        ParamType = ptInput
        Value = '0=0'
      end>
    MacroParams = <>
    CustomParams = <>
    Left = 784
    Top = 216
    object qryStageOutputWhenLastInMllMLMS_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryStageOutputWhenLastInMllMLMS_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryStageOutputWhenLastInMllMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
    end
    object qryStageOutputWhenLastInMllMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
    end
    object qryStageOutputWhenLastInMllOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryStageOutputWhenLastInMllNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryStageOutputWhenLastInMllFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryStageOutputWhenLastInMllDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryStageOutputWhenLastInMllDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryStageOutputWhenLastInMllML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryStageOutputWhenLastInMllTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryStageOutputWhenLastInMllTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryStageOutputWhenLastInMllRESERVE_DAYS: TAbmesFloatField
      FieldName = 'RESERVE_DAYS'
    end
    object qryStageOutputWhenLastInMllDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
    object qryStageOutputWhenLastInMllDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryStageOutputWhenLastInMllDEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'DEPT_IDENTIFIER'
      Size = 46
    end
  end
  object prvStageInput: TDataSetProvider
    DataSet = qryStageInputWhenNotFirstInMll
    UpdateMode = upWhereKeyOnly
    BeforeGetRecords = prvStageInputBeforeGetRecords
    Left = 624
    Top = 120
  end
  object qryStageInputWhenNotFirstInMll: TAbmesSQLQuery
    OnCalcFields = qryStageInputWhenNotFirstInMllCalcFields
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlms2.MLMS_OBJECT_BRANCH_CODE,'
      '  mlms2.MLMS_OBJECT_CODE,'
      ''
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.OPERATION_TYPE_CODE,'
      ''
      '  ( select'
      '      ot.OPERATION_TYPE_ABBREV'
      '    from'
      '      OPERATION_TYPES ot'
      '    where'
      '      (ot.OPERATION_TYPE_CODE = mlmso2.OPERATION_TYPE_CODE)'
      '  ) as OPERATION_TYPE_ABBREV,'
      ''
      '  mll2.ML_OBJECT_BRANCH_CODE,'
      '  mll2.ML_OBJECT_CODE,'
      '  mll2.MLL_OBJECT_BRANCH_CODE,'
      '  mll2.MLL_OBJECT_CODE,'
      ''
      '  mlms2.ML_MODEL_STAGE_NO,'
      ''
      '  mlms2.TREATMENT_BEGIN_DATE,'
      '  mlms2.TREATMENT_END_DATE,'
      
        '  NullIf(%COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DAT' +
        'E], 0) as RESERVE_DAYS,'
      '  '
      '  mlms2.IS_AUTO_MOVEMENT,'
      ''
      '  mlms2.DEPT_CODE,'
      '  '
      '  ( select'
      '      d3.NAME'
      '    from'
      '      DEPTS d3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      '  '
      '  ( select'
      
        '      (dt3.DEPT_TYPE_ABBREV || d3.CUSTOM_CODE || d3.SUFFIX_LETTE' +
        'R)'
      '    from'
      '      DEPTS d3,'
      '      DEPT_TYPES dt3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE) and'
      '      (d3.DEPT_TYPE_CODE = dt3.DEPT_TYPE_CODE(+))'
      '  ) as DEPT_IDENTIFIER,'
      ''
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      ''
      '  mll2.DETAIL_CODE,'
      ''
      '  dprod2.NAME as DETAIL_NAME,'
      ''
      '  dprod2.DOC_BRANCH_CODE as DETAIL_DOC_BRANCH_CODE,'
      '  dprod2.DOC_CODE as DETAIL_DOC_CODE,'
      '  %HAS_DOC_ITEMS[dprod2] as DETAIL_HAS_DOC,'
      ''
      '  ( select'
      '      m.MEASURE_ABBREV'
      '    from'
      '      MEASURES m'
      '    where'
      '      (dprod2.TECH_MEASURE_CODE = m.MEASURE_CODE)'
      '  ) as DETAIL_TECH_MEASURE_ABBREV,'
      ''
      '  ( select'
      
        '      %PRODUCT_COMPANY_PRODUCT_NAMES[mll2.DETAIL_CODE~s2.CLIENT_' +
        'COMPANY_CODE]'
      '    from'
      '      SALES s2'
      '    where'
      '      ( (s2.SALE_OBJECT_BRANCH_CODE, s2.SALE_OBJECT_CODE) ='
      '        ( select'
      
        '            ml2.BND_PROCESS_OBJECT_BRANCH_CODE, ml2.BND_PROCESS_' +
        'OBJECT_CODE'
      '          from'
      '            MATERIAL_LISTS ml2'
      '          where'
      
        '            (ml2.ML_OBJECT_BRANCH_CODE = mll2.ML_OBJECT_BRANCH_C' +
        'ODE) and'
      '            (ml2.ML_OBJECT_CODE = mll2.ML_OBJECT_CODE)'
      '        )'
      '      )'
      '  ) as CLIENT_DETAIL_NAME,'
      ''
      '  mlms2.DOC_BRANCH_CODE,'
      '  mlms2.DOC_CODE,'
      ''
      '  %HAS_DOC_ITEMS[mlms2] as HAS_DOCUMENTATION,'
      ''
      '  mll2.LINE_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      '    Decode('
      '      mlms2.ML_MODEL_STAGE_NO,'
      '      0,'
      '      ( select'
      
        '          Coalesce((Sum(asd.REAL_QUANTITY) keep (dense_rank last' +
        ' order by asd.STORE_DEAL_DATE) * mprod2.TECH_MEASURE_COEF / mll2' +
        '.PRODUCT_TECH_QUANTITY), 0)'
      '        from'
      '          AGGR_STORE_DEALS asd'
      '        where'
      '          (asd.PRODUCT_CODE = mll2.PRODUCT_CODE) and'
      '          (asd.STORE_CODE = mlms2.DEPT_CODE) and'
      '          (asd.STORE_DEAL_DATE <= ContextDate)'
      '      ),'
      '      0'
      '    )'
      '  ) as STORE_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      '    ( select -- brak po predhodinte etapi ot toia red'
      '        Coalesce(Sum(mm3.DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        ML_MODEL_STAGES mlms3,'
      '        MODEL_MOVEMENTS mm3'
      '      where'
      
        '        (mlms3.MLL_OBJECT_BRANCH_CODE = mll2.MLL_OBJECT_BRANCH_C' +
        'ODE) and'
      '        (mlms3.MLL_OBJECT_CODE = mll2.MLL_OBJECT_CODE) and'
      ''
      
        '        (mm3.FROM_MLMS_OBJECT_BRANCH_CODE = mlms3.MLMS_OBJECT_BR' +
        'ANCH_CODE) and'
      '        (mm3.FROM_MLMS_OBJECT_CODE = mlms3.MLMS_OBJECT_CODE) and'
      ''
      '        (mm3.STORNO_EMPLOYEE_CODE is null) and'
      '        (mm3.TO_DEPT_CODE is not null) and'
      ''
      '        (mlms3.ML_MODEL_STAGE_NO < mlms2.ML_MODEL_STAGE_NO)'
      '    )'
      '  ) as WASTED_BEFORE_TECH_QUANTITY,'
      ''
      '  ModelUtils.GetMlmsRcvdForDetailTechQty('
      '    mlms2.MLMS_OBJECT_BRANCH_CODE,'
      '    mlms2.MLMS_OBJECT_CODE,'
      '    ( select'
      '        iv.FEATURE_FLAG_OPERATION_LOADING'
      '      from'
      '        INTERNAL_VALUES iv'
      '      where'
      '        (iv.CODE = 1)'
      '    )'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      
        '    ( select -- izliazlo ot nashia etap za sledvashtia etap ili ' +
        'brak'
      '        Coalesce(Sum(mm2.DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        MODEL_MOVEMENTS mm2'
      '      where'
      
        '        (mm2.FROM_MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_OBJECT_BR' +
        'ANCH_CODE) and'
      '        (mm2.FROM_MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_CODE) and'
      '        (mm2.STORNO_EMPLOYEE_CODE is null)'
      '    )'
      '  ) as OUT_DETAIL_TECH_QUANTITY,'
      ''
      '  ( select'
      
        '      Coalesce(Max(CapacityUtils.HasMlmsoPlanExcess(mlmso4.MLMSO' +
        '_OBJECT_BRANCH_CODE, mlmso4.MLMSO_OBJECT_CODE)), 0)'
      '    from'
      '      MLMS_OPERATIONS mlmso4'
      '    where'
      
        '      (mlmso4.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_OBJECT_BRANCH' +
        '_CODE) and'
      '      (mlmso4.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_CODE) and'
      '      (mlmso4.OPERATION_TYPE_CODE = 2)'
      '  ) as HAS_CAPACITY_DEFICIT'
      ''
      'from'
      '  MATERIAL_LIST_LINES mll2,'
      '  ML_MODEL_STAGES mlms2,'
      '  PRODUCTS dprod2,'
      '  PRODUCTS mprod2,'
      '  MLMS_OPERATIONS mlmso2'
      ''
      'where'
      
        '  (mll2.MLL_OBJECT_BRANCH_CODE = mlms2.MLL_OBJECT_BRANCH_CODE) a' +
        'nd'
      '  (mll2.MLL_OBJECT_CODE = mlms2.MLL_OBJECT_CODE) and'
      ''
      
        '  (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRANCH_COD' +
        'E) and'
      '  (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      ''
      '  (mll2.DETAIL_CODE = dprod2.PRODUCT_CODE) and'
      ''
      '  (mll2.PRODUCT_CODE = mprod2.PRODUCT_CODE(+)) and'
      ''
      '  (mll2.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      
        '  ( (mlms2.MLL_OBJECT_BRANCH_CODE, mlms2.MLL_OBJECT_CODE, mlms2.' +
        'ML_MODEL_STAGE_NO) ='
      '    ( select'
      
        '        mlms.MLL_OBJECT_BRANCH_CODE, mlms.MLL_OBJECT_CODE, (mlms' +
        '.ML_MODEL_STAGE_NO - 1)'
      '      from'
      '        ML_MODEL_STAGES mlms'
      '      where'
      
        '        (mlms.MLMS_OBJECT_BRANCH_CODE = :MLMS_OBJECT_BRANCH_CODE' +
        ') and'
      '        (mlms.MLMS_OBJECT_CODE = :MLMS_OBJECT_CODE)'
      '    )'
      '  ) and'
      ''
      '  (mlmso2.MLMS_OPERATION_VARIANT_NO = 0) and'
      '  (not exists'
      '    ( select'
      '        1'
      '      from'
      '        MLMS_OPERATIONS mlmso3'
      '      where'
      
        '        (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRA' +
        'NCH_CODE) and'
      '        (mlmso3.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      '        (mlmso3.MLMS_OPERATION_NO > mlmso2.MLMS_OPERATION_NO)'
      '    )'
      '  )'
      ''
      'order by'
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      '  mlms2.ML_MODEL_STAGE_NO')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DATE]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[dprod2]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 
          'PRODUCT_COMPANY_PRODUCT_NAMES[mll2.DETAIL_CODE~s2.CLIENT_COMPANY' +
          '_CODE]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[mlms2]'
        ParamType = ptInput
        Value = '0=0'
      end>
    DefaultOrder.Fields = 'NO_AS_FORMATED_TEXT;FORK_NO;ML_MODEL_STAGE_NO'
    MacroParams = <>
    CustomParams = <
      item
        DataType = ftFloat
        Name = 'IS_FIRST_STAGE_IN_MLL'
        ParamType = ptInput
      end>
    Left = 624
    Top = 168
    object qryStageInputWhenNotFirstInMllMLMS_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryStageInputWhenNotFirstInMllMLMS_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryStageInputWhenNotFirstInMllMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
    end
    object qryStageInputWhenNotFirstInMllMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
    end
    object qryStageInputWhenNotFirstInMllOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryStageInputWhenNotFirstInMllOPERATION_TYPE_ABBREV: TAbmesWideStringField
      FieldName = 'OPERATION_TYPE_ABBREV'
      Size = 100
    end
    object qryStageInputWhenNotFirstInMllML_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_BRANCH_CODE'
    end
    object qryStageInputWhenNotFirstInMllML_OBJECT_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_CODE'
    end
    object qryStageInputWhenNotFirstInMllMLL_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_BRANCH_CODE'
    end
    object qryStageInputWhenNotFirstInMllMLL_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_CODE'
    end
    object qryStageInputWhenNotFirstInMllML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryStageInputWhenNotFirstInMllTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryStageInputWhenNotFirstInMllTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryStageInputWhenNotFirstInMllRESERVE_DAYS: TAbmesFloatField
      FieldName = 'RESERVE_DAYS'
    end
    object qryStageInputWhenNotFirstInMllIS_AUTO_MOVEMENT: TAbmesFloatField
      FieldName = 'IS_AUTO_MOVEMENT'
    end
    object qryStageInputWhenNotFirstInMllDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
    object qryStageInputWhenNotFirstInMllDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryStageInputWhenNotFirstInMllDEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'DEPT_IDENTIFIER'
      Size = 46
    end
    object qryStageInputWhenNotFirstInMllNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryStageInputWhenNotFirstInMllFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryStageInputWhenNotFirstInMllDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryStageInputWhenNotFirstInMllDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryStageInputWhenNotFirstInMllDETAIL_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_BRANCH_CODE'
    end
    object qryStageInputWhenNotFirstInMllDETAIL_DOC_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_CODE'
    end
    object qryStageInputWhenNotFirstInMllDETAIL_HAS_DOC: TAbmesFloatField
      FieldName = 'DETAIL_HAS_DOC'
    end
    object qryStageInputWhenNotFirstInMllDETAIL_TECH_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'DETAIL_TECH_MEASURE_ABBREV'
      Size = 5
    end
    object qryStageInputWhenNotFirstInMllCLIENT_DETAIL_NAME: TAbmesWideStringField
      FieldName = 'CLIENT_DETAIL_NAME'
      Size = 250
    end
    object qryStageInputWhenNotFirstInMllDOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DOC_BRANCH_CODE'
    end
    object qryStageInputWhenNotFirstInMllDOC_CODE: TAbmesFloatField
      FieldName = 'DOC_CODE'
    end
    object qryStageInputWhenNotFirstInMllHAS_DOCUMENTATION: TAbmesFloatField
      FieldName = 'HAS_DOCUMENTATION'
    end
    object qryStageInputWhenNotFirstInMllLINE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'LINE_DETAIL_TECH_QUANTITY'
    end
    object qryStageInputWhenNotFirstInMllSTORE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'STORE_DETAIL_TECH_QUANTITY'
    end
    object qryStageInputWhenNotFirstInMllWASTED_BEFORE_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'WASTED_BEFORE_TECH_QUANTITY'
    end
    object qryStageInputWhenNotFirstInMllIN_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'IN_DETAIL_TECH_QUANTITY'
    end
    object qryStageInputWhenNotFirstInMllOUT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OUT_DETAIL_TECH_QUANTITY'
    end
    object qryStageInputWhenNotFirstInMllHAS_CAPACITY_DEFICIT: TAbmesFloatField
      FieldName = 'HAS_CAPACITY_DEFICIT'
    end
    object qryStageInputWhenNotFirstInMllAVAILABLE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'AVAILABLE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryStageInputWhenNotFirstInMllTO_LEAVE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_LEAVE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
  end
  object qryStageInputWhenFirstInMll: TAbmesSQLQuery
    OnCalcFields = qryStageInputWhenFirstInMllCalcFields
    MaxBlobSize = -1
    Params = <
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_BRANCH_CODE'
        ParamType = ptInput
      end
      item
        DataType = ftFloat
        Name = 'MLMS_OBJECT_CODE'
        ParamType = ptInput
      end>
    SQL.Strings = (
      'select'
      '  mlms2.MLMS_OBJECT_BRANCH_CODE,'
      '  mlms2.MLMS_OBJECT_CODE,'
      ''
      '  mlmso2.MLMSO_OBJECT_BRANCH_CODE,'
      '  mlmso2.MLMSO_OBJECT_CODE,'
      '  mlmso2.OPERATION_TYPE_CODE,'
      ''
      '  ( select'
      '      ot.OPERATION_TYPE_ABBREV'
      '    from'
      '      OPERATION_TYPES ot'
      '    where'
      '      (ot.OPERATION_TYPE_CODE = mlmso2.OPERATION_TYPE_CODE)'
      '  ) as OPERATION_TYPE_ABBREV,'
      ''
      '  mll2.ML_OBJECT_BRANCH_CODE,'
      '  mll2.ML_OBJECT_CODE,'
      '  mll2.MLL_OBJECT_BRANCH_CODE,'
      '  mll2.MLL_OBJECT_CODE,'
      ''
      '  mlms2.ML_MODEL_STAGE_NO,'
      ''
      '  mlms2.TREATMENT_BEGIN_DATE,'
      '  mlms2.TREATMENT_END_DATE,'
      
        '  NullIf(%COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DAT' +
        'E], 0) as RESERVE_DAYS,'
      ''
      '  mlms2.IS_AUTO_MOVEMENT,'
      ''
      '  mlms2.DEPT_CODE,'
      ''
      '  ( select'
      '      d3.NAME'
      '    from'
      '      DEPTS d3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE)'
      '  ) as DEPT_NAME,'
      ''
      '  ( select'
      
        '      (dt3.DEPT_TYPE_ABBREV || d3.CUSTOM_CODE || d3.SUFFIX_LETTE' +
        'R)'
      '    from'
      '      DEPTS d3,'
      '      DEPT_TYPES dt3'
      '    where'
      '      (d3.DEPT_CODE = mlms2.DEPT_CODE) and'
      '      (d3.DEPT_TYPE_CODE = dt3.DEPT_TYPE_CODE(+))'
      '  ) as DEPT_IDENTIFIER,'
      ''
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      ''
      '  mll2.DETAIL_CODE,'
      ''
      '  dprod2.NAME as DETAIL_NAME,'
      ''
      '  dprod2.DOC_BRANCH_CODE as DETAIL_DOC_BRANCH_CODE,'
      '  dprod2.DOC_CODE as DETAIL_DOC_CODE,'
      '  %HAS_DOC_ITEMS[dprod2] as DETAIL_HAS_DOC,'
      ''
      '  ( select'
      '      m.MEASURE_ABBREV'
      '    from'
      '      MEASURES m'
      '    where'
      '      (dprod2.TECH_MEASURE_CODE = m.MEASURE_CODE)'
      '  ) as DETAIL_TECH_MEASURE_ABBREV,'
      ''
      '  ( select'
      
        '      %PRODUCT_COMPANY_PRODUCT_NAMES[mll2.DETAIL_CODE~s2.CLIENT_' +
        'COMPANY_CODE]'
      '    from'
      '      SALES s2'
      '    where'
      '      ( (s2.SALE_OBJECT_BRANCH_CODE, s2.SALE_OBJECT_CODE) ='
      '        ( select'
      
        '            ml2.BND_PROCESS_OBJECT_BRANCH_CODE, ml2.BND_PROCESS_' +
        'OBJECT_CODE'
      '          from'
      '            MATERIAL_LISTS ml2'
      '          where'
      
        '            (ml2.ML_OBJECT_BRANCH_CODE = mll2.ML_OBJECT_BRANCH_C' +
        'ODE) and'
      '            (ml2.ML_OBJECT_CODE = mll2.ML_OBJECT_CODE)'
      '        )'
      '      )'
      '  ) as CLIENT_DETAIL_NAME,'
      ''
      '  mlms2.DOC_BRANCH_CODE,'
      '  mlms2.DOC_CODE,'
      ''
      '  %HAS_DOC_ITEMS[mlms2] as HAS_DOCUMENTATION,'
      ''
      '  mll2.LINE_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      '    Decode('
      '      mlms2.ML_MODEL_STAGE_NO,'
      '      0,'
      '      ( select'
      
        '          Coalesce((Sum(asd.REAL_QUANTITY) keep (dense_rank last' +
        ' order by asd.STORE_DEAL_DATE) * mprod2.TECH_MEASURE_COEF / mll2' +
        '.PRODUCT_TECH_QUANTITY), 0)'
      '        from'
      '          AGGR_STORE_DEALS asd'
      '        where'
      '          (asd.PRODUCT_CODE = mll2.PRODUCT_CODE) and'
      '          (asd.STORE_CODE = mlms2.DEPT_CODE) and'
      '          (asd.STORE_DEAL_DATE <= ContextDate)'
      '      ),'
      '      0'
      '    )'
      '  ) as STORE_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      '    ( select -- brak po predhodinte etapi ot toia red'
      '        Coalesce(Sum(mm3.DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        ML_MODEL_STAGES mlms3,'
      '        MODEL_MOVEMENTS mm3'
      '      where'
      
        '        (mlms3.MLL_OBJECT_BRANCH_CODE = mll2.MLL_OBJECT_BRANCH_C' +
        'ODE) and'
      '        (mlms3.MLL_OBJECT_CODE = mll2.MLL_OBJECT_CODE) and'
      ''
      
        '        (mm3.FROM_MLMS_OBJECT_BRANCH_CODE = mlms3.MLMS_OBJECT_BR' +
        'ANCH_CODE) and'
      '        (mm3.FROM_MLMS_OBJECT_CODE = mlms3.MLMS_OBJECT_CODE) and'
      ''
      '        (mm3.STORNO_EMPLOYEE_CODE is null) and'
      '        (mm3.TO_DEPT_CODE is not null) and'
      ''
      '        (mlms3.ML_MODEL_STAGE_NO < mlms2.ML_MODEL_STAGE_NO)'
      '    )'
      '  ) as WASTED_BEFORE_TECH_QUANTITY,'
      ''
      '  ModelUtils.GetMlmsRcvdForDetailTechQty('
      '    mlms2.MLMS_OBJECT_BRANCH_CODE,'
      '    mlms2.MLMS_OBJECT_CODE,'
      '    ( select'
      '        iv.FEATURE_FLAG_OPERATION_LOADING'
      '      from'
      '        INTERNAL_VALUES iv'
      '      where'
      '        (iv.CODE = 1)'
      '    )'
      '  ) as IN_DETAIL_TECH_QUANTITY,'
      ''
      '  MiscUtils.LargeZero('
      
        '    ( select -- izliazlo ot nashia etap za sledvashtia etap ili ' +
        'brak'
      '        Coalesce(Sum(mm2.DETAIL_TECH_QUANTITY), 0)'
      '      from'
      '        MODEL_MOVEMENTS mm2'
      '      where'
      
        '        (mm2.FROM_MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_OBJECT_BR' +
        'ANCH_CODE) and'
      '        (mm2.FROM_MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_CODE) and'
      '        (mm2.STORNO_EMPLOYEE_CODE is null)'
      '    )'
      '  ) as OUT_DETAIL_TECH_QUANTITY,'
      ''
      '  ( select'
      
        '      Coalesce(Max(CapacityUtils.HasMlmsoPlanExcess(mlmso4.MLMSO' +
        '_OBJECT_BRANCH_CODE, mlmso4.MLMSO_OBJECT_CODE)), 0)'
      '    from'
      '      MLMS_OPERATIONS mlmso4'
      '    where'
      
        '      (mlmso4.MLMS_OBJECT_BRANCH_CODE = mlms2.MLMS_OBJECT_BRANCH' +
        '_CODE) and'
      '      (mlmso4.MLMS_OBJECT_CODE = mlms2.MLMS_OBJECT_CODE) and'
      '      (mlmso4.OPERATION_TYPE_CODE = 2)'
      '  ) as HAS_CAPACITY_DEFICIT'
      ''
      'from'
      '  ML_MODEL_STAGES mlms2,'
      '  MATERIAL_LIST_LINES mll2,'
      '  PRODUCTS dprod2,'
      '  PRODUCTS mprod2,'
      '  MLMS_OPERATIONS mlmso2'
      ''
      'where'
      
        '  (mlms2.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRANCH_COD' +
        'E) and'
      '  (mlms2.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      ''
      
        '  (mll2.MLL_OBJECT_BRANCH_CODE = mlms2.MLL_OBJECT_BRANCH_CODE) a' +
        'nd'
      '  (mll2.MLL_OBJECT_CODE = mlms2.MLL_OBJECT_CODE) and'
      ''
      '  (mll2.DETAIL_CODE = dprod2.PRODUCT_CODE) and'
      ''
      '  (mll2.PRODUCT_CODE = mprod2.PRODUCT_CODE(+)) and'
      ''
      '  (mll2.ANNUL_EMPLOYEE_CODE is null) and'
      ''
      
        '  ( (mll2.PARENT_MLL_OBJECT_BRANCH_CODE, mll2.PARENT_MLL_OBJECT_' +
        'CODE) ='
      '    ( select'
      '        mlms.MLL_OBJECT_BRANCH_CODE, mlms.MLL_OBJECT_CODE'
      '      from'
      '        ML_MODEL_STAGES mlms'
      '      where'
      
        '        (mlms.MLMS_OBJECT_BRANCH_CODE = :MLMS_OBJECT_BRANCH_CODE' +
        ') and'
      '        (mlms.MLMS_OBJECT_CODE = :MLMS_OBJECT_CODE)'
      '    )'
      '  ) and'
      ''
      '  (mlms2.OUTGOING_WORKDAYS > 0) and'
      '  (not exists'
      '    ( select'
      '        1'
      '      from'
      '        ML_MODEL_STAGES mlms3'
      '      where'
      
        '        (mlms3.MLL_OBJECT_BRANCH_CODE = mlms2.MLL_OBJECT_BRANCH_' +
        'CODE) and'
      '        (mlms3.MLL_OBJECT_CODE = mlms2.MLL_OBJECT_CODE) and'
      '        (mlms3.ML_MODEL_STAGE_NO > mlms2.ML_MODEL_STAGE_NO) and'
      '        (mlms3.OUTGOING_WORKDAYS > 0)'
      '    )'
      '  ) and'
      ''
      '  (mlmso2.MLMS_OPERATION_VARIANT_NO = 0) and'
      '  (not exists'
      '    ( select'
      '        1'
      '      from'
      '        MLMS_OPERATIONS mlmso3'
      '      where'
      
        '        (mlmso3.MLMS_OBJECT_BRANCH_CODE = mlmso2.MLMS_OBJECT_BRA' +
        'NCH_CODE) and'
      '        (mlmso3.MLMS_OBJECT_CODE = mlmso2.MLMS_OBJECT_CODE) and'
      '        (mlmso3.MLMS_OPERATION_NO > mlmso2.MLMS_OPERATION_NO)'
      '    )'
      '  )'
      ''
      'order by'
      '  mll2.NO_AS_FORMATED_TEXT,'
      '  mll2.FORK_NO,'
      '  mlms2.ML_MODEL_STAGE_NO'
      '')
    SQLConnection = SQLConn
    Macros = <
      item
        DataType = ftWideString
        Name = 'COUNT_WORKDAYS[ContextDate~ mlmso2.TREATMENT_BEGIN_DATE]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[dprod2]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 
          'PRODUCT_COMPANY_PRODUCT_NAMES[mll2.DETAIL_CODE~s2.CLIENT_COMPANY' +
          '_CODE]'
        ParamType = ptInput
        Value = '0=0'
      end
      item
        DataType = ftWideString
        Name = 'HAS_DOC_ITEMS[mlms2]'
        ParamType = ptInput
        Value = '0=0'
      end>
    DefaultOrder.Fields = 'NO_AS_FORMATED_TEXT;FORK_NO;ML_MODEL_STAGE_NO'
    MacroParams = <>
    CustomParams = <>
    Left = 624
    Top = 216
    object qryStageInputWhenFirstInMllMLMS_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_BRANCH_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryStageInputWhenFirstInMllMLMS_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMS_OBJECT_CODE'
      ProviderFlags = [pfInUpdate, pfInWhere, pfInKey]
    end
    object qryStageInputWhenFirstInMllMLMSO_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_BRANCH_CODE'
    end
    object qryStageInputWhenFirstInMllMLMSO_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLMSO_OBJECT_CODE'
    end
    object qryStageInputWhenFirstInMllOPERATION_TYPE_CODE: TAbmesFloatField
      FieldName = 'OPERATION_TYPE_CODE'
    end
    object qryStageInputWhenFirstInMllOPERATION_TYPE_ABBREV: TAbmesWideStringField
      FieldName = 'OPERATION_TYPE_ABBREV'
      Size = 100
    end
    object qryStageInputWhenFirstInMllML_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_BRANCH_CODE'
    end
    object qryStageInputWhenFirstInMllML_OBJECT_CODE: TAbmesFloatField
      FieldName = 'ML_OBJECT_CODE'
    end
    object qryStageInputWhenFirstInMllMLL_OBJECT_BRANCH_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_BRANCH_CODE'
    end
    object qryStageInputWhenFirstInMllMLL_OBJECT_CODE: TAbmesFloatField
      FieldName = 'MLL_OBJECT_CODE'
    end
    object qryStageInputWhenFirstInMllML_MODEL_STAGE_NO: TAbmesFloatField
      FieldName = 'ML_MODEL_STAGE_NO'
    end
    object qryStageInputWhenFirstInMllTREATMENT_BEGIN_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_BEGIN_DATE'
    end
    object qryStageInputWhenFirstInMllTREATMENT_END_DATE: TAbmesSQLTimeStampField
      FieldName = 'TREATMENT_END_DATE'
    end
    object qryStageInputWhenFirstInMllRESERVE_DAYS: TAbmesFloatField
      FieldName = 'RESERVE_DAYS'
    end
    object qryStageInputWhenFirstInMllIS_AUTO_MOVEMENT: TAbmesFloatField
      FieldName = 'IS_AUTO_MOVEMENT'
    end
    object qryStageInputWhenFirstInMllDEPT_CODE: TAbmesFloatField
      FieldName = 'DEPT_CODE'
    end
    object qryStageInputWhenFirstInMllDEPT_NAME: TAbmesWideStringField
      FieldName = 'DEPT_NAME'
      Size = 100
    end
    object qryStageInputWhenFirstInMllDEPT_IDENTIFIER: TAbmesWideStringField
      FieldName = 'DEPT_IDENTIFIER'
      Size = 46
    end
    object qryStageInputWhenFirstInMllNO_AS_FORMATED_TEXT: TAbmesWideStringField
      FieldName = 'NO_AS_FORMATED_TEXT'
      Size = 100
    end
    object qryStageInputWhenFirstInMllFORK_NO: TAbmesFloatField
      FieldName = 'FORK_NO'
    end
    object qryStageInputWhenFirstInMllDETAIL_CODE: TAbmesFloatField
      FieldName = 'DETAIL_CODE'
    end
    object qryStageInputWhenFirstInMllDETAIL_NAME: TAbmesWideStringField
      FieldName = 'DETAIL_NAME'
      Size = 100
    end
    object qryStageInputWhenFirstInMllDETAIL_DOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_BRANCH_CODE'
    end
    object qryStageInputWhenFirstInMllDETAIL_DOC_CODE: TAbmesFloatField
      FieldName = 'DETAIL_DOC_CODE'
    end
    object qryStageInputWhenFirstInMllDETAIL_HAS_DOC: TAbmesFloatField
      FieldName = 'DETAIL_HAS_DOC'
    end
    object qryStageInputWhenFirstInMllDETAIL_TECH_MEASURE_ABBREV: TAbmesWideStringField
      FieldName = 'DETAIL_TECH_MEASURE_ABBREV'
      Size = 5
    end
    object qryStageInputWhenFirstInMllCLIENT_DETAIL_NAME: TAbmesWideStringField
      FieldName = 'CLIENT_DETAIL_NAME'
      Size = 250
    end
    object qryStageInputWhenFirstInMllDOC_BRANCH_CODE: TAbmesFloatField
      FieldName = 'DOC_BRANCH_CODE'
    end
    object qryStageInputWhenFirstInMllDOC_CODE: TAbmesFloatField
      FieldName = 'DOC_CODE'
    end
    object qryStageInputWhenFirstInMllHAS_DOCUMENTATION: TAbmesFloatField
      FieldName = 'HAS_DOCUMENTATION'
    end
    object qryStageInputWhenFirstInMllLINE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'LINE_DETAIL_TECH_QUANTITY'
    end
    object qryStageInputWhenFirstInMllSTORE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'STORE_DETAIL_TECH_QUANTITY'
    end
    object qryStageInputWhenFirstInMllWASTED_BEFORE_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'WASTED_BEFORE_TECH_QUANTITY'
    end
    object qryStageInputWhenFirstInMllIN_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'IN_DETAIL_TECH_QUANTITY'
    end
    object qryStageInputWhenFirstInMllOUT_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldName = 'OUT_DETAIL_TECH_QUANTITY'
    end
    object qryStageInputWhenFirstInMllHAS_CAPACITY_DEFICIT: TAbmesFloatField
      FieldName = 'HAS_CAPACITY_DEFICIT'
    end
    object qryStageInputWhenFirstInMllAVAILABLE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'AVAILABLE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
    object qryStageInputWhenFirstInMllTO_LEAVE_DETAIL_TECH_QUANTITY: TAbmesFloatField
      FieldKind = fkCalculated
      FieldName = 'TO_LEAVE_DETAIL_TECH_QUANTITY'
      Calculated = True
    end
  end
  object shUnarchivedModelCondition: TJvStrHolder
    Capacity = 4
    Macros = <>
    Left = 112
    Top = 160
    InternalVer = 2
    StrData = (
      ''
      '2020286d6c2e49535f4152434849564544203d20302920616e64'
      
        '2020286d6c2e414e4e554c5f454d504c4f5945455f434f4445206973206e756c' +
        '6c29')
  end
  object mshLocalMacroLibrary: TJvMultiStringHolder
    MultipleStrings = <
      item
        Name = 'IS_AUTO_RECEIVING_STAGE'
        Strings.Strings = (
          'Coalesce('
          '  ('
          '    select'
          '      library_prev_mlms.IS_AUTO_MOVEMENT'
          '    from'
          '      ML_MODEL_STAGES library_prev_mlms'
          '    where'
          
            '      (library_prev_mlms.MLL_OBJECT_BRANCH_CODE = %1.MLL_OBJECT_' +
            'BRANCH_CODE) and'
          
            '      (library_prev_mlms.MLL_OBJECT_CODE = %1.MLL_OBJECT_CODE) a' +
            'nd'
          
            '      (library_prev_mlms.ML_MODEL_STAGE_NO = %1.ML_MODEL_STAGE_N' +
            'O - 1)'
          '  ),'
          '  ('
          '    select'
          '      Max(library_prev_mlms.IS_AUTO_MOVEMENT)'
          '    from'
          '      MATERIAL_LIST_LINES library_mll,'
          '      ML_MODEL_STAGES library_prev_mlms'
          '    where'
          
            '      (library_mll.PARENT_MLL_OBJECT_BRANCH_CODE = %1.MLL_OBJECT' +
            '_BRANCH_CODE) and'
          
            '      (library_mll.PARENT_MLL_OBJECT_CODE = %1.MLL_OBJECT_CODE) ' +
            'and'
          ''
          
            '      (library_prev_mlms.MLL_OBJECT_BRANCH_CODE = library_mll.ML' +
            'L_OBJECT_BRANCH_CODE) and'
          
            '      (library_prev_mlms.MLL_OBJECT_CODE = library_mll.MLL_OBJEC' +
            'T_CODE) and'
          ''
          '      (not exists'
          '        ( select'
          '            1'
          '          from'
          '            ML_MODEL_STAGES library_mlms2'
          '          where'
          
            '            (library_mlms2.MLL_OBJECT_BRANCH_CODE = library_prev' +
            '_mlms.MLL_OBJECT_BRANCH_CODE) and'
          
            '            (library_mlms2.MLL_OBJECT_CODE = library_prev_mlms.M' +
            'LL_OBJECT_CODE) and'
          
            '            (library_mlms2.ML_MODEL_STAGE_NO > library_prev_mlms' +
            '.ML_MODEL_STAGE_NO)'
          '        )'
          '      )'
          '  )'
          ')')
      end
      item
        Name = 'IS_AUTO_RECEIVING_OPERATION'
        Strings.Strings = (
          '      ( select'
          
            '          Coalesce(Max(lib_mlmso.IS_AUTO_MOVEMENT), 0) as IS_AUT' +
            'O_RECEIVING_OPERATION'
          '                '
          '        from'
          '          MATERIAL_LIST_LINES lib_mll,'
          '          ML_MODEL_STAGES lib_mlms,'
          '          MLMS_OPERATIONS lib_mlmso'
          ''
          '        where'
          
            '          (lib_mll.ML_OBJECT_BRANCH_CODE = %1.ML_OBJECT_BRANCH_C' +
            'ODE) and'
          '          (lib_mll.ML_OBJECT_CODE = %1.ML_OBJECT_CODE) and'
          ''
          
            '          ( ( (lib_mll.NO_AS_FORMATED_TEXT = %1.NO_AS_FORMATED_T' +
            'EXT) and'
          '              (lib_mll.FORK_NO = %1.FORK_NO)'
          '            ) or'
          
            '            ( (lib_mll.NO_AS_FORMATED_TEXT <> %1.NO_AS_FORMATED_' +
            'TEXT) and'
          
            '              (lib_mll.NO_AS_FORMATED_TEXT like Decode(%1.NO_1, ' +
            '0, '#39#39', %1.NO_AS_FORMATED_TEXT) || '#39'%'#39') and'
          '              (%1.FORK_NO = 0) and'
          '              (lib_mll.FORK_NO = 0)'
          '            )'
          '          ) and'
          '                '
          
            '          (lib_mll.MLL_OBJECT_BRANCH_CODE = lib_mlms.MLL_OBJECT_' +
            'BRANCH_CODE) and'
          
            '          (lib_mll.MLL_OBJECT_CODE = lib_mlms.MLL_OBJECT_CODE) a' +
            'nd'
          '                                    '
          
            '          (lib_mlms.MLMS_OBJECT_BRANCH_CODE = lib_mlmso.MLMS_OBJ' +
            'ECT_BRANCH_CODE) and'
          
            '          (lib_mlms.MLMS_OBJECT_CODE = lib_mlmso.MLMS_OBJECT_COD' +
            'E) and'
          '                            '
          '          (lib_mlmso.IS_ACTIVE = 1) and'
          '                '
          
            '          ( (lib_mll.NO_AS_FORMATED_TEXT <> %1.NO_AS_FORMATED_TE' +
            'XT) or'
          
            '            ( (lib_mll.NO_AS_FORMATED_TEXT = %1.NO_AS_FORMATED_T' +
            'EXT) and'
          
            '              ( (lib_mlms.ML_MODEL_STAGE_NO < %2.ML_MODEL_STAGE_' +
            'NO) or'
          
            '                ( (lib_mlms.ML_MODEL_STAGE_NO = %2.ML_MODEL_STAG' +
            'E_NO) and'
          
            '                  (lib_mlmso.MLMS_OPERATION_NO < %3.MLMS_OPERATI' +
            'ON_NO)'
          '                )'
          '              )'
          '            )'
          '          ) and'
          '                '
          '          (not exists'
          '            ( select'
          '                1'
          '              from'
          '                MATERIAL_LIST_LINES lib_mll3,'
          '                ML_MODEL_STAGES lib_mlms3,'
          '                MLMS_OPERATIONS lib_mlmso3'
          '              where'
          
            '                (lib_mll3.ML_OBJECT_BRANCH_CODE = %1.ML_OBJECT_B' +
            'RANCH_CODE) and'
          
            '                (lib_mll3.ML_OBJECT_CODE = %1.ML_OBJECT_CODE) an' +
            'd'
          '                      '
          
            '                ( ( (lib_mll3.NO_AS_FORMATED_TEXT = %1.NO_AS_FOR' +
            'MATED_TEXT) and'
          '                    (lib_mll3.FORK_NO = %1.FORK_NO)'
          '                  ) or'
          
            '                  ( (lib_mll3.NO_AS_FORMATED_TEXT <> %1.NO_AS_FO' +
            'RMATED_TEXT) and'
          
            '                    (lib_mll3.NO_AS_FORMATED_TEXT like Decode(%1' +
            '.NO_1, 0, '#39#39', %1.NO_AS_FORMATED_TEXT) || '#39'%'#39') and'
          '                    (%1.FORK_NO = 0) and'
          '                    (lib_mll3.FORK_NO = 0)'
          '                  )'
          '                ) and'
          '                      '
          
            '                (lib_mll3.MLL_OBJECT_BRANCH_CODE = lib_mlms3.MLL' +
            '_OBJECT_BRANCH_CODE) and'
          
            '                (lib_mll3.MLL_OBJECT_CODE = lib_mlms3.MLL_OBJECT' +
            '_CODE) and'
          '                                          '
          
            '                (lib_mlms3.MLMS_OBJECT_BRANCH_CODE = lib_mlmso3.' +
            'MLMS_OBJECT_BRANCH_CODE) and'
          
            '                (lib_mlms3.MLMS_OBJECT_CODE = lib_mlmso3.MLMS_OB' +
            'JECT_CODE) and'
          ''
          '                (lib_mlmso3.IS_ACTIVE = 1) and'
          '                      '
          
            '                ( ( (lib_mll.NO_AS_FORMATED_TEXT <> lib_mll3.NO_' +
            'AS_FORMATED_TEXT) and'
          
            '                    (lib_mll.NO_AS_FORMATED_TEXT like Decode(lib' +
            '_mll3.NO_1, 0, '#39#39', lib_mll3.NO_AS_FORMATED_TEXT) || '#39'%'#39')'
          '                  ) or'
          
            '                  ( (lib_mll.NO_AS_FORMATED_TEXT = lib_mll3.NO_A' +
            'S_FORMATED_TEXT) and'
          
            '                    ( (lib_mlms.ML_MODEL_STAGE_NO < lib_mlms3.ML' +
            '_MODEL_STAGE_NO) or'
          
            '                      ( (lib_mlms.ML_MODEL_STAGE_NO = lib_mlms3.' +
            'ML_MODEL_STAGE_NO) and'
          
            '                        (lib_mlmso.MLMS_OPERATION_NO < lib_mlmso' +
            '3.MLMS_OPERATION_NO)'
          '                      )'
          '                    )'
          '                  )'
          '                ) and                 '
          ''
          
            '                ( (lib_mll3.NO_AS_FORMATED_TEXT <> %1.NO_AS_FORM' +
            'ATED_TEXT) or'
          
            '                  ( (lib_mll3.NO_AS_FORMATED_TEXT = %1.NO_AS_FOR' +
            'MATED_TEXT) and'
          
            '                    ( (lib_mlms3.ML_MODEL_STAGE_NO < %2.ML_MODEL' +
            '_STAGE_NO) or'
          
            '                      ( (lib_mlms3.ML_MODEL_STAGE_NO = %2.ML_MOD' +
            'EL_STAGE_NO) and'
          
            '                        (lib_mlmso3.MLMS_OPERATION_NO < %3.MLMS_' +
            'OPERATION_NO)'
          '                      )'
          '                    )'
          '                  )'
          '                )'
          '            )'
          '          )'
          '      )')
      end
      item
        Name = 'GET_MLMSO_RECEIVED_FOR_DETAIL_TECH_QUANTITY'
        Strings.Strings = (
          '  ( select'
          '      ('
          '        select'
          '          Coalesce('
          '            MiscUtils.LargeX('
          '              ( Min('
          '                  ( select'
          
            '                      (Coalesce(Sum(om.TOTAL_DETAIL_TECH_QUANTIT' +
            'Y), 0) / lib_mll.TOTAL_DETAIL_TECH_QUANTITY) as COMPLETED_PART'
          '                    from'
          '                      OPERATION_MOVEMENTS om'
          '                    where'
          '                      (om.STORNO_EMPLOYEE_CODE is null) and'
          
            '                      (om.FROM_MLMSO_OBJECT_BRANCH_CODE = lib_ml' +
            'mso.MLMSO_OBJECT_BRANCH_CODE) and'
          
            '                      (om.FROM_MLMSO_OBJECT_CODE = lib_mlmso.MLM' +
            'SO_OBJECT_CODE) and'
          
            '                      (om.OPERATION_MOVEMENT_TYPE_CODE in (1, 2,' +
            ' 3, 4))'
          '                  )'
          '                )'
          '                *'
          '                lib_mll0.TOTAL_DETAIL_TECH_QUANTITY'
          '              ),'
          '              lib_mll0.TOTAL_DETAIL_TECH_QUANTITY'
          '            ),'
          '            0'
          '          )'
          '        '
          '        from'
          '          MATERIAL_LIST_LINES lib_mll,'
          '          ML_MODEL_STAGES lib_mlms,'
          '          MLMS_OPERATIONS lib_mlmso'
          ''
          '        where'
          
            '          (lib_mll.ML_OBJECT_BRANCH_CODE = lib_mll0.ML_OBJECT_BR' +
            'ANCH_CODE) and'
          '          (lib_mll.ML_OBJECT_CODE = lib_mll0.ML_OBJECT_CODE) and'
          ''
          
            '          ( ( (lib_mll.NO_AS_FORMATED_TEXT = lib_mll0.NO_AS_FORM' +
            'ATED_TEXT) and'
          '              (lib_mll.FORK_NO = lib_mll0.FORK_NO)'
          '            ) or'
          
            '            ( (lib_mll.NO_AS_FORMATED_TEXT <> lib_mll0.NO_AS_FOR' +
            'MATED_TEXT) and'
          
            '              (lib_mll.NO_AS_FORMATED_TEXT like Decode(lib_mll0.' +
            'NO_1, 0, '#39#39', lib_mll0.NO_AS_FORMATED_TEXT) || '#39'%'#39') and'
          '              (lib_mll0.FORK_NO = 0) and'
          '              (lib_mll.FORK_NO = 0)'
          '            )'
          '          ) and'
          '                '
          
            '          (lib_mll.MLL_OBJECT_BRANCH_CODE = lib_mlms.MLL_OBJECT_' +
            'BRANCH_CODE) and'
          
            '          (lib_mll.MLL_OBJECT_CODE = lib_mlms.MLL_OBJECT_CODE) a' +
            'nd'
          '                                    '
          
            '          (lib_mlms.MLMS_OBJECT_BRANCH_CODE = lib_mlmso.MLMS_OBJ' +
            'ECT_BRANCH_CODE) and'
          
            '          (lib_mlms.MLMS_OBJECT_CODE = lib_mlmso.MLMS_OBJECT_COD' +
            'E) and'
          '                            '
          '          (lib_mlmso.IS_ACTIVE = 1) and'
          '          (lib_mlmso.IS_AUTO_MOVEMENT = 0) and'
          '                '
          
            '          ( (lib_mll.NO_AS_FORMATED_TEXT <> lib_mll0.NO_AS_FORMA' +
            'TED_TEXT) or'
          
            '            ( (lib_mll.NO_AS_FORMATED_TEXT = lib_mll0.NO_AS_FORM' +
            'ATED_TEXT) and'
          
            '              ( (lib_mlms.ML_MODEL_STAGE_NO < lib_mlms0.ML_MODEL' +
            '_STAGE_NO) or'
          
            '                ( (lib_mlms.ML_MODEL_STAGE_NO = lib_mlms0.ML_MOD' +
            'EL_STAGE_NO) and'
          
            '                  ( (lib_mlmso.MLMS_OPERATION_NO < lib_mlmso0.ML' +
            'MS_OPERATION_NO) or'
          
            '                    ( (lib_mlmso.MLMS_OPERATION_NO = lib_mlmso0.' +
            'MLMS_OPERATION_NO) and'
          
            '                      (lib_mlmso.MLMS_OPERATION_VARIANT_NO = lib' +
            '_mlmso0.MLMS_OPERATION_VARIANT_NO)'
          '                    )'
          '                  )'
          '                )'
          '              )'
          '            )'
          '          ) and'
          '                '
          '          (not exists'
          '            ( select'
          '                1'
          '              from'
          '                MATERIAL_LIST_LINES lib_mll3,'
          '                ML_MODEL_STAGES lib_mlms3,'
          '                MLMS_OPERATIONS lib_mlmso3'
          '              where'
          
            '                (lib_mll3.ML_OBJECT_BRANCH_CODE = lib_mll0.ML_OB' +
            'JECT_BRANCH_CODE) and'
          
            '                (lib_mll3.ML_OBJECT_CODE = lib_mll0.ML_OBJECT_CO' +
            'DE) and'
          '                      '
          
            '                ( ( (lib_mll3.NO_AS_FORMATED_TEXT = lib_mll0.NO_' +
            'AS_FORMATED_TEXT) and'
          '                    (lib_mll3.FORK_NO = lib_mll0.FORK_NO)'
          '                  ) or'
          
            '                  ( (lib_mll3.NO_AS_FORMATED_TEXT <> lib_mll0.NO' +
            '_AS_FORMATED_TEXT) and'
          
            '                    (lib_mll3.NO_AS_FORMATED_TEXT like Decode(li' +
            'b_mll0.NO_1, 0, '#39#39', lib_mll0.NO_AS_FORMATED_TEXT) || '#39'%'#39') and'
          '                    (lib_mll0.FORK_NO = 0) and'
          '                    (lib_mll3.FORK_NO = 0)'
          '                  )'
          '                ) and'
          '                      '
          
            '                (lib_mll3.MLL_OBJECT_BRANCH_CODE = lib_mlms3.MLL' +
            '_OBJECT_BRANCH_CODE) and'
          
            '                (lib_mll3.MLL_OBJECT_CODE = lib_mlms3.MLL_OBJECT' +
            '_CODE) and'
          '                                          '
          
            '                (lib_mlms3.MLMS_OBJECT_BRANCH_CODE = lib_mlmso3.' +
            'MLMS_OBJECT_BRANCH_CODE) and'
          
            '                (lib_mlms3.MLMS_OBJECT_CODE = lib_mlmso3.MLMS_OB' +
            'JECT_CODE) and'
          ''
          '                (lib_mlmso3.IS_ACTIVE = 1) and'
          '                (lib_mlmso3.IS_AUTO_MOVEMENT = 0) and'
          '                      '
          
            '                ( ( (lib_mll.NO_AS_FORMATED_TEXT <> lib_mll3.NO_' +
            'AS_FORMATED_TEXT) and'
          
            '                    (lib_mll.NO_AS_FORMATED_TEXT like Decode(lib' +
            '_mll3.NO_1, 0, '#39#39', lib_mll3.NO_AS_FORMATED_TEXT) || '#39'%'#39')'
          '                  ) or'
          
            '                  ( (lib_mll.NO_AS_FORMATED_TEXT = lib_mll3.NO_A' +
            'S_FORMATED_TEXT) and'
          
            '                    ( (lib_mlms.ML_MODEL_STAGE_NO < lib_mlms3.ML' +
            '_MODEL_STAGE_NO) or'
          
            '                      ( (lib_mlms.ML_MODEL_STAGE_NO = lib_mlms3.' +
            'ML_MODEL_STAGE_NO) and'
          
            '                        (lib_mlmso.MLMS_OPERATION_NO < lib_mlmso' +
            '3.MLMS_OPERATION_NO)'
          '                      )'
          '                    )'
          '                  )'
          '                ) and                 '
          ''
          
            '                ( (lib_mll3.NO_AS_FORMATED_TEXT <> lib_mll0.NO_A' +
            'S_FORMATED_TEXT) or'
          
            '                  ( (lib_mll3.NO_AS_FORMATED_TEXT = lib_mll0.NO_' +
            'AS_FORMATED_TEXT) and'
          
            '                    ( (lib_mlms3.ML_MODEL_STAGE_NO < lib_mlms0.M' +
            'L_MODEL_STAGE_NO) or'
          
            '                      ( (lib_mlms3.ML_MODEL_STAGE_NO = lib_mlms0' +
            '.ML_MODEL_STAGE_NO) and'
          
            '                        (lib_mlmso3.MLMS_OPERATION_NO < lib_mlms' +
            'o0.MLMS_OPERATION_NO)'
          '                      )'
          '                    )'
          '                  )'
          '                )'
          '            )'
          '          ) and'
          '                '
          '          (not exists'
          '            ( select'
          '                1'
          '              from'
          '                MATERIAL_LIST_LINES lib_mll2,'
          '                ML_MODEL_STAGES lib_mlms2,'
          '                MLMS_OPERATIONS lib_mlmso2'
          ''
          '              where'
          
            '                (lib_mll2.ML_OBJECT_BRANCH_CODE = lib_mll.ML_OBJ' +
            'ECT_BRANCH_CODE) and'
          
            '                (lib_mll2.ML_OBJECT_CODE = lib_mll.ML_OBJECT_COD' +
            'E) and'
          ''
          
            '                ( ( (lib_mll2.NO_AS_FORMATED_TEXT = lib_mll.NO_A' +
            'S_FORMATED_TEXT) and'
          '                    (lib_mll2.FORK_NO = lib_mll.FORK_NO)'
          '                  ) or'
          
            '                  ( (lib_mll2.NO_AS_FORMATED_TEXT <> lib_mll.NO_' +
            'AS_FORMATED_TEXT) and'
          
            '                    (lib_mll2.NO_AS_FORMATED_TEXT like Decode(li' +
            'b_mll.NO_1, 0, '#39#39', lib_mll.NO_AS_FORMATED_TEXT) || '#39'%'#39') and'
          '                    (lib_mll.FORK_NO = 0) and'
          '                    (lib_mll2.FORK_NO = 0)'
          '                  )'
          '                ) and'
          '                      '
          
            '                (lib_mll2.MLL_OBJECT_BRANCH_CODE = lib_mlms2.MLL' +
            '_OBJECT_BRANCH_CODE) and'
          
            '                (lib_mll2.MLL_OBJECT_CODE = lib_mlms2.MLL_OBJECT' +
            '_CODE) and'
          '                                          '
          
            '                (lib_mlms2.MLMS_OBJECT_BRANCH_CODE = lib_mlmso2.' +
            'MLMS_OBJECT_BRANCH_CODE) and'
          
            '                (lib_mlms2.MLMS_OBJECT_CODE = lib_mlmso2.MLMS_OB' +
            'JECT_CODE) and'
          '                                  '
          '                (lib_mlmso2.IS_ACTIVE = 1) and'
          '                (lib_mlmso2.IS_AUTO_MOVEMENT = 0) and'
          '                      '
          
            '                ( (lib_mll2.NO_AS_FORMATED_TEXT <> lib_mll.NO_AS' +
            '_FORMATED_TEXT) or'
          
            '                  ( (lib_mll2.NO_AS_FORMATED_TEXT = lib_mll.NO_A' +
            'S_FORMATED_TEXT) and'
          
            '                    ( (lib_mlms2.ML_MODEL_STAGE_NO < lib_mlms.ML' +
            '_MODEL_STAGE_NO) or'
          
            '                      ( (lib_mlms2.ML_MODEL_STAGE_NO = lib_mlms.' +
            'ML_MODEL_STAGE_NO) and'
          
            '                        (lib_mlmso2.MLMS_OPERATION_NO < lib_mlms' +
            'o.MLMS_OPERATION_NO)'
          '                      )'
          '                    )'
          '                  )'
          '                ) and'
          '                      '
          '                (not exists'
          '                  ( select'
          '                      1'
          '                    from'
          '                      MATERIAL_LIST_LINES lib_mll3,'
          '                      ML_MODEL_STAGES lib_mlms3,'
          '                      MLMS_OPERATIONS lib_mlmso3'
          '                    where'
          
            '                      (lib_mll3.ML_OBJECT_BRANCH_CODE = lib_mll0' +
            '.ML_OBJECT_BRANCH_CODE) and'
          
            '                      (lib_mll3.ML_OBJECT_CODE = lib_mll0.ML_OBJ' +
            'ECT_CODE) and'
          '                            '
          
            '                      ( ( (lib_mll3.NO_AS_FORMATED_TEXT = lib_ml' +
            'l0.NO_AS_FORMATED_TEXT) and'
          '                          (lib_mll3.FORK_NO = lib_mll0.FORK_NO)'
          '                        ) or'
          
            '                        ( (lib_mll3.NO_AS_FORMATED_TEXT <> lib_m' +
            'll0.NO_AS_FORMATED_TEXT) and'
          
            '                          (lib_mll3.NO_AS_FORMATED_TEXT like Dec' +
            'ode(lib_mll0.NO_1, 0, '#39#39', lib_mll0.NO_AS_FORMATED_TEXT) || '#39'%'#39') ' +
            'and'
          '                          (lib_mll0.FORK_NO = 0) and'
          '                          (lib_mll3.FORK_NO = 0)'
          '                        )'
          '                      ) and'
          '                            '
          
            '                      (lib_mll3.MLL_OBJECT_BRANCH_CODE = lib_mlm' +
            's3.MLL_OBJECT_BRANCH_CODE) and'
          
            '                      (lib_mll3.MLL_OBJECT_CODE = lib_mlms3.MLL_' +
            'OBJECT_CODE) and'
          '                                                '
          
            '                      (lib_mlms3.MLMS_OBJECT_BRANCH_CODE = lib_m' +
            'lmso3.MLMS_OBJECT_BRANCH_CODE) and'
          
            '                      (lib_mlms3.MLMS_OBJECT_CODE = lib_mlmso3.M' +
            'LMS_OBJECT_CODE) and'
          ''
          '                      (lib_mlmso3.IS_ACTIVE = 1) and'
          '                      (lib_mlmso3.IS_AUTO_MOVEMENT = 0) and'
          ''
          
            '                      ( ( (lib_mll2.NO_AS_FORMATED_TEXT <> lib_m' +
            'll3.NO_AS_FORMATED_TEXT) and'
          
            '                          (lib_mll2.NO_AS_FORMATED_TEXT like Dec' +
            'ode(lib_mll3.NO_1, 0, '#39#39', lib_mll3.NO_AS_FORMATED_TEXT) || '#39'%'#39')'
          '                        ) or'
          
            '                        ( (lib_mll2.NO_AS_FORMATED_TEXT = lib_ml' +
            'l3.NO_AS_FORMATED_TEXT) and'
          
            '                          ( (lib_mlms2.ML_MODEL_STAGE_NO < lib_m' +
            'lms3.ML_MODEL_STAGE_NO) or'
          
            '                            ( (lib_mlms2.ML_MODEL_STAGE_NO = lib' +
            '_mlms3.ML_MODEL_STAGE_NO) and'
          
            '                              (lib_mlmso2.MLMS_OPERATION_NO < li' +
            'b_mlmso3.MLMS_OPERATION_NO)'
          '                            )'
          '                          )'
          '                        )'
          '                      ) and                 '
          ''
          
            '                      ( (lib_mll3.NO_AS_FORMATED_TEXT <> lib_mll' +
            '0.NO_AS_FORMATED_TEXT) or'
          
            '                        ( (lib_mll3.NO_AS_FORMATED_TEXT = lib_ml' +
            'l0.NO_AS_FORMATED_TEXT) and'
          
            '                          ( (lib_mlms3.ML_MODEL_STAGE_NO < lib_m' +
            'lms0.ML_MODEL_STAGE_NO) or'
          
            '                            ( (lib_mlms3.ML_MODEL_STAGE_NO = lib' +
            '_mlms0.ML_MODEL_STAGE_NO) and'
          
            '                              (lib_mlmso3.MLMS_OPERATION_NO < li' +
            'b_mlmso0.MLMS_OPERATION_NO)'
          '                            )'
          '                          )'
          '                        )'
          '                      )'
          '                  )'
          '                )'
          '            )'
          '          )'
          '      )'
          ''
          '    from'
          '      MLMS_OPERATIONS lib_mlmso0,'
          '      ML_MODEL_STAGES lib_mlms0,'
          '      MATERIAL_LIST_LINES lib_mll0'
          ''
          '    where'
          
            '      (lib_mll0.MLL_OBJECT_BRANCH_CODE = lib_mlms0.MLL_OBJECT_BR' +
            'ANCH_CODE) and'
          '      (lib_mll0.MLL_OBJECT_CODE = lib_mlms0.MLL_OBJECT_CODE) and'
          ''
          
            '      (lib_mlms0.MLMS_OBJECT_BRANCH_CODE = lib_mlmso0.MLMS_OBJEC' +
            'T_BRANCH_CODE) and'
          
            '      (lib_mlms0.MLMS_OBJECT_CODE = lib_mlmso0.MLMS_OBJECT_CODE)' +
            ' and'
          ''
          '      (lib_mlmso0.MLMSO_OBJECT_BRANCH_CODE = %1) and'
          '      (lib_mlmso0.MLMSO_OBJECT_CODE = %2)'
          '  )')
      end>
    Left = 800
    Top = 384
  end
end
